<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>TmdaFaq</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="mentalwealth/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="mentalwealth/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="mentalwealth/css/print.css">
</head>
<body>
<table>
<tr>
<td>
<img src="logo.png">
</td>
<td>
&nbsp;[<a href="FrontPage.html">FrontPage</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]
</td>
</tr>
</table>
<hr>
<div id="page">
<h1 id="title">TmdaFaq</h1>
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867"><strong>TMDA Frequently Asked Questions</strong> <span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line874">NOTE: don't delete obsolete entries because it will break the numbering that people refer to the FAQ entries by. Just strikethrough them but leave them in place. <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-6"></span><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li><a href="#head-27759d67907d04472d973723917b29584e5079d4">General questions</a><ol><li><a href="#head-1128fec79a5c9e1a585612e7502fe9d737bb4dce">Can't spammers just setup an auto-responder to defeat TMDA?</a></li><li><a href="#head-51b94a079000dd337811374b92a8fc3a956ea707">Why isn't TMDA written in Perl, C, C++, or Java?</a></li><li><a href="#head-0d66807a6e53c5f9fb14d9196272f3ef33e28f23">Any plans to support Microsoft Exchange Server?</a></li><li><a href="#head-ce194e4777e37df61111b7149b9426a453df4bb2">Does TMDA have a web interface?</a></li><li><a href="#head-dad691dbbc9ea709464619c532e410f85b5c8231">Won't senders just refuse to confirm their messages?</a></li><li><a href="#head-d8cdfe444882482d067d43c4c897f5c838c70432">How do you know when someone didn't confirm their message?</a></li><li><a href="#head-04360acddc99c635f015aba3e1f600cd0a7eb7d4">Under which license is TMDA released? I'd like to use it in a commercial application.</a></li><li><a href="#head-08e32fa57917cd1df456aa47c79eff4bcedb4b34">What version of TMDA does the FAQ address?</a></li><li><a href="#head-2c0b8ee7c80925f287cc39133b91bf4faad44493">Are there any other TMDA-like systems available?</a></li><li><a href="#head-4e7eeaba7c360e034bbc37f5135d5035633fb6e2">Can TMDA be used in conjunction with other countermeasures such as RBL, Razor, Spamassasin, etc.?</a></li><li><a href="#head-07854beaf8022a9e580af271593380ab92bd8435">What software did you use to generate this FAQ?</a></li><li><a href="#head-03949a163c8248571a13c9cb53bd5e74fd85357d">Why the funny looking e-mail addresses? (or, advantages of tagged messages)</a></li><li><a href="#head-a2cbc244f22517e43bf9a023b3c9c8b4fcf7871a">What do I do when a spammer does confirm their message?</a></li><li><a href="#head-b01a6086f5f59c1e4486c5d1dbab72246d92e0ec">Why does TMDA run on the server instead of my mail client?</a></li><li><a href="#head-e51a2eb9423cf940f1f3e5f7c70fbb0f45de958e">What's with those goofy release names?</a></li><li><a href="#head-0f049b3fdc0b8d78235d1d9acb913151e71339c4">What about challenge/response mail loops?</a></li></ol><li><a href="#head-56c1256385714ddebfd2c5fff3e384728e903aa9">Setup and installation</a><ol><li><a href="#head-3d4d2d0a105a9d58e8e2349ff755c821aa154c0e">I'm getting errors when running 'compileall' on my RedHat Linux system</a></li></ol><li><a href="#head-2c128f23dd9fd4534f2a1aa8f99aa709e3973237">Mail Transport Agent issues</a><ol><li><a href="#head-5eda9e817c27598c2e5a2f7b5ab0c139520fd760">Why don't my user+detail addresses work with Sendmail virtualdomains?</a></li><li><a href="#head-7ec01b86b88703d3bc7f5cce3d025801c853172d">Why don't my user+detail addresses work with Sendmail /etc/aliases?</a></li><li><a href="#head-28d3deeba24ced7018ff39d4f8561f517a9bcdd5">I'm getting "553 sorry, that domain isn't in my list of allowed rcpthosts (#5.7.1)"</a></li><li><a href="#head-5a70837212b3320ec35b3aedbe2481c40d37e39a">Exim is rewriting return-path when BOUNCE_ENV_SENDER is set.</a></li><li><a href="#head-93eda22a9533714e4d93da9e7bac60df959bf8f6">What is recommended for RECIPIENT_DELIMITER, '-' or '+'?</a></li><li><a href="#head-491815cb040f46c731bc547a0328ddfbaa56a751">How do I establish a secure connection between TMDA and my SMTP server?</a></li><li><a href="#head-0bde1848548e71633a5aece80d12dfd3d244be14">I'm getting SMTPRecipientsRefused or SMTPSenderRefused errors</a></li><li><a href="#head-d73181a47c68296632b2c46b4a8c113ed69c0b7e">Can I use TMDA with a qmail relay?</a></li><li><a href="#head-5d3c0d25c8287a9638ddddc923125f4983a3a825">Why do confirmations trigger new requests under Sendmail?</a></li></ol><li><a href="#head-6d8bfafdfe6370b7f59775208e81796795ff3a87">TMDA server-side issues</a><ol><li><a href="#head-63bbb3a758bdbc58536f309e078af8df6cc1b05f">How do I setup a whitelist?</a></li><li><a href="#head-0b1aee3c2decf32a26ffcc12b397f9d3cec3fdc0">How do I setup an "auto-whitelist"?</a></li><li><a href="#head-e641fa61a130efa1d7836ab8ded1f3857da74b79">How can I manage messages in my pending queue?</a></li><li><a href="#head-1f4e50d4114173300c4a7a63ce81a845770f06ee">How do I allow my ezmlm mailing lists to pass through TMDA?</a></li><li><a href="#head-a1ebf1fc86489c6637f8a977679a6f1a83b26d17">How do I prevent my auto-whitelist from being filled with 'dated' addresses?</a></li><li><a href="#head-4a53cd024ccf7b739aa0310553a4ed898c658974">Which address headers are examined when looking for a filter match?</a></li><li><a href="#head-2f0fc68e5357f633123128481b6f4642279b6957">How do I prevent my postmaster from getting all my bounced confirmation requests?</a></li><li><a href="#head-3ff58b75db7c81e71011ddd9f2dc7779f1bf703a">How do I use TMDA with mailing lists?</a></li><li><a href="#head-db9777e65be1afd08979afc00eecb8b8baccd5de">How can I use customized templates for TMDA's auto-responses?</a></li><li><a href="#head-e81137818ea55d7e15d5822687715793af7062ea">SPAM is getting in by spoofing my domain.</a></li><li><a href="#head-fd37af2075b1b0c520bd8df85887bd2fec94924f">IOError: /home/foo/.tmda/pending/1024366714.22692.msg has no Return-Path header!</a></li><li><a href="#head-ee35633e2369946da0d2496b4600b7411ec8be50">What happens when two TMDA installations interact? Lost mail? Mail loops?</a></li><li><a href="#head-cff906f6d9dee1999169748dbb80f9bfd53829aa">How is the "responses" directory cleaned out?</a></li><li><a href="#head-1032515a4ad4dead0c179217f9e3c9221f885cad">Why aren't confirmed/released messages deleted from pending?</a></li></ol><li><a href="#head-10c272d831cbf241cfb9ca58136d425577ca3bb6">TMDA client-side issues</a><ol><li><a href="#head-dc63370afd96fceb9526ad5677a343c0c2306601">Can I send tagged messages with a non-Unix client like Microsoft Outlook?</a></li><li><a href="#head-4ca407c9f1ebe05cbc3432ef8cb249064231a4e6">My MUA doesn't support a /usr/sbin/sendmail interface. Can I still tag my outgoing messages?</a></li><li><a href="#head-350d18c264966d0845d743050809120cbb9a846e">Can I post to a TMDA protected mailing list with a 'dated' address?</a></li><li><a href="#head-34a40b5885eb37712190ffceed35a85008d2448b">How can I make sure undeliverable bounces get returned to me?</a></li><li><a href="#head-4f82a55edd615a8cb6983f2977ac1dcb5a03f24d">When someone replies to my messages, will they get challenged?</a></li><li><a href="#head-f5c80aa5fd7f16919fb34e3f9563186087d9bc42">Which mail clients (MUAs) are supported by tmda-ofmipd?</a></li><li><a href="#head-334b2e0ed368e8c80544726afa35a6e5b0b8af53">My MUA doesn't support direct SMTP. Can I still use tmda-ofmipd?</a></li><li><a href="#head-5b1b10b6d51eca8e740d3b21f9f393e1406e37e0">Why is CRAM-MD5 disabled in tmda-ofmipd when using remote authentication?</a></li><li><a href="#head-7b3d893cd20a90d79b371a136cdbf22f3601cdb2">Does tmda-ofmipd have TLS/SSL support?</a></li></ol><li><a href="#head-c6d5edac135cfcbe4116c50b67b6ddb403dcf0cd">Integration issues (with external resources)</a><ol><li><a href="#head-31b6db28514fb8d10f1d8475baffcb0141f43ed5">How do I setup TMDA with vpopmail?</a></li><li><a href="#head-8948d7e0c2fc74bb8d4b852b32282c856d01e28e">How can I prevent BBDB from asking about 'dated' addresses?</a></li><li><a href="#head-39124e4c74c6975f5776a15899e2cc430bf98ce6">How do I integrate TMDA with the ezmlm mailing list manager?</a></li><li><a href="#head-afd89c7ac9ad48cc5c93f0ef1e5d760f2de9582c">Can I use TMDA with Fetchmail?</a></li><li><a href="#head-75a2b9013a74b03cd24d2d43cc4e76bba2e5e950">Can I use TMDA with getmail?</a></li><li><a href="#head-6393b2d04084447b76374f2338b904586715b2c2">Any tips for using Gmane with TMDA?</a></li></ol></li></ol></div><p class="line874"> <span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span><p class="line867">
<h1 id="head-27759d67907d04472d973723917b29584e5079d4">General questions</h1>
<span class="anchor" id="line-11"></span><p class="line867">
<h2 id="head-1128fec79a5c9e1a585612e7502fe9d737bb4dce">Can't spammers just setup an auto-responder to defeat TMDA?</h2>
<span class="anchor" id="line-12"></span><p class="line874">In theory yes, but in practice this is not likely to happen. Most SPAM is unrepliable, so TMDA's confirmation requests are never delivered to them. They use non-valid return addresses as to not incur the cost of the tremendous number of bounces they generate. Using a valid return address to process all the bounces looking for confirmation messages to auto-reply to would defeat their economies of scale. It would also make them easy to block, track down and report, sue, etc. <span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><p class="line874">In short, trying to thwart TMDA in this manner would defeat the cost-effectiveness of the bulk-mailing process. Simple economics keep us safe. <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><p class="line874">But should these facts change, TMDA could modify its (currently very simple) challenge/response to make it more difficult for a computer to auto-reply to. The level of difficulty could increase as much as is necessary for the sender to prove their humanity and legitimacy. <span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span><p class="line874">The idea is to keep the challenge/response as simple as possible to avoid inconveniencing legitimate senders, while at the same time difficult enough to thwart an automated response system. At the present time, TMDA offers the ability to confirm by a simple e-mail reply, or by clicking on a URL. There is no evidence to suggest that a more challenging procedure is even close to necessary. <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><p class="line874">If spammers do resort to auto-confirmation however, we've won a huge battle for the community by raising the bar and forcing them to leave a breadcrumb trail leading back to their lair. As the focus on legislation continues, and spamming becomes an increasingly illegal activity, who will take these great risks for such a little reward? <span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span><p class="line867">
<h2 id="head-51b94a079000dd337811374b92a8fc3a956ea707">Why isn't TMDA written in Perl, C, C++, or Java?</h2>
<span class="anchor" id="line-23"></span><p class="line874">TMDA is written in Python, which is a great prototyping language because development speed is very high, the standard library is very rich, and there are many 3rd party modules available. For TMDA this means we can implement any feature that we think of in a relatively short amount of time, get feedback, make changes, etc. This is great for trying out a large number of features, approaches, etc., to see what works, what doesn't, what is necessary, and what isn't in a new application. While TMDA-like programs are now popping up all over the place, remember that TMDA was the first of its kind, so there were no other applications to learn from initially. <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line874">Python is also a safe language. For example, unlike C or C++, buffers in Python are dynamically sized, so TMDA is not vulnerable to buffer overflows and all the accompanying security problems. <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><p class="line874">The question of peformance and scalability has often been raised due to the fact that Python is an interpreted language and thus executes slower than one with a native code compiler like C, C++, or Objective Caml. The fact is that most scalability or performance problems can be resolved through configuration changes (see FAQ 7.7 for example). In fact, some sites have reported running over 50,000 messages/day through TMDA without any problems. So in short, it doesn't make sense to work in a lower-level language and lose Python's productivity and reliability benefits. <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line867">
<h2 id="head-0d66807a6e53c5f9fb14d9196272f3ef33e28f23">Any plans to support Microsoft Exchange Server?</h2>
<span class="anchor" id="line-30"></span><p class="line874">I'm not adverse to TMDA supporting Microsoft Windows, but someone else will have to do the work. So far, noone has stepped up to the plate. <span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><p class="line862">For me, Windows is not a pleasant platform for software development. Mail server software such as Exchange Server costs $$, and it's not cheap. Most importantly, it isn't <a class="nonexistent" href="./OpenSource.html">OpenSource</a>, so it's like a black box which makes things extremely difficult when trying to debug complex problems. <span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><p class="line867">
<h2 id="head-ce194e4777e37df61111b7149b9426a453df4bb2">Does TMDA have a web interface?</h2>
<span class="anchor" id="line-35"></span><p class="line862">Yes, tmda-cgi from Gre7g Luterman and friends. See <a class="http" href="http://tmda.net/tmda-cgi/">http://tmda.net/tmda-cgi/</a> <span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><p class="line867">
<h2 id="head-dad691dbbc9ea709464619c532e410f85b5c8231">Won't senders just refuse to confirm their messages?</h2>
<span class="anchor" id="line-38"></span><p class="line874">A common misconception about systems based on whitelisting with challenges is that few of us are so irresistible that people will jump through extra hoops to talk to us. <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><p class="line874">In actual practice (5 years of using TMDA), I've not found this to be the case at all, and most TMDA users will agree. If someone took the time to craft and then send you a message, they will most likely take a few extra seconds to reply to a one-time confirmation request. Phrased another way, by writing to you, the sender also fulfills a need of their own---it's not purely to your benefit that you receive their message. If they refuse to confirm simply out of spite, that need goes unfulfilled (which is why this is so rare). <span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><p class="line874">Once upon a time, people had the same sort of objections about authenticating a mailing list subscription; something we now take for granted. TMDA's confirmation mechanism is really no different. <span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><p class="line874">In any case, TMDA provides several different ways to monitor who sent you mail, who didn't reply to their confirmation request, etc (see next FAQ entry). <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><p class="line862">Also, legitimate senders are faced with a TMDA confirmation request less than you might think. For one, a well constructed initial whitelist will encompass the vast majority of your correspondents. Second, TMDA has facilities to reduce this even further. For example, use of 'dated' addresses in your outgoing messages which allow anyone through until it expires. FAQ 5.5 details two different methods to insure that responses to your messages will not be challenged. In other words, if you are using TMDA properly, a challenge should only be issued for a new correspondent who is e-mailing you out of the blue. That is, 1) the sender is someone whom you've never received a message from before, and 2) their message is <em>not</em> in response to a message you've sent. <span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><p class="line874">As proof, using both a whitelist (with auto-update) and the 'dated' address feature meant that only 6% of my legitimate corresponents had to confirm their messages to me. I think that's quite acceptable. <span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><p class="line874">So in summary, most of your correspondents will not even see a confirmation request, and when they do, they will reply to it. I'm much more comfortable with this scenario than with a classifier which accidentally trashes a message it "thinks" is spam. At least with TMDA, the sender has the choice whether or not to let his message be delivered to you. With a classifier, he will assume it has been delivered when it has not been, which opens a communications rift. <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><p class="line867">
<h2 id="head-d8cdfe444882482d067d43c4c897f5c838c70432">How do you know when someone didn't confirm their message?</h2>
<span class="anchor" id="line-53"></span><p class="line874">Although rare, there may be cases when someone can't (or won't) reply to your confirmation request, and you don't want to lose that message. TMDA provides several ways around this dilemma. <span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><p class="line874">TMDA includes comprehensive logging of all incoming mail which can be parsed (by script or by eye) for such messages. <span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><p class="line874">For the more paranoid, it also includes a "pending queue" browser that lets you manipulate your unconfirmed messages in different ways. Print summaries, view/delete/release/show/blacklist/whitelist, etc. <span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><p class="line874">You can even have a copy of each unconfirmed message forwarded to another address. <span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><p class="line874">So basically there is something for every level of trust or distrust. <span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><p class="line867">
<h2 id="head-04360acddc99c635f015aba3e1f600cd0a7eb7d4">Under which license is TMDA released? I'd like to use it in a commercial application.</h2>
<span class="anchor" id="line-64"></span><p class="line862">TMDA is released under the GNU General Public License. For more about the GPL, see <a class="http" href="http://www.gnu.org/licenses/gpl.html">http://www.gnu.org/licenses/gpl.html</a> <span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><p class="line874">The copyright notice included with the code looks like: <span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><p class="line867"><span class="anchor" id="line-69"></span><pre># Copyright (C) 2001-2006 Jason R. Mastaler &lt;jason@mastaler.com&gt;
<span class="anchor" id="line-70"></span>#
<span class="anchor" id="line-71"></span># This file is part of TMDA.
<span class="anchor" id="line-72"></span>#
<span class="anchor" id="line-73"></span># TMDA is free software; you can redistribute it and/or modify it
<span class="anchor" id="line-74"></span># under the terms of the GNU General Public License as published by
<span class="anchor" id="line-75"></span># the Free Software Foundation; either version 2 of the License, or
<span class="anchor" id="line-76"></span># (at your option) any later version. A copy of this license should
<span class="anchor" id="line-77"></span># be included in the file COPYING.
<span class="anchor" id="line-78"></span>#
<span class="anchor" id="line-79"></span># TMDA is distributed in the hope that it will be useful, but WITHOUT
<span class="anchor" id="line-80"></span># ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
<span class="anchor" id="line-81"></span># FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
<span class="anchor" id="line-82"></span># for more details.
<span class="anchor" id="line-83"></span>#
<span class="anchor" id="line-84"></span># You should have received a copy of the GNU General Public License
<span class="anchor" id="line-85"></span># along with TMDA; if not, write to the Free Software Foundation, Inc.,
<span class="anchor" id="line-86"></span># 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</pre><span class="anchor" id="line-87"></span><p class="line867">
<h2 id="head-08e32fa57917cd1df456aa47c79eff4bcedb4b34">What version of TMDA does the FAQ address?</h2>
<span class="anchor" id="line-88"></span><p class="line874">The FAQ attempts to track the latest released version of TMDA, which currently is from the v1.1.x series. <span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><p class="line867">
<h2 id="head-2c0b8ee7c80925f287cc39133b91bf4faad44493">Are there any other TMDA-like systems available?</h2>
<span class="anchor" id="line-91"></span><p class="line874">If for whatever reason TMDA doesn't fit your needs, here are some other packages that provide similar functionality. Please let us know if you come across any others. <span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><ul><li><p class="line891"><a class="http" href="http://www.paganini.net/ask/">Active Spam Killer</a>. <br />
<br />
 <span class="anchor" id="line-94"></span></li><li><p class="line891"><a class="http" href="http://www.quarantinemail.com/">QuarantineMail</a> (for Microsoft Outlook, commercial product). <br />
<br />
 <span class="anchor" id="line-95"></span></li><li><p class="line891"><a class="http" href="http://www.qurb.com/">Qurb</a> (for Microsoft Outlook, commercial product). <br />
<br />
 <span class="anchor" id="line-96"></span></li><li><p class="line891"><a class="http" href="http://www.mailfrontier.com/">Matador</a> (for Microsoft Outlook, commercial product). <br />
<br />
 <span class="anchor" id="line-97"></span></li><li><p class="line891"><a class="http" href="http://www.digiportal.com/">ChoiceMail</a> (for Microsoft Windows, commercial product). <br />
<br />
 <span class="anchor" id="line-98"></span></li><li><p class="line891"><a class="http" href="http://www.junkjam.com/">JunkJam</a> (for Microsoft Windows, commercial product). <br />
<br />
 <span class="anchor" id="line-99"></span></li><li><p class="line891"><a class="http" href="http://spamarrest.com/">Spam Arrest</a> (commercial service). <br />
<br />
 <span class="anchor" id="line-100"></span></li><li><p class="line891"><a class="http" href="http://mail.spamcop.net/">SpamCop Email</a> (commercial service). <br />
<br />
 <span class="anchor" id="line-101"></span></li><li><p class="line891"><a class="http" href="http://smarden.org/qconfirm/">qconfirm</a> (qmail only). <br />
<br />
 <span class="anchor" id="line-102"></span></li><li><p class="line891"><a class="http" href="http://omail.omnis.ch/ospam/">oSpam</a> (qmail only). <br />
<br />
 <span class="anchor" id="line-103"></span></li><li><p class="line891"><a class="http" href="http://www.panix.com/~wje/#sg">spamgard</a> (Requires procmail). <br />
<br />
 <span class="anchor" id="line-104"></span></li><li><p class="line862">qsecretary from D. J. Bernstein (not yet released).<br />
<br />
 <span class="anchor" id="line-105"></span></li><li><p class="line891"><a class="http" href="http://twistedmatrix.com/users/jh.twistd/moin/moin.cgi/AntiSpamSystemExtension">AntiSpamSystemExtension</a>. <br />
<br />
 <span class="anchor" id="line-106"></span></li><li><p class="line891"><a class="http" href="http://search.cpan.org/search?dist=Mail-Address-Tagged">Mail::Address::Tagged</a> Perl module. <br />
<br />
 <span class="anchor" id="line-107"></span></li></ul><p class="line867">
<h2 id="head-4e7eeaba7c360e034bbc37f5135d5035633fb6e2">Can TMDA be used in conjunction with other countermeasures such as RBL, Razor, Spamassasin, etc.?</h2>
<span class="anchor" id="line-108"></span><p class="line862">( also see <a class="http" href="http://wiki.tmda.net/SpamAssassin">http://wiki.tmda.net/SpamAssassin</a> ) <span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><p class="line874">The short answer to this question is, "Yes." But the question is frequently asked in other terms: <span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><p class="line867"><span class="anchor" id="line-113"></span><pre>"TMDA seems to allows SPAM to get all the way into my mailserver. So instead of sitting in my mailbox, the SPAM sits in my pending queue. This takes up disk space on my mailserver, and uses bandwidth when the email is sent. I'd like to be able to block
<span class="anchor" id="line-114"></span>email earlier so that SPAM consumes less resources. Can TMDA do this?"</pre><span class="anchor" id="line-115"></span><p class="line874">TMDA does not prevent you from using other spam prevention techniques. TMDA relies on a working Mail Transfer Agent (MTA) like qmail, postfix, exim or sendmail. So any of the other spam prevention techniques that work with the MTA can be employed in conjunction with TMDA. <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line862">I personally, use Realtime <a class="nonexistent" href="./BlackLists.html">BlackLists</a> (RBLs) configured into my postfix MTA. Any email that gets past the RBLs will be delivered to spamassassin. This setup, alone, works pretty well. However when I was relying on these techniques alone, an annoying amount of spam would still reach my mailbox. That's when I deployed TMDA as the last stage in my mail delivery process. TMDA catches everything that the RBLs and spamassissin allow through. In this situation, using TMDA does not actually consume any more disk space or bandwidth than not using TMDA since the other prevention techniques allow the SPAM through. <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><p class="line874">The general answer to this question is that TMDA can be deployed in addition to any SPAM prevention techniques that are already in use with your MTA or through procmail. Doing so will give you all of the resource benefits of other techniques but the greater SPAM blocking effectiveness of a whitelist-centric strategy. <span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><p class="line874">*** NOTE FOR SPAMASSASSIN USERS: spamassassin has a habit of marking email sent to TMDA tagged addresses as spam. This is most troublesome when it happens on a reply to a confirmation request. The solution is to add some local tests to lower the spamlevel on email to TMDA tagged addresses. This is done by adding the following to ~/.spamassassin/user_prefs: <span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><p class="line867"><span class="anchor" id="line-124"></span><pre>  header TMDA_CONFIRM To =~ /-confirm-/
<span class="anchor" id="line-125"></span>  describe TMDA_CONFIRM To a TMDA confirm address
<span class="anchor" id="line-126"></span>  score TMDA_CONFIRM -4.00
<span class="anchor" id="line-127"></span></pre><span class="anchor" id="line-128"></span><p class="line867"><span class="anchor" id="line-129"></span><pre>  header TMDA_DATED To =~ /-dated-/
<span class="anchor" id="line-130"></span>  describe TMDA_DATED To a TMDA dated address
<span class="anchor" id="line-131"></span>  score TMDA_DATED -4.00
<span class="anchor" id="line-132"></span></pre><span class="anchor" id="line-133"></span><p class="line867"><span class="anchor" id="line-134"></span><pre>  header TMDA_SENDER To =~ /-sender-/
<span class="anchor" id="line-135"></span>  describe TMDA_SENDER To a TMDA sender address
<span class="anchor" id="line-136"></span>  score TMDA_SENDER -4.00
<span class="anchor" id="line-137"></span></pre><span class="anchor" id="line-138"></span><p class="line867"><span class="anchor" id="line-139"></span><pre>  #header TMDA_KEYWORD To =~ /-keyword-/
<span class="anchor" id="line-140"></span>  #describe TMDA_KEYWORD To a TMDA keyword address
<span class="anchor" id="line-141"></span>  #score TMDA_KEYWORD -4.00
<span class="anchor" id="line-142"></span></pre><span class="anchor" id="line-143"></span><p class="line874">I've commented out the spamassassin rules for lowering the score on TMDA keyword addresses. Since anyone can use that kind of address, I still want spamassassin to take a guess at whether or not it thinks the email is spam. I provide the rules here for reference. If you want to use them just remove the # at the beginning of each line. <span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><p class="line874">Also the above rules assume that you're using the default TMDA configuration for TAGS_CONFIRM, TAGS_DATED, TAGS_KEYWORD and TAGS_SENDER. If you've modified these variables, then you should change the rules above to make sure that they match your settings. <span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><p class="line867">
<h2 id="head-07854beaf8022a9e580af271593380ab92bd8435">What software did you use to generate this FAQ?</h2>
<span class="anchor" id="line-148"></span><p class="line867"><a href="./MoinMoin.html">MoinMoin</a> <span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span><p class="line867">
<h2 id="head-03949a163c8248571a13c9cb53bd5e74fd85357d">Why the funny looking e-mail addresses? (or, advantages of tagged messages)</h2>
<span class="anchor" id="line-151"></span><p class="line874">One of the most common objections raised by those evaluating TMDA is that they don't like TMDA's tagged e-mail addresses because they "look funny". e.g, <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><p class="line867"><a class="mailto" href="mailto:jason-dated-1032297526.da8e7f@mastaler.com">jason-dated-1032297526.da8e7f@mastaler.com</a> <span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><p class="line874">instead of just: <span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><p class="line867"><a class="mailto" href="mailto:jason@mastaler.com">jason@mastaler.com</a> <span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><p class="line874">Indeed, if tagged messages didn't provide some significant advantages, there would be no need for them. Many whitelisting systems include the "cookies" within the Subject: header of the message instead of directly in the address like TMDA does. <span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><p class="line874">Consider these advantages of the tagged address method: <span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><ul><li><p class="line862">Easier and more reliable parsing of the encoded "cookies". The message will get processed correctly upon reply regardless of whether the Subject: header remains intact or not. <br />
<br />
 <span class="anchor" id="line-164"></span></li><li><p class="line862">Significant reduction in the number of legitimate senders who are actually faced with a confirmation request (see FAQ 1.5). <br />
<br />
 <span class="anchor" id="line-165"></span></li><li><p class="line862">Senders who respond to a message you send them won't have to confirm their reply, which many consider rude (see FAQ 5.5). <br />
<br />
 <span class="anchor" id="line-166"></span></li><li>Messages that you send which end up undeliverable (aka bounces) will be delivered to you and will not be quarantined by TMDA (see FAQ 5.4). <span class="anchor" id="line-167"></span></li></ul><p class="line874">None of these advantages are available without tagged addresses leading to a much less flexible system. What do you care more about, aesthetics or functionality? <span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><p class="line874">Also, when displaying a message, many mail clients (such as MS Outlook) only show the full name of the sender (e.g, Jason R. Mastaler) and hide the e-mail address itself. So, it's likely that many of your recipients won't even know that you are using a tagged address. <span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><p class="line874">Also, consider why you think a tagged address looks "funny". It's simply because this is something you are not used to seeing. If tagged messages became some sort of standard, they would no longer seem that way. In any case, your identity remains intact regardless of what your e-mail address looks like, which is what's important. People change jobs, graduate from university, lose domain name disputes, and their e-mail address changes -- but their identity remains intact. I'm `Jason R. Mastaler' regardless of whether my e-mail address includes some extra characters in it or not. <span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><p class="line862">Remember, you are not your e-mail address. And while I'm at it: You are not your job. You are not how much money you have in the bank. You are not the car you drive. You are not the contents of your wallet. You are not your fucking khakis. You are the all singing, all dancing, crap of the world. <img alt=":)" height="15" src="./mentalwealth/img/smile.png" title=":)" width="15" /> <span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><p class="line874">If I still haven't convinced you, TMDA does provide a way to lessen the "ugliness" of tagged addresses. Instead of tagging your "From:" header, some users prefer to tag "Reply-To:" instead and leave "From:" intact. This preserves your e-mail identity yet still allows the full advantages of tagged messages. The headers of such a message might look like this: <span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><p class="line867"><span class="anchor" id="line-178"></span><pre>  From: "Jason R. Mastaler" &lt;jason@mastaler.com&gt;
<span class="anchor" id="line-179"></span>  Subject: Re: Vegas Baby
<span class="anchor" id="line-180"></span>  To: bobby@peru.com
<span class="anchor" id="line-181"></span>  Date: Wed, 02 Oct 2002 11:54:27 -0600
<span class="anchor" id="line-182"></span>  Reply-To: jason-dated-1034271964.56150d@mastaler.com]
<span class="anchor" id="line-183"></span></pre><span class="anchor" id="line-184"></span><p class="line874">TMDA's outgoing filter file can fully automate this tagging process. <span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><p class="line867">
<h2 id="head-a2cbc244f22517e43bf9a023b3c9c8b4fcf7871a">What do I do when a spammer does confirm their message?</h2>
<span class="anchor" id="line-187"></span><p class="line874">First, as documented, TMDA is a SPAM _reduction_ system; there is no way to completely eliminate spam other than severing your connection to the Internet with a scissors. <span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><p class="line874">Occasionally, you will find that a piece of spam is confirmed. This is usually the result of a bounce message going to the confirmation address, telling you that the spammer's address doesn't exist or is over quota or something. <span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><p class="line874">This happens so rarely, that I tend to ignore it. Remember that the idea is to keep the confirmation process as simple as possible for the benefit of legitimate senders, while still eliminating most spam. See FAQ 1.1 for more on this point. <span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><p class="line862">If the confirmation was actually done by the spammer, a positive thing about this phenomenon is that you may now have a working contact address for them. The two useful things you can do with that information are A) report the spam message to Spamcop so that the spammer's ISP can get in touch with them about their activities, and <img alt="B-)" height="15" src="./mentalwealth/img/smile2.png" title="B-)" width="15" /> blacklist the address in your TMDA config. Make sure you remove them from your whitelist, and add them to a blacklist. <span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><p class="line874">If you are extremely sensitive to spam, TMDA provides a couple methods to make it difficult if not impossible for a spammer to use an auto-responder to confirm messages. <span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><ol type="1"><li><p class="line862">Edit confirm_request.txt and remove the Reply-To line. Now there is no address anywhere that an auto-responder can use to release the message. This means legitimate senders will have to pick out the confirm address from the body of the message instead of just hitting "Reply", so it will be slightly more inconvenient for them, but still not bad. See the TMDA Template HOWTO (<a class="http" href="http://tmda.net/howto-template.html">http://tmda.net/howto-template.html</a>) for detailed instructions on how to customize confirm_request.txt. <span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span></li><li class="gap"><p class="line862">You can use tmda-cgi's web confirmation system, which allows you to imbed a URL in confirm_request.txt that when clicked on, will release the message. This is an alternative to the traditional e-mail confirmation method. See <a class="http" href="http://tmda.net/tmda-cgi/confirm.html">http://tmda.net/tmda-cgi/confirm.html</a> for more information. <span class="anchor" id="line-200"></span></li></ol><p class="line874">More difficult confirmation methods such as using graphics files with embedded words have been suggested, but "eye-candy" of this sort is vast overkill at this point. There isn't any evidence that something like this is even close to necessary. It's also potentially harmful--the more difficult you make the challenge, the more likely it is that a legitimate sender is not going to confirm their message. <span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><p class="line867">
<h2 id="head-b01a6086f5f59c1e4486c5d1dbab72246d92e0ec">Why does TMDA run on the server instead of my mail client?</h2>
<span class="anchor" id="line-203"></span><p class="line874">I'm often asked about why TMDA is run on the server. That is, why TMDA was designed to work with the mail server software on the host that receives your incoming mail. <span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span><p class="line862">This is opposed to software which plugs into your mail client (e.g, Outlook) or a pop3 "proxy" which the end user can operate. In this scenario, TMDA would be run <em>after</em> you download your messages rather than before. <span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><p class="line874">The answer is that I don't feel the client is the correct place for TMDA to operate. <span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><p class="line874">For one, it delays sending of the confirmation requests since they would only be sent periodically when you download your mail rather than as soon as a message is received on the server. This can result in significant delays as to when you will see the confirmed messages. For example, if a sender in a distant timezone sends you a message just after you've retired for the evening, it might be 10-12 hours before you fire up your mail client for the next time, meaning 10-12 hours before that sender sees a confirmation request. By that time, she has retired for the evening, meaning an additional 10-12 hours before she can reply to the confirmation request. <span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><p class="line874">This is silly. If TMDA resides on the server, the confirmation process happens instantaneously and automatically, regardless of whether you are available at that particular time or not. <span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><p class="line874">The second reason is that it's a waste of time and bandwidth for the client to download spam messages just so they can be processed. With TMDA running on the server, the client only has to download legitimate messages. If you receive a large amount of spam, this can result in significant savings in time and cost (if you pay for your bandwidth by the byte). <span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><p class="line874">If you don't have access to your mailhost, your ISP might have to set TMDA up for you. If that isn't possible, then switch to an ISP that does allow you to set TMDA up yourself. Afterall, it's your money! <span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><p class="line874">That said, See FAQ 1.9 for a list of similar products, many of which do operate at the client level. <span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><p class="line867">
<h2 id="head-e51a2eb9423cf940f1f3e5f7c70fbb0f45de958e">What's with those goofy release names?</h2>
<span class="anchor" id="line-220"></span><p class="line874">Each TMDA release has a "codename" in addition to a version number. This serves no purpose other than to add colour to the development process. See the CODENAMES file in the distribution for more information. <span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><p class="line867">
<h2 id="head-0f049b3fdc0b8d78235d1d9acb913151e71339c4">What about challenge/response mail loops?</h2>
<span class="anchor" id="line-223"></span><p class="line874">TMDA is not vulnerable to this. See FAQ 4.12 for a complete answer. <span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><p class="line867">
<h1 id="head-56c1256385714ddebfd2c5fff3e384728e903aa9">Setup and installation</h1>
<span class="anchor" id="line-226"></span><p class="line867">
<h2 id="head-3d4d2d0a105a9d58e8e2349ff755c821aa154c0e">I'm getting errors when running 'compileall' on my RedHat Linux system</h2>
<span class="anchor" id="line-227"></span><p class="line874">Make sure you are running the minimum required version of Python (at least v2.3). <span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><p class="line867">
<h1 id="head-2c128f23dd9fd4534f2a1aa8f99aa709e3973237">Mail Transport Agent issues</h1>
<span class="anchor" id="line-230"></span><p class="line867">
<h2 id="head-5eda9e817c27598c2e5a2f7b5ab0c139520fd760">Why don't my user+detail addresses work with Sendmail virtualdomains?</h2>
<span class="anchor" id="line-231"></span><p class="line874">If you are running Sendmail, you may have noticed that your user+detail addresses don't work if the message is sent to a virtual domain. <span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><p class="line874">You need some special entries in the virtusertable (and a modern version of sendmail - at least 8.10.1 to get full functionality) to preserve the +detail portion of the address. For example, if you currently have the following in your virtusertable: <span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><p class="line867"><span class="anchor" id="line-236"></span><pre>bobby@peru.com bobby</pre><span class="anchor" id="line-237"></span><p class="line874">you can change this to: <span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><p class="line867"><span class="anchor" id="line-240"></span><pre>bobby+*@peru.com bobby+%2</pre><span class="anchor" id="line-241"></span><p class="line874">See the virtusertable section in your Sendmail's cf/README for the full details. <span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><p class="line867">
<h2 id="head-7ec01b86b88703d3bc7f5cce3d025801c853172d">Why don't my user+detail addresses work with Sendmail /etc/aliases?</h2>
<span class="anchor" id="line-244"></span><p class="line874">If you're running Sendmail, you may have noticed that your user+detail addresses don't work if the message is sent to a an alias. <span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><p class="line874">If you have the following in /etc/aliases: <span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><p class="line867"><span class="anchor" id="line-249"></span><pre>webmaster: johndoe</pre><span class="anchor" id="line-250"></span><p class="line874">+detail is preserved for mail to johndoe+detail, but not for webmaster+detail. <span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span><p class="line874">Unfortunately, there is no way to preserve the +detail portion in /etc/aliases. You must use the virtusertable for this (see previous question). <span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><p class="line867">
<h2 id="head-28d3deeba24ced7018ff39d4f8561f517a9bcdd5">I'm getting "553 sorry, that domain isn't in my list of allowed rcpthosts (#5.7.1)"</h2>
<span class="anchor" id="line-255"></span><p class="line874">If you are seeing this message in your LOGFILE_DEBUG file, you are running a very old version of TMDA. Try upgrading. <span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><p class="line867">
<h2 id="head-5a70837212b3320ec35b3aedbe2481c40d37e39a">Exim is rewriting return-path when BOUNCE_ENV_SENDER is set.</h2>
<span class="anchor" id="line-258"></span><p class="line874">If Exim3 does not find a valid user from the specified sender when TMDA feeds it the confirmation message via SMTP it will rewrite the return-path headers with the reply-to confirmation address. This will cause bounces to confirm. <span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><p class="line874">If you've set your bounce sender to something like: <span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><p class="line862">BOUNCE_ENV_SENDER = " <a class="mailto" href="mailto:spamdump@mydomain.com">spamdump@mydomain.com</a> " <span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><p class="line874">then the user "spamdump" needs to exist on the system. <span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><p class="line874">You can cause Exim to drop, or do other things with, the bounced returns using an Exim system filter. <span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><p class="line867">
<h2 id="head-93eda22a9533714e4d93da9e7bac60df959bf8f6">What is recommended for RECIPIENT_DELIMITER, '-' or '+'?</h2>
<span class="anchor" id="line-269"></span><p class="line874">The two most popular recipient delimiters are: <span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span><p class="line867"><span class="anchor" id="line-272"></span><pre>'+', as in jason+foobar@mastaler.com</pre><span class="anchor" id="line-273"></span><p class="line874">and <span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><p class="line867"><span class="anchor" id="line-276"></span><pre> '-', as in jason-foobar@mastaler.com</pre><span class="anchor" id="line-277"></span><p class="line874">qmail's default is '-', while Sendmail's is '+'. Exim and Postfix do not come with a default, but allow the administrator to choose. <span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span><p class="line874">Unfortunately, not all recipient delimiters are created equal. On the tmda-users mailing list, there have been several reports of certain mail clients that can't reply to an address containing a '+'. <span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span><ul><li>AOL Webmail client. <span class="anchor" id="line-282"></span></li><li>Lotus Notes. <span class="anchor" id="line-283"></span></li><li>MSN. <span class="anchor" id="line-284"></span></li></ul><p class="line874">There have been no such problems reported by users using '-' as their recipient delimiter. Therefore, if it's in your control, '-' is recommended. qmail, Postfix and Exim make this configurable, while Sendmail does not. <span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><p class="line867">
<h2 id="head-491815cb040f46c731bc547a0328ddfbaa56a751">How do I establish a secure connection between TMDA and my SMTP server?</h2>
<span class="anchor" id="line-287"></span><p class="line874">If your SMTP server is capable of using the starttls protocol, then you can use TMDA's SMTPSSL configuration variables to secure the connection between TMDA and the SMTP server. <span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span><p class="line874">In either /etc/tmdarc or in user specific ~/.tmda/config configuration files, set the following three variables. <span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><ul><li style="list-style-type:none">SMTPSSL = 1 <span class="anchor" id="line-292"></span></li><li style="list-style-type:none">SMTPSSL_CERTFILE = "/path/to/certificate/file" <span class="anchor" id="line-293"></span></li><li style="list-style-type:none">SMTPSSL_KEYFILE = "/path/to/private/key/file" <span class="anchor" id="line-294"></span></li></ul><p class="line874">The certificate and key can be in separate files or in the same file. You still need to set all three configuration variables in the latter case. Just point SMTPSSL_CERTFILE and SMTPSSL_KEYFILE to the same file. <span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><p class="line874">Any user running TMDA will need to have read access to both the certificate and key. <span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><p class="line874">In cases where mail accounts are virtual and are controlled by a single sytem account, the certificate and key files should be owned by the controlling system account with permissions 400. <span class="anchor" id="line-299"></span><span class="anchor" id="line-300"></span><p class="line874">In cases where multiple system accounts will run TMDA, one option is to create a supplementary group to which all TMDA users belong, and make the certificate and key readable by this group. Another option is for each TMDA user to have their own certificate and key. <span class="anchor" id="line-301"></span><span class="anchor" id="line-302"></span><p class="line867">
<h2 id="head-0bde1848548e71633a5aece80d12dfd3d244be14">I'm getting SMTPRecipientsRefused or SMTPSenderRefused errors</h2>
<span class="anchor" id="line-303"></span><p class="line874">Make sure you're running a recent version of TMDA. <span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><p class="line867">
<h2 id="head-d73181a47c68296632b2c46b4a8c113ed69c0b7e">Can I use TMDA with a qmail relay?</h2>
<span class="anchor" id="line-306"></span><p class="line874">Sure, here's how. <span class="anchor" id="line-307"></span><span class="anchor" id="line-308"></span><p class="line874">This FAQ assumes three things: <span class="anchor" id="line-309"></span><span class="anchor" id="line-310"></span><ol type="1"><li>Mail comes in from the outside Internet. <span class="anchor" id="line-311"></span></li><li>Mail passes through TMDA to check for whitelists/blacklists. <span class="anchor" id="line-312"></span></li><li>If permitted (or confirmed), the mail is forwarded to a separate server. <span class="anchor" id="line-313"></span></li></ol><p class="line874">Create a directory to be used as a holding area for TMDA, for example /var/spool/tmda . Add a new user to the system to handle incoming mail, and create the users home directory as the holding area. This FAQ will use 'tmda' as the account name. Be sure that the holding area is writeable only by the 'tmda' user. <span class="anchor" id="line-314"></span><span class="anchor" id="line-315"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-316"></span><pre>    mkdir /var/spool/tmda
<span class="anchor" id="line-317"></span>    useradd -d /var/spool/tmda tmda
<span class="anchor" id="line-318"></span>  </pre><span class="anchor" id="line-319"></span><ul><li style="list-style-type:none">Now add an entry to your /var/qmail/control/virtualdomains file like this: <span class="anchor" id="line-320"></span></li></ul><span class="anchor" id="line-321"></span><pre>    example.com:tmda
<span class="anchor" id="line-322"></span>  </pre><span class="anchor" id="line-323"></span></li></ul><p class="line874">This will send all mail for example.com to the tmda user, so that it can be handled by /var/spool/tmda/.qmail-default . Also add example.com to your /var/qmail/control/rcpthosts file. <span class="anchor" id="line-324"></span><span class="anchor" id="line-325"></span><p class="line874">Send qmail-send a HUP so that it re-reads virtualdomains. Now, set up /var/spool/tmda/.tmda/config however you like, and be sure to create a new crypt_key: <span class="anchor" id="line-326"></span><span class="anchor" id="line-327"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-328"></span><pre>    tmda-keygen -b &gt; /var/spool/tmda/.tmda/crypt_key
<span class="anchor" id="line-329"></span>    chmod 600 /var/spool/tmda/.tmda/crypt_key
<span class="anchor" id="line-330"></span>  </pre><span class="anchor" id="line-331"></span><ul><li style="list-style-type:none">Add the following to the /var/spool/tmda/.qmail file: <span class="anchor" id="line-332"></span></li></ul><span class="anchor" id="line-333"></span><pre>    |preline -f /usr/local/tmda/bin/tmda-filter
<span class="anchor" id="line-334"></span>    |forward "$DEFAULT"@exchange.example.com
<span class="anchor" id="line-335"></span>  </pre><span class="anchor" id="line-336"></span></li></ul><p class="line874">If exchange.example.com is not in DNS then you will need to add it to your smtproutes files. See the qmail-remote man page for details. <span class="anchor" id="line-337"></span><span class="anchor" id="line-338"></span><p class="line874">This also assumes that the mail server at exchange.example.com will accept mail to addresses @exchange.example.com just as it will for @example.com. If not then you can try some DNS tricks to get this to work. <span class="anchor" id="line-339"></span><span class="anchor" id="line-340"></span><p class="line874">Create a symbolic link from .qmail to .qmail-default <span class="anchor" id="line-341"></span><span class="anchor" id="line-342"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-343"></span><pre>    ln -s /var/spool/tmda/.qmail /var/spool/tmda/.qmail-default
<span class="anchor" id="line-344"></span>  </pre><span class="anchor" id="line-345"></span><ul><li style="list-style-type:none">Finally, clean up the permissions on the /var/spool/tmda directory so that TMDA has permission to create any necessary files: <span class="anchor" id="line-346"></span></li></ul><span class="anchor" id="line-347"></span><pre>    chown -R tmda /var/spool/tmda
<span class="anchor" id="line-348"></span>    chmod 700 /var/spool/tmda
<span class="anchor" id="line-349"></span>  </pre><span class="anchor" id="line-350"></span></li></ul><p class="line862">Any messages sent to <a class="mailto" href="mailto:user@example.com">user@example.com</a> will now be forwarded through to <a class="mailto" href="mailto:user@exchange.example.com">user@exchange.example.com</a> after TMDA has validated the sender. <span class="anchor" id="line-351"></span><span class="anchor" id="line-352"></span><p class="line867">
<h2 id="head-5d3c0d25c8287a9638ddddc923125f4983a3a825">Why do confirmations trigger new requests under Sendmail?</h2>
<span class="anchor" id="line-353"></span><p class="line874">You probably have an entry in your /etc/aliases for your username (see FAQ 3.2). A common mistake is to have "foo+*: foo". This used to be necessary with some older versions/configurations of sendmail, but isn't with current versions; you can just delete that line. If it's there, sendmail rewrites "foo+confirm-..." to "foo" before passing it off to procmail, so procmail has no chance of seeing the part after the "+". <span class="anchor" id="line-354"></span><span class="anchor" id="line-355"></span><p class="line867">
<h1 id="head-6d8bfafdfe6370b7f59775208e81796795ff3a87">TMDA server-side issues</h1>
<span class="anchor" id="line-356"></span><p class="line867">
<h2 id="head-63bbb3a758bdbc58536f309e078af8df6cc1b05f">How do I setup a whitelist?</h2>
<span class="anchor" id="line-357"></span><p class="line874">You can allow senders, or groups of senders directly into your mailbox by adding lines to your incoming filter file. By default this is ~/.tmda/filters/incoming. <span class="anchor" id="line-358"></span><span class="anchor" id="line-359"></span><p class="line862">For example, the following line will allow both <a class="mailto" href="mailto:anyone@domain.dom">anyone@domain.dom</a> and <a class="mailto" href="mailto:anyone@sub.domain.dom">anyone@sub.domain.dom</a> into your mailbox: <span class="anchor" id="line-360"></span><span class="anchor" id="line-361"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-362"></span><pre>        from *@=domain.dom ok
<span class="anchor" id="line-363"></span>  </pre><span class="anchor" id="line-364"></span></li></ul><p class="line874">If you have many individual addresses and/or expressions you'd like to whitelist, you may keep them in a seperate file and then have TMDA access it using the following line: <span class="anchor" id="line-365"></span><span class="anchor" id="line-366"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-367"></span><pre>        from-file ~/.tmda/lists/whitelist ok
<span class="anchor" id="line-368"></span>  </pre><span class="anchor" id="line-369"></span><ul><li style="list-style-type:none">~/.tmda/lists/whitelist would contain e-mail addresses and/or wildcard expressions, one per line. e.g, <span class="anchor" id="line-370"></span></li></ul><span class="anchor" id="line-371"></span><pre>        [mailto:king@grassland.com king@grassland.com]
<span class="anchor" id="line-372"></span>        *@myisp.net
<span class="anchor" id="line-373"></span>        *@cs.myuni.edu
<span class="anchor" id="line-374"></span>        *@=mycompany.com
<span class="anchor" id="line-375"></span>        bobby*@peru.com
<span class="anchor" id="line-376"></span>  </pre><span class="anchor" id="line-377"></span></li></ul><p class="line874">See the TMDA Filter Specification for details on filter file syntax, options, and more examples. The collectaddys script in the contrib directory can be used to build an initial whitelist from your existing mail archives. <span class="anchor" id="line-378"></span><span class="anchor" id="line-379"></span><p class="line867">
<h2 id="head-0b1aee3c2decf32a26ffcc12b397f9d3cec3fdc0">How do I setup an "auto-whitelist"?</h2>
<span class="anchor" id="line-380"></span><p class="line874">TMDA has the ability to automagically add confirmed addresses to a whitelist. This way, each new sender only has to go through the confirmation process once. <span class="anchor" id="line-381"></span><span class="anchor" id="line-382"></span><p class="line874">If you want that behavior, set the CONFIRM_APPEND variable in your ~/.tmdarc to point to a file, something like: <span class="anchor" id="line-383"></span><span class="anchor" id="line-384"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-385"></span><pre>        CONFIRM_APPEND = os.path.expanduser("~/.tmda/lists/whitelist_confirmed")
<span class="anchor" id="line-386"></span>  </pre><span class="anchor" id="line-387"></span><ul><li style="list-style-type:none">and add a rule to your incoming filter: <span class="anchor" id="line-388"></span></li></ul><span class="anchor" id="line-389"></span><pre>        from-file ~/.tmda/lists/whitelist_confirmed ok
<span class="anchor" id="line-390"></span>  </pre><span class="anchor" id="line-391"></span></li></ul><p class="line874">Then TMDA will the add the senders from successfully confirmed messages to the 'whitelist_confirmed' file. A possible variation on this includes setting CONFIRM_APPEND to your main whitelist file rather than a secondary file. <span class="anchor" id="line-392"></span><span class="anchor" id="line-393"></span><p class="line867">
<h2 id="head-e641fa61a130efa1d7836ab8ded1f3857da74b79">How can I manage messages in my pending queue?</h2>
<span class="anchor" id="line-394"></span><p class="line862">TMDA comes with a utility called 'tmda-pending' which can be used to release, delete, view, and generally manipulate messages in your pending queue. You can run it by hand, or periodically from cron. Run <em>tmda-pending -h</em> to get a listing of available options and usage examples. tmda-pending should be run by the user account that owns the pending queue, not by root (unless root is running TMDA). <span class="anchor" id="line-395"></span><span class="anchor" id="line-396"></span><p class="line874">There is also a web-utility called 'tmda-cgi' for managing your pending queue (among other things). <span class="anchor" id="line-397"></span><span class="anchor" id="line-398"></span><p class="line862">If you'd prefer an e-mail interface for pending queue management, check out tmda-ezplm (<a class="http" href="http://www.pongonova.net/tmda-ezplm">http://www.pongonova.net/tmda-ezplm</a>). <span class="anchor" id="line-399"></span><span class="anchor" id="line-400"></span><p class="line862">Additionally, your can make your pending queue a Maildir, which, as an industry standard format, allows you to use any program that supports Maildir to browse, search, index, etc, your pending queue. For more information, see <a href="./TmdaPendingAsMaildir.html">TmdaPendingAsMaildir</a>. <span class="anchor" id="line-401"></span><span class="anchor" id="line-402"></span><p class="line874">The most common question about the pending queue is how old messages get purged. As of TMDA 0.77, this is done automatically for you with no intervention required. <span class="anchor" id="line-403"></span><span class="anchor" id="line-404"></span><p class="line862">The default cleanup interval is approximately once per 100 incoming messages received. To tweak this interval, or disable this feature entirely, see <a class="http" href="http://tmda.net/config-vars.html#PENDING_CLEANUP_ODDS">PENDING_CLEANUP_ODDS</a>. When this feature is enabled, the default lifetime for a message in the pending queue is 14 days. Any message older than 14 days will be deleted. If you wish to raise or lower this threshold, see <a class="http" href="http://tmda.net/config-vars.html#PENDING_LIFETIME">PENDING_LIFETIME</a> <span class="anchor" id="line-405"></span><span class="anchor" id="line-406"></span><p class="line874">Here's an example of using tmda-pending in "batch" mode to write scripts which will manipulate your pending queue. <span class="anchor" id="line-407"></span><span class="anchor" id="line-408"></span><p class="line867"><span class="anchor" id="line-409"></span><pre>tmda-pending -Cbs -O 48h | /usr/bin/mail -s "TMDA new in pending" \
<span class="anchor" id="line-410"></span>  you@yourdomain.dom &gt; /dev/null 2&gt;&amp;1</pre><span class="anchor" id="line-411"></span><p class="line874">What this will do is print a summary of any emails that have been in pending for 48h to see if an email has turned up in pending and if it hasn't been confirmed w/in 48h. Additionally, because of the "-C" option, each new email will only be shown once. <span class="anchor" id="line-412"></span><span class="anchor" id="line-413"></span><p class="line867">
<h2 id="head-1f4e50d4114173300c4a7a63ce81a845770f06ee">How do I allow my ezmlm mailing lists to pass through TMDA?</h2>
<span class="anchor" id="line-414"></span><p class="line874">ezmlm sends out each list message with a different envelope sender address. <span class="anchor" id="line-415"></span><span class="anchor" id="line-416"></span><p class="line874">You can whitelist the ezmlm list using wildcard characters. Here is an example whitelist entry for the qmail mailing list: <span class="anchor" id="line-417"></span><span class="anchor" id="line-418"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-419"></span><pre>        qmail-return-*@list.cr.yp.to
<span class="anchor" id="line-420"></span>  </pre><span class="anchor" id="line-421"></span></li></ul><p class="line874">This will allow messages to get through when initially interacting with ezmlm to get subscribed, as well as after when list messages are delivered. <span class="anchor" id="line-422"></span><span class="anchor" id="line-423"></span><p class="line867">
<h2 id="head-a1ebf1fc86489c6637f8a977679a6f1a83b26d17">How do I prevent my auto-whitelist from being filled with 'dated' addresses?</h2>
<span class="anchor" id="line-424"></span><p class="line874">If you are using TMDA's CONFIRM_APPEND feature to implement an "auto-whitelist", you may have noticed that it is being filled with the 'dated' addresses of other TMDA users, which isn't very helpful. This can be disconcerting to the other party who must confirm each of their messages to you. <span class="anchor" id="line-425"></span><span class="anchor" id="line-426"></span><p class="line862">Recent versions of TMDA recognize the <em>X-Primary-Address</em> header in incoming messages. See <a class="http" href="http://tmda.net/config-vars.html#PRIMARY_ADDRESS_MATCH">http://tmda.net/config-vars.html#PRIMARY_ADDRESS_MATCH</a> for more on this feature. <span class="anchor" id="line-427"></span><span class="anchor" id="line-428"></span><p class="line874">So, TMDA users should configure their MUA to add an X-Primary-Address address field to their outgoing messages specifying the address they prefer be added to other user's whitelists. e.g, <span class="anchor" id="line-429"></span><span class="anchor" id="line-430"></span><p class="line862">X-Primary-Address: <a class="mailto" href="mailto:jason@mastaler.com">jason@mastaler.com</a> <span class="anchor" id="line-431"></span><span class="anchor" id="line-432"></span><p class="line874">If you use tmda-sendmail or tmda-ofmipd to send your outgoing mail, you can do this with an ADDED_HEADERS_CLIENT entry in your ~/.tmda/config. e.g, <span class="anchor" id="line-433"></span><span class="anchor" id="line-434"></span><p class="line867"><span class="anchor" id="line-435"></span><pre>ADDED_HEADERS_CLIENT = {'X-Primary-Address' : 'jason@mastaler.com'} </pre><span class="anchor" id="line-436"></span><p class="line862">Now, <a class="mailto" href="mailto:jason@mastaler.com">jason@mastaler.com</a> will be whitelisted upon confirmation, whether I'm using a 'dated' address or not. <span class="anchor" id="line-437"></span><span class="anchor" id="line-438"></span><p class="line867">
<h2 id="head-4a53cd024ccf7b739aa0310553a4ed898c658974">Which address headers are examined when looking for a filter match?</h2>
<span class="anchor" id="line-439"></span><p class="line874">For each incoming message, TMDA compares addresses in the message to rules in your FILTER_INCOMING file (e.g, ~/.tmda/filters/incoming) to try and find a match. <span class="anchor" id="line-440"></span><span class="anchor" id="line-441"></span><p class="line874">for from* rules, all addresses in the "From:" and "Reply-To:" headers are matched, as well as the envelope sender address (often stored in Return-Path, but TMDA gets it from the environment variable $SENDER). <span class="anchor" id="line-442"></span><span class="anchor" id="line-443"></span><p class="line874">For to* rules, only the envelope recipient is matched. Some MTAs put that in Delivered-To, but others don't. TMDA gets this from the environment variable $RECIPIENT. <span class="anchor" id="line-444"></span><span class="anchor" id="line-445"></span><p class="line867">
<h2 id="head-2f0fc68e5357f633123128481b6f4642279b6957">How do I prevent my postmaster from getting all my bounced confirmation requests?</h2>
<span class="anchor" id="line-446"></span><p class="line862">Since the vast majority of spam is sent from a non-working address, most of your confirmation requests will be returned right back to you as undeliverable. Since TMDA's confirmation requests are sent out with a null '&lt;&gt;' Return-Path by default, your local postmaster will probably receive these bounces. <span class="anchor" id="line-447"></span><span class="anchor" id="line-448"></span><p class="line862">If you want to avoid this, the trick is to set BOUNCE_ENV_SENDER to something that goes nowhere (e.g, <a class="mailto" href="mailto:thl-spambounce@catseye.net">thl-spambounce@catseye.net</a> ). Then, when TMDA generates the confirmation request, it uses that address as the envelope sender instead of '&lt;&gt;'. <span class="anchor" id="line-449"></span><span class="anchor" id="line-450"></span><p class="line874">You'll also need a rule in your incoming filter that says: <span class="anchor" id="line-451"></span><span class="anchor" id="line-452"></span><p class="line867"><span class="anchor" id="line-453"></span><pre>to thl-spambounce@catseye.net drop</pre><span class="anchor" id="line-454"></span><p class="line874">so that any mail that bounces (and therefore gets returned to thl-spambounce) will be automatically dropped. <span class="anchor" id="line-455"></span><span class="anchor" id="line-456"></span><p class="line862">See <a class="http" href="http://tmda.net/config-vars.html#BOUNCE_ENV_SENDER">http://tmda.net/config-vars.html#BOUNCE_ENV_SENDER</a> <span class="anchor" id="line-457"></span><span class="anchor" id="line-458"></span><p class="line867">
<h2 id="head-3ff58b75db7c81e71011ddd9f2dc7779f1bf703a">How do I use TMDA with mailing lists?</h2>
<span class="anchor" id="line-459"></span><p class="line874">Most of us have stopped integrating TMDA with mailing lists. <span class="anchor" id="line-460"></span><span class="anchor" id="line-461"></span><p class="line874">TMDA does provide the ability to accept mailing list messages as well as deliver them in a number of different ways, and to multiple locations, sort of like a scaled down procmail. However, if you aren't using this advanced functionality, I wouldn't bother. <span class="anchor" id="line-462"></span><span class="anchor" id="line-463"></span><p class="line874">Filtering your list traffic with TMDA will just necessitate extra time fiddling with your whitelist and/or creating keyword/sender addresses, and possibly cause delay in your seeing the messages if they end up stuck in your pending queue because of a misconfiguration. <span class="anchor" id="line-464"></span><span class="anchor" id="line-465"></span><p class="line874">Since TMDA doesn't filter based on content, it can't help you with spam on the list anyway. Once the spam gets distributed to the list, it's now just another list message as far as TMDA is concerned. <span class="anchor" id="line-466"></span><span class="anchor" id="line-467"></span><p class="line862">Instead, either use <a class="http" href="http://gmane.org">Gmane</a>, or subscribe to lists with extension addresses that aren't handled by TMDA. I use the &lt;user&gt;-list-&lt;whatever&gt;@foo.dom convention. If you use procmail or maildrop, have your list traffic delivered before TMDA sees it. <span class="anchor" id="line-468"></span><span class="anchor" id="line-469"></span><p class="line874">That said, if you still want to mix TMDA with your mailing lists, here are some documents on the subject that might help. <span class="anchor" id="line-470"></span><span class="anchor" id="line-471"></span><ul><li><p class="line862">Tim Legant's <a class="http" href="http://permalink.gmane.org/gmane.mail.spam.tmda.user/4280">Cookbook for using TMDA with mailing lists</a><br />
 <span class="anchor" id="line-472"></span></li><li><p class="line862">Andrew St. Jean's <a class="http" href="http://www.arda.homeunix.net/mailinglists.html">TMDA &amp; Mailing Lists HOWTO</a> <span class="anchor" id="line-473"></span></li></ul><p class="line867">
<h2 id="head-db9777e65be1afd08979afc00eecb8b8baccd5de">How can I use customized templates for TMDA's auto-responses?</h2>
<span class="anchor" id="line-474"></span><p class="line862">See the TMDA Template HOWTO at <a class="http" href="http://wiki.tmda.net/TmdaOfmipdHowto">http://wiki.tmda.net/TmdaOfmipdHowto</a> <span class="anchor" id="line-475"></span><span class="anchor" id="line-476"></span><p class="line867">
<h2 id="head-e81137818ea55d7e15d5822687715793af7062ea">SPAM is getting in by spoofing my domain.</h2>
<span class="anchor" id="line-477"></span><p class="line874">Occasionally you will receive spam coming from your own e-mail address, or an address within your domain. e.g, <span class="anchor" id="line-478"></span><span class="anchor" id="line-479"></span><p class="line867"><span class="anchor" id="line-480"></span><pre>Date: Sun Nov 9 20:21:11 CST 2003
<span class="anchor" id="line-481"></span>From: "al" &lt;jason@mastaler.com&gt;
<span class="anchor" id="line-482"></span>To: jason@mastaler.com
<span class="anchor" id="line-483"></span>Subj: Get Free shipping! Curn like a porno star!
<span class="anchor" id="line-484"></span>Actn: CONFIRM action_incoming</pre><span class="anchor" id="line-485"></span><p class="line874">If the spam got through, this is most likely because you have whitelisted your own address, and/or your entire domain. <span class="anchor" id="line-486"></span><span class="anchor" id="line-487"></span><p class="line874">Most MTAs have ways of handling this problem before the message even reaches TMDA. For example, if the message claims to be from a local address, but isn't being relayed from a machine on your network, the message can be rejected or discarded as a forgery. <span class="anchor" id="line-488"></span><span class="anchor" id="line-489"></span><p class="line874">In Postfix, I accomplish this using the following configuration: <span class="anchor" id="line-490"></span><span class="anchor" id="line-491"></span><p class="line874">In main.cf, <span class="anchor" id="line-492"></span><span class="anchor" id="line-493"></span><p class="line867"><span class="anchor" id="line-494"></span><pre>smtpd_recipient_restrictions =
<span class="anchor" id="line-495"></span>          permit_mynetworks,
<span class="anchor" id="line-496"></span>          check_sender_access hash:/etc/postfix/sender_checks,
<span class="anchor" id="line-497"></span>          [...]</pre><span class="anchor" id="line-498"></span><p class="line874">And then in /etc/postfix/sender_checks: <span class="anchor" id="line-499"></span><span class="anchor" id="line-500"></span><p class="line867"><span class="anchor" id="line-501"></span><pre>jason@mastaler.com DISCARD</pre><span class="anchor" id="line-502"></span><p class="line862">So the 'permit_mynetworks' setting takes precedence and allows me to send mail from <a class="mailto" href="mailto:jason@mastaler.com">jason@mastaler.com</a> as long as I'm doing so from within my network. Other attempts (obviously forgeries) are discarded. I DISCARD rather than REJECT, because otherwise I'd get back the rejection messages which would sort of defeat the purpose. <span class="anchor" id="line-503"></span><span class="anchor" id="line-504"></span><p class="line874">Sendmail and Exim (see FAQ 7.5 for one solution) likely have similar solutions. <span class="anchor" id="line-505"></span><span class="anchor" id="line-506"></span><p class="line862">If you are using qmail, Lou Hevly <a class="http" href="http://permalink.gmane.org/gmane.mail.spam.tmda.user/5746">describes the Spamcontrol patch</a> which allows you to add your address to ./badmailfrom and still send mail to yourself and others on your server. <span class="anchor" id="line-507"></span><span class="anchor" id="line-508"></span><p class="line862">Jesse Guardiani has also <a class="http" href="http://permalink.gmane.org/gmane.mail.spam.tmda.user/10856">written a script for qmail</a> that blocks forged messages claiming to originate from a local domain. <span class="anchor" id="line-509"></span><span class="anchor" id="line-510"></span><p class="line874">If for whatever reason you are not able to address this with your MTA, and are forced to deal with it with TMDA only, the simple solution is to not wildcard your domain. Instead, add each individual address to your whitelist, so spam coming from a random address in your domain won't get through. <span class="anchor" id="line-511"></span><span class="anchor" id="line-512"></span><p class="line874">For example, in your incoming filter file you could have: <span class="anchor" id="line-513"></span><span class="anchor" id="line-514"></span><p class="line867"><span class="anchor" id="line-515"></span><pre>from-file /root/local.emails.txt accept
<span class="anchor" id="line-516"></span># drop messages forged from local addresses as local.emails.txt above
<span class="anchor" id="line-517"></span># catches all valid ones
<span class="anchor" id="line-518"></span>from *@=yourdomain.dom drop
<span class="anchor" id="line-519"></span></pre><span class="anchor" id="line-520"></span><p class="line874">Where local.emails.txt is a list of local email addresses generated by a small script that tallies valid user accounts and mail aliases on the system. <span class="anchor" id="line-521"></span><span class="anchor" id="line-522"></span><p class="line874">Also, don't whitelist your own address. When you need to send mail to yourself, Bcc: the message to a keyword address, an extension address which is not TMDA-protected, or one which you have granted access to in your incoming filter. e.g, <span class="anchor" id="line-523"></span><span class="anchor" id="line-524"></span><p class="line867"><span class="anchor" id="line-525"></span><pre>to jason-inbox@mastaler.com accept</pre><span class="anchor" id="line-526"></span><p class="line862">Mark Horn wrote a script to make use of TMDA's FINGERPRINT system. See <a href="./TmdaFingerprint.html">TmdaFingerprint</a>. <span class="anchor" id="line-527"></span><span class="anchor" id="line-528"></span><p class="line874">Again though, the MTA is a better place to address this problem. <span class="anchor" id="line-529"></span><span class="anchor" id="line-530"></span><p class="line867">
<h2 id="head-fd37af2075b1b0c520bd8df85887bd2fec94924f">IOError: /home/foo/.tmda/pending/1024366714.22692.msg has no Return-Path header!</h2>
<span class="anchor" id="line-531"></span><p class="line874">Starting with TMDA version 0.48, incoming messages must be given a Return-Path header to record the envelope sender address. This is later used for things like the CONFIRM_APPEND feature. <span class="anchor" id="line-532"></span><span class="anchor" id="line-533"></span><p class="line874">So, if your MTA has not been configured to do this, you'll notice the following type of error being raised in your LOGFILE_DEBUG when someone replies to a confirmation request: <span class="anchor" id="line-534"></span><span class="anchor" id="line-535"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-536"></span><pre>   Uncaught Python 2.2.1 exception (Thu Jun 20 04:07:21 2002 UTC):
<span class="anchor" id="line-537"></span>   ---------------------------------------------------------------
<span class="anchor" id="line-538"></span>   Traceback (most recent call last):
<span class="anchor" id="line-539"></span>     File "/usr/local/tmda/bin/tmda-filter", line 50, in ?
<span class="anchor" id="line-540"></span>       execfile(os.path.join(execdir, 'tmda-rfilter'))
<span class="anchor" id="line-541"></span>     File "/usr/local/tmda/bin/tmda-rfilter", line 675, in ?
<span class="anchor" id="line-542"></span>       main()
<span class="anchor" id="line-543"></span>     File "/usr/local/tmda/bin/tmda-rfilter", line 607, in main
<span class="anchor" id="line-544"></span>       verify_confirm_cookie(cookie_value)
<span class="anchor" id="line-545"></span>     File "/usr/local/tmda/bin/tmda-rfilter", line 386, in verify_confirm_cookie
<span class="anchor" id="line-546"></span>       raise IOError, \
<span class="anchor" id="line-547"></span>   IOError: /home/foo/.tmda/pending/1024366714.22692.msg has no Return-Path header!
<span class="anchor" id="line-548"></span>  </pre><span class="anchor" id="line-549"></span><ul><li style="list-style-type:none">If you use qmail, make sure that tmda-filter is invoked with 'preline' from your dot-qmail. e.g, <span class="anchor" id="line-550"></span></li></ul><span class="anchor" id="line-551"></span><pre>    |preline /usr/bin/tmda-filter
<span class="anchor" id="line-552"></span>  </pre><span class="anchor" id="line-553"></span></li></ul><p class="line862">Exim users must configure Exim to add a Return-Path header to messages from their address_pipe transport. See the <a href="./PreConfiguration.html">PreConfiguration</a> page for more details. <span class="anchor" id="line-554"></span><span class="anchor" id="line-555"></span><p class="line867">
<h2 id="head-ee35633e2369946da0d2496b4600b7411ec8be50">What happens when two TMDA installations interact? Lost mail? Mail loops?</h2>
<span class="anchor" id="line-556"></span><p class="line874">A common worry is that when TMDA user X sends mail to TMDA user Y, Y's confirmation request will be stuck in X's pending queue, and neither party will be aware of the exchange. <span class="anchor" id="line-557"></span><span class="anchor" id="line-558"></span><p class="line874">If X uses his common sense, this won't happen. He should simply make sure his message is repliable using one of TMDA's client-side options (see FAQ 5.5). TMDA auto-replies to the envelope sender of the message as all standards-compliant auto-responders should, so even if you don't want to tag your "From:" or "Reply-To" address, you should tag your envelope sender address. FAQ 5.4 details how to do tag your messages using a 'dated' envelope sender address. <span class="anchor" id="line-559"></span><span class="anchor" id="line-560"></span><p class="line874">Another common worry is that two TMDA installations will create a mail loop as they send confirmation requests back and forth. This will not happen, as TMDA is configured to not respond if the message contains identifying characteristics of a mailing list message, bounce message, or auto-response such as the vacation program (or another TMDA message!). Even if this fails, the mail-loop will be stopped by TMDA's auto-response rate-limiting feature that puts a ceiling on the number of messages it sends to a given address in a day. <span class="anchor" id="line-561"></span><span class="anchor" id="line-562"></span><p class="line867">
<h2 id="head-cff906f6d9dee1999169748dbb80f9bfd53829aa">How is the "responses" directory cleaned out?</h2>
<span class="anchor" id="line-563"></span><p class="line874">'responses' cleans itself out. At any given time, it only contains the auto-responses generated by TMDA during the last 24 hours. <span class="anchor" id="line-564"></span><span class="anchor" id="line-565"></span><p class="line867">
<h2 id="head-1032515a4ad4dead0c179217f9e3c9221f885cad">Why aren't confirmed/released messages deleted from pending?</h2>
<span class="anchor" id="line-566"></span><p class="line874">They are. You must be using an old version of TMDA. <span class="anchor" id="line-567"></span><span class="anchor" id="line-568"></span><p class="line867">
<h1 id="head-10c272d831cbf241cfb9ca58136d425577ca3bb6">TMDA client-side issues</h1>
<span class="anchor" id="line-569"></span><p class="line867">
<h2 id="head-dc63370afd96fceb9526ad5677a343c0c2306601">Can I send tagged messages with a non-Unix client like Microsoft Outlook?</h2>
<span class="anchor" id="line-570"></span><p class="line862">Yes. The tmda-ofmipd program included with TMDA will allow any mail client capable of SMTP Authentication to send tagged mail. This includes most non-Unix clients. For complete information, see <a class="http" href="http://wiki.tmda.net/TmdaOfmipdHowto">http://wiki.tmda.net/TmdaOfmipdHowto</a> <span class="anchor" id="line-571"></span><span class="anchor" id="line-572"></span><p class="line867">
<h2 id="head-4ca407c9f1ebe05cbc3432ef8cb249064231a4e6">My MUA doesn't support a /usr/sbin/sendmail interface. Can I still tag my outgoing messages?</h2>
<span class="anchor" id="line-573"></span><p class="line862">Some MUAs don't support a sendmail command-line interface to send mail, but rather use direct SMTP only. These include Mozilla, as well as most all non-Unix mail clients. The answer is to use the tmda-ofmipd program to send your outgoing mail. See <a class="http" href="http://wiki.tmda.net/TmdaOfmipdHowto">http://wiki.tmda.net/TmdaOfmipdHowto</a> <span class="anchor" id="line-574"></span><span class="anchor" id="line-575"></span><p class="line867">
<h2 id="head-350d18c264966d0845d743050809120cbb9a846e">Can I post to a TMDA protected mailing list with a 'dated' address?</h2>
<span class="anchor" id="line-576"></span><p class="line874">You may have noticed that every time you post to a TMDA protected mailing list (such as tmda-users) with a 'dated' address you are asked to confirm. <span class="anchor" id="line-577"></span><span class="anchor" id="line-578"></span><p class="line874">TMDA will allow your post through if you are posting from the same address that you are subscribed with, or if your address matches a global "whitelist". Otherwise, you confirm your post, and that address is whitelisted so that future posts will go right through. <span class="anchor" id="line-579"></span><span class="anchor" id="line-580"></span><p class="line862">If you wish to continue posting to the list with a 'dated' address, you can use the 'tag' outgoing action documented at <a class="http" href="http://tmda.net/config-filter.html">http://tmda.net/config-filter.html</a>. For example, <span class="anchor" id="line-581"></span><span class="anchor" id="line-582"></span><p class="line867"><span class="anchor" id="line-583"></span><pre>to tmda-users@tmda.nett tag
<span class="anchor" id="line-584"></span>     # Make sure envelope matches your subscribed address.
<span class="anchor" id="line-585"></span>     envelope ext=list-tmda-users
<span class="anchor" id="line-586"></span>     from dated</pre><span class="anchor" id="line-587"></span><p class="line867">
<h2 id="head-34a40b5885eb37712190ffceed35a85008d2448b">How can I make sure undeliverable bounces get returned to me?</h2>
<span class="anchor" id="line-588"></span><p class="line874">When you send an outgoing message, you'd like to make sure that if the message is returned as undeliverable, it is delivered to you, and not challenged. <span class="anchor" id="line-589"></span><span class="anchor" id="line-590"></span><p class="line862">Such bounces are send with a null &lt;&gt; envelope sender address, so some users whitelist them with the following line in their FILTER_INCOMING: <span class="anchor" id="line-591"></span><span class="anchor" id="line-592"></span><p class="line867"><span class="anchor" id="line-593"></span><pre>from &lt;&gt; ok</pre><span class="anchor" id="line-594"></span><p class="line862">The problem with this is that spammers sometimes send junk-mail from &lt;&gt;. <span class="anchor" id="line-595"></span><span class="anchor" id="line-596"></span><p class="line862">It also isn't sufficient to just whitelist <a class="mailto" href="mailto:mailer-daemon@yourhost.dom">mailer-daemon@yourhost.dom</a> , as some bounces will be returned from the receiving host's SMTP server instead (e.g, <a class="mailto" href="mailto:mailer-daemon@remoteserv.dom">mailer-daemon@remoteserv.dom</a> ). You could then whitelist mailer-daemon@*, but again some spammers send junk-mail from mailer-daemon addresses. Also, some MTAs might not send bounces from "mailer-daemon". <span class="anchor" id="line-597"></span><span class="anchor" id="line-598"></span><p class="line874">The best solution is to use TMDA's client-side features to tag your outgoing mail with a 'dated' envelope sender address. The envelope sender address is the address where bounces will be returned, so despite what your "From:" address is, you will still get back bounces. <span class="anchor" id="line-599"></span><span class="anchor" id="line-600"></span><p class="line874">You can do this easily using the 'tag' option in your FILTER_OUTGOING file. For example, I have the following in mine: <span class="anchor" id="line-601"></span><span class="anchor" id="line-602"></span><p class="line867"><span class="anchor" id="line-603"></span><pre>## use my bare address and a dated envelope (to catch bounces) with
<span class="anchor" id="line-604"></span>## whitelisted recipients
<span class="anchor" id="line-605"></span>to-file ~/.tmda/lists/whitelist tag envelope dated=10d from bare
<span class="anchor" id="line-606"></span>to-file ~/.tmda/lists/wildcards tag envelope dated=10d from bare</pre><span class="anchor" id="line-607"></span><p class="line867">
<h2 id="head-4f82a55edd615a8cb6983f2977ac1dcb5a03f24d">When someone replies to my messages, will they get challenged?</h2>
<span class="anchor" id="line-608"></span><p class="line874">No. TMDA provides several methods which safely allow replies to your mail messages to pass through unchallenged. This is advantageous because it reduces traffic and the number of confirmation requests to a bare minimum. If you play your cards right, the people you e-mail with will never even know your mailbox is protected by TMDA. <span class="anchor" id="line-609"></span><span class="anchor" id="line-610"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-611"></span><span class="anchor" id="line-612"></span><p class="line867">
<h3 id="head-d1e214e0cc05b61a4dc218ee249a8c77a1213f8e">With tagged addresses:</h3>
<span class="anchor" id="line-613"></span><p class="line862">If you make the <tt>dated</tt> tagged address type your default when you send outgoing messages via tmda-sendmail or tmda-ofmipd, their response will go through unhindered if it arrives within the timeout interval (default is 5 days, but can be customized). <span class="anchor" id="line-614"></span><span class="anchor" id="line-615"></span><p class="line874">TMDA can be also be configured to automatically add recipients to your whitelist as you send the message using the BARE_APPEND setting. <span class="anchor" id="line-616"></span><span class="anchor" id="line-617"></span><p class="line874">However, this isn't as reliable as using a dated address, as often the recipient will respond from a different address than you sent to. <span class="anchor" id="line-618"></span><span class="anchor" id="line-619"></span><p class="line874">Perhaps the best of both worlds is to use a 'dated' Reply-To address for unknown recipients, but also append their address to your whitelist. The example below shows how you might do this. <span class="anchor" id="line-620"></span><span class="anchor" id="line-621"></span><p class="line874">First, in ~/.tmda/config: <span class="anchor" id="line-622"></span><span class="anchor" id="line-623"></span><p class="line867"><span class="anchor" id="line-624"></span><pre>BARE_APPEND = os.path.expanduser("~/.tmda/lists/whitelist")</pre><span class="anchor" id="line-625"></span><p class="line874">Next, in ~/.tmda/filters/outgoing: <span class="anchor" id="line-626"></span><span class="anchor" id="line-627"></span><p class="line867"><span class="anchor" id="line-628"></span><pre># Use my bare address and a dated envelope (to catch bounces) with
<span class="anchor" id="line-629"></span># whitelisted recipients
<span class="anchor" id="line-630"></span>to-file ~/.tmda/lists/whitelist tag envelope dated=10d from bare</pre><span class="anchor" id="line-631"></span><p class="line867"><span class="anchor" id="line-632"></span><pre># Catch-all rule for addresses that are not yet on the whitelist.
<span class="anchor" id="line-633"></span># Use a dated envelope (to catch bounces), a dated Reply-To for safe
<span class="anchor" id="line-634"></span># measure, and also append the recipient's address to the whitelist.
<span class="anchor" id="line-635"></span>to * tag envelope dated=10d reply-to dated from bare=append</pre><span class="anchor" id="line-636"></span><p class="line874">Of course, make sure you are checking the whitelist file on incoming messages. In ~/.tmda/filters/incoming: <span class="anchor" id="line-637"></span><span class="anchor" id="line-638"></span><p class="line867"><span class="anchor" id="line-639"></span><pre>from-file ~/.tmda/lists/whitelist ok</pre><span class="anchor" id="line-640"></span><p class="line867">
<h3 id="head-c2c80e60c227da786b2eb22a84ce356076aaf1b9">Without tagged addresses:</h3>
<span class="anchor" id="line-641"></span><p class="line874">If you are opposed to using dated address in your outgoing messages (as some users are), then there is another technique that will help. <span class="anchor" id="line-642"></span><span class="anchor" id="line-643"></span><p class="line862">Every mail message you send has a unique <tt>Message-ID</tt> in the header that identifies that message. e.g, <span class="anchor" id="line-644"></span><span class="anchor" id="line-645"></span><p class="line867"><span class="anchor" id="line-646"></span><pre>Message-ID: &lt;hh7kaoldcj.fsf@hrothgar.la.mastaler.com&gt;</pre><span class="anchor" id="line-647"></span><p class="line862">When people reply to that message, their mail client includes this Message-ID in one or more new headers, <tt>References</tt>, and/or <tt>In-Reply-To</tt>, e.g: <span class="anchor" id="line-648"></span><span class="anchor" id="line-649"></span><p class="line867"><span class="anchor" id="line-650"></span><pre>In-Reply-To: &lt;hh7kaoldcj.fsf@hrothgar.la.mastaler.com&gt; ("Jason R.
<span class="anchor" id="line-651"></span>     Mastaler"'s message of "Mon, 24 Mar 2003 13:27:24 -0700")</pre><span class="anchor" id="line-652"></span><p class="line874">TMDA can read these headers. The idea is to have TMDA accept messages which contain one of your Message-IDs in their 'References' or 'In-Reply-To' headers. This is proof that the reply is to a message that you sent, and therefore legitimate. <span class="anchor" id="line-653"></span><span class="anchor" id="line-654"></span><p class="line862">You can use <tt>headers</tt> or <tt>headers-file</tt> lines in your incoming filter file to accomplish this. For example, <span class="anchor" id="line-655"></span><span class="anchor" id="line-656"></span><p class="line867"><span class="anchor" id="line-657"></span><pre># Accept replies to messages I've sent.
<span class="anchor" id="line-658"></span>headers '^In-Reply-To:(.|\n)*&lt;.*@hrothgar\.la\.mastaler\.com&gt;' ok
<span class="anchor" id="line-659"></span>headers '^References:(.|\n)*&lt;.*@hrothgar\.la\.mastaler\.com&gt;' ok</pre><span class="anchor" id="line-660"></span><p class="line874">This strategy seems simple, but it works, and there is no evidence that spammers are including valid Message-IDs along with the spam that they send you. <span class="anchor" id="line-661"></span><span class="anchor" id="line-662"></span><p class="line874">NOTE: make sure that the string you use in your Message-IDs is not a valid hostname that a spammer could send mail to. In my case, 'hrothgar.la.mastaler.com' is not a real Internet hostname, so it works perfectly. <span class="anchor" id="line-663"></span><span class="anchor" id="line-664"></span><p class="line862">If you find that your user-agent is generating Message-IDs with a valid hostname and doesn't allow you to customize this, you can use <a class="http" href="http://tmda.net/config-vars.html#TMDAINJECT">TMDAINJECT</a> to override the Message-ID of your outgoing messages with the string of your choice. For example, if you wanted your Message-IDs to contain the string <tt>@foo.bar.yourdomain.dom</tt>, you'd add the following lines to your ~/.tmda/config: <span class="anchor" id="line-665"></span><span class="anchor" id="line-666"></span><p class="line867"><span class="anchor" id="line-667"></span><pre>os.environ["TMDAIDHOST"] = "foo.bar.yourdomain.dom"
<span class="anchor" id="line-668"></span>TMDAINJECT = "i"</pre><span class="anchor" id="line-669"></span><p class="line874">Now when you send outgoing mail using either tmda-sendmail or tmda-ofmipd, your Message-IDs will look something like this: <span class="anchor" id="line-670"></span><span class="anchor" id="line-671"></span><p class="line867"><span class="anchor" id="line-672"></span><pre>Message-ID: &lt;1056046770.22707.TMDA@foo.bar.yourdomain.dom&gt;</pre><span class="anchor" id="line-673"></span><p class="line862">You can then match <tt>@foo.bar.yourdomain.dom</tt> in your FILTER_INCOMING using a 'headers' entry as shown above. <span class="anchor" id="line-674"></span><span class="anchor" id="line-675"></span><p class="line874">If you'd like to use this strategy when posting to USENET because dated addresses are harvested and spammed before the address expires, you can do so. Of course, you won't be able to use TMDAINJECT to set your Message-ID as that only works with mail readers. <span class="anchor" id="line-676"></span><span class="anchor" id="line-677"></span><p class="line862">Some newsreaders allow the user to customize the Message-ID string, in which case you are set. With <a class="http" href="http://gnus.org/">Gnus</a> v5.10 and above for example, you'd use the following in your ~/.gnus: <span class="anchor" id="line-678"></span><span class="anchor" id="line-679"></span><p class="line867"><span class="anchor" id="line-680"></span><pre>(setq message-user-fqdn "foo.bar.yourdomain.dom")</pre><span class="anchor" id="line-681"></span><p class="line874">If your newsreader doesn't provide this ability, request it! <span class="anchor" id="line-682"></span><span class="anchor" id="line-683"></span><p class="line867">
<h2 id="head-f5c80aa5fd7f16919fb34e3f9563186087d9bc42">Which mail clients (MUAs) are supported by tmda-ofmipd?</h2>
<span class="anchor" id="line-684"></span><p class="line874">Any MUA that can send mail by connecting to an SMTP port, and which supports SMTP Authentication (RFC 2554) can use tmda-ofmipd. <span class="anchor" id="line-685"></span><span class="anchor" id="line-686"></span><p class="line874">For SMTP AUTH, tmda-ofmipd supports the following authentication methods: PLAIN, LOGIN, and CRAM-MD5. This covers the majority of clients. <span class="anchor" id="line-687"></span><span class="anchor" id="line-688"></span><p class="line874">The following MUAs have been known to work with tmda-ofmipd. <span class="anchor" id="line-689"></span><div><table><tbody><tr>  <td><p class="line862"> MUA </td>
  <td><p class="line862"> AUTH method </td>
</tr>
<tr>  <td><span class="anchor" id="line-690"></span><p class="line862"> Apple Mail 2.546 </td>
  <td><p class="line862"> CRAM-MD5 </td>
</tr>
<tr>  <td><span class="anchor" id="line-691"></span><p class="line862"> Becky! 2.00.11 </td>
  <td><p class="line862"> CRAM-MD5 </td>
</tr>
<tr>  <td><span class="anchor" id="line-692"></span><p class="line862"> Edmax 2.96 </td>
  <td><p class="line862"> CRAM-MD5 </td>
</tr>
<tr>  <td><span class="anchor" id="line-693"></span><p class="line862"> Eudora 5.1.1 </td>
  <td><p class="line862"> CRAM-MD5 </td>
</tr>
<tr>  <td><span class="anchor" id="line-694"></span><p class="line862"> IMP Webmail 3.1 </td>
  <td><p class="line862"> LOGIN </td>
</tr>
<tr>  <td><span class="anchor" id="line-695"></span><p class="line862"> KMail 1.4.2 </td>
  <td><p class="line862"> PLAIN </td>
</tr>
<tr>  <td><span class="anchor" id="line-696"></span><p class="line862"> Mahogany 0.64.1 </td>
  <td><p class="line862"> CRAM-MD5 </td>
</tr>
<tr>  <td><span class="anchor" id="line-697"></span><p class="line862"> Mew 2.2 </td>
  <td><p class="line862"> CRAM-MD5 </td>
</tr>
<tr>  <td><span class="anchor" id="line-698"></span><p class="line862"> Mozilla 5.0 </td>
  <td><p class="line862"> PLAIN </td>
</tr>
<tr>  <td><span class="anchor" id="line-699"></span><p class="line862"> Mulberry 2.2.1 </td>
  <td><p class="line862"> PLAIN </td>
</tr>
<tr>  <td><span class="anchor" id="line-700"></span><p class="line862"> Netscape 4.78 </td>
  <td><p class="line862"> PLAIN </td>
</tr>
<tr>  <td><span class="anchor" id="line-701"></span><p class="line862"> Outlook 2000 </td>
  <td><p class="line862"> LOGIN </td>
</tr>
<tr>  <td><span class="anchor" id="line-702"></span><p class="line862"> Outlook Express 5 </td>
  <td><p class="line862"> LOGIN </td>
</tr>
<tr>  <td><span class="anchor" id="line-703"></span><p class="line862"> Pegasus Mail 4.01 </td>
  <td><p class="line862"> CRAM-MD5 </td>
</tr>
<tr>  <td><span class="anchor" id="line-704"></span><p class="line862"> Pine 4.44 </td>
  <td><p class="line862"> CRAM-MD5 </td>
</tr>
<tr>  <td><span class="anchor" id="line-705"></span><p class="line862"> Python's smtplib </td>
  <td><p class="line862"> CRAM-MD5 </td>
</tr>
<tr>  <td><span class="anchor" id="line-706"></span><p class="line862"> sSMTP 2.48 </td>
  <td><p class="line862"> LOGIN </td>
</tr>
<tr>  <td><span class="anchor" id="line-707"></span><p class="line862"> Sylpheed 0.8.2 </td>
  <td><p class="line862"> CRAM-MD5 </td>
</tr>
<tr>  <td><span class="anchor" id="line-708"></span><p class="line862"> Thunderbird 1.5 </td>
  <td><p class="line862"> PLAIN (over SSL) </td>
</tr>
<tr>  <td><span class="anchor" id="line-709"></span><p class="line862"> Ximian Evolution 1.0.8 </td>
  <td><p class="line862"> CRAM-MD5 </td>
</tr>
</tbody></table></div><span class="anchor" id="line-710"></span><span class="anchor" id="line-711"></span><span class="anchor" id="line-712"></span><p class="line867">
<h2 id="head-334b2e0ed368e8c80544726afa35a6e5b0b8af53">My MUA doesn't support direct SMTP. Can I still use tmda-ofmipd?</h2>
<span class="anchor" id="line-713"></span><p class="line874">Some Unix MUAs (e.g, Mutt, Gnus) only support a /usr/sbin/sendmail command-line interface for sending mail, and can't do direct SMTP. <span class="anchor" id="line-714"></span><span class="anchor" id="line-715"></span><p class="line874">To use tmda-ofmipd with such a client, you'll have to install a SMTP AUTH capable client program with a sendmail compatible wrapper. You'll then point your MUA at that, and when mail is sent, the wrapper will hand the message off to tmda-ofmipd. <span class="anchor" id="line-716"></span><span class="anchor" id="line-717"></span><p class="line874">You can use the sSMTP program to do this. Some links for sSMTP: <span class="anchor" id="line-718"></span><span class="anchor" id="line-719"></span><p class="line862">Source: <a class="ftp" href="ftp://metalab.unc.edu/pub/Linux/system/mail/mta/">ftp://metalab.unc.edu/pub/Linux/system/mail/mta/</a> <span class="anchor" id="line-720"></span><span class="anchor" id="line-721"></span><p class="line862">Debian: <a class="http" href="http://packages.debian.org/unstable/mail/ssmtp.html">http://packages.debian.org/unstable/mail/ssmtp.html</a> <span class="anchor" id="line-722"></span><span class="anchor" id="line-723"></span><p class="line862">RPMs: <a class="http" href="http://www.rpmfind.net/linux/rpm2html/search.php?query=ssmtp">http://www.rpmfind.net/linux/rpm2html/search.php?query=ssmtp</a> <span class="anchor" id="line-724"></span><span class="anchor" id="line-725"></span><p class="line874">I've had success with the following ssmtp.conf file: <span class="anchor" id="line-726"></span><span class="anchor" id="line-727"></span><p class="line867"><span class="anchor" id="line-728"></span><pre> # Your tmda-ofmipd host:port
<span class="anchor" id="line-729"></span> mailhub=nightshade:8025
<span class="anchor" id="line-730"></span></pre><span class="anchor" id="line-731"></span><p class="line867"><span class="anchor" id="line-732"></span><pre> # Set this to never rewrite the "From:" line (unless not given) and to
<span class="anchor" id="line-733"></span> # use that address in the "from line" of the envelope.
<span class="anchor" id="line-734"></span> FromLineOverride=YES
<span class="anchor" id="line-735"></span></pre><span class="anchor" id="line-736"></span><p class="line862">When you point your MUA at ssmtp, use the <tt>-au'&nbsp;and&nbsp;</tt>-ap' flags to pass along your tmda-ofmipd username and password. e.g, in your .muttrc: <span class="anchor" id="line-737"></span><span class="anchor" id="line-738"></span><p class="line867"><span class="anchor" id="line-739"></span><pre> set sendmail="/usr/bin/ssmtp -au jason -ap MyPassword"
<span class="anchor" id="line-740"></span></pre><span class="anchor" id="line-741"></span><p class="line874">If anyone has any other solutions to this problem, please let us know. <span class="anchor" id="line-742"></span><span class="anchor" id="line-743"></span><p class="line867">
<h2 id="head-5b1b10b6d51eca8e740d3b21f9f393e1406e37e0">Why is CRAM-MD5 disabled in tmda-ofmipd when using remote authentication?</h2>
<span class="anchor" id="line-744"></span><p class="line874">Unfortunately, CRAM-MD5 does not work with -R (--remoteauth) or -A (--authprog) authentication methods. <span class="anchor" id="line-745"></span><span class="anchor" id="line-746"></span><p class="line874">If you want to know why and how authentication works in tmda-ofmipd (and tmda-manager), read the explanation below. <span class="anchor" id="line-747"></span><span class="anchor" id="line-748"></span><p class="line874">In the following discussion, I'll use IMAP as the authentication method, although it applies as well to POP3, APOP and LDAP (with and without SSL). <span class="anchor" id="line-749"></span><span class="anchor" id="line-750"></span><p class="line874">Here is a little ascii schema to better visualize the flux: <span class="anchor" id="line-751"></span><span class="anchor" id="line-752"></span><p class="line867"><span class="anchor" id="line-753"></span><pre> ,-----. ,--------. ,--------.
<span class="anchor" id="line-754"></span> | MUA |-----[1]---&gt;| ofmipd | | SMTP |
<span class="anchor" id="line-755"></span> | |=====[3]===&gt;| proxy |======[4]=====&gt;| server |
<span class="anchor" id="line-756"></span> `-----' `--------' `--------'
<span class="anchor" id="line-757"></span>                        |
<span class="anchor" id="line-758"></span>                       [2]
<span class="anchor" id="line-759"></span>                        |
<span class="anchor" id="line-760"></span>                        V
<span class="anchor" id="line-761"></span>                    ,--------.
<span class="anchor" id="line-762"></span>                    | IMAP |
<span class="anchor" id="line-763"></span>                    | server |
<span class="anchor" id="line-764"></span>                    `--------'
<span class="anchor" id="line-765"></span></pre><span class="anchor" id="line-766"></span><p class="line867"><span class="anchor" id="line-767"></span><pre>---&gt; is the authentication data
<span class="anchor" id="line-768"></span>===&gt; is the message data</pre><span class="anchor" id="line-769"></span><ol type="1"><li>the MUA sends authentication data (ie. username and password in clear) to ofmipd acting as a SMTP server. <span class="anchor" id="line-770"></span><span class="anchor" id="line-771"></span></li><li class="gap">ofmipd acts now as a IMAP client to authenticate against the IMAP server. <span class="anchor" id="line-772"></span><span class="anchor" id="line-773"></span></li><li class="gap">if the auth is OK, ofmipd accepts the message from the MUA. <span class="anchor" id="line-774"></span><span class="anchor" id="line-775"></span></li><li class="gap">ofmipd tag the address(es) and act as a client to send the message to the SMTP server. <span class="anchor" id="line-776"></span></li></ol><p class="line874">The important point here is that ofmipd acts as a client to authenticate, and since a client has the clear text password, then ofmipd needs to get the clear text password from the actual MUA client. <span class="anchor" id="line-777"></span><span class="anchor" id="line-778"></span><p class="line874">This breaks down when using CRAM-MD5 since during SMTP authentication, the client password is converted into a hexdigest before transmission. Thus, tmda-ofmipd never receives the password in clear text, and thus can't verify it against an external source like an IMAP server. <span class="anchor" id="line-779"></span><span class="anchor" id="line-780"></span><p class="line874">However, given the username and a local password file (like /etc/tofmipd), tmda-ofmipd can lookup the users password, recalculate the hexdigest, and then compare that to the digest it received from the client. This is why CRAM-MD5 is supported with "authfile" authentication. <span class="anchor" id="line-781"></span><span class="anchor" id="line-782"></span><p class="line862">See <a class="http" href="http://www.faqs.org/rfcs/rfc2195.html">http://www.faqs.org/rfcs/rfc2195.html</a> for more on how CRAM-MD5 works. <span class="anchor" id="line-783"></span><span class="anchor" id="line-784"></span><p class="line874">If you want to use remote authentication but are concerned about sending passwords over the wire in the clear, you should use stunnel or ssh to encrypt the connection between the MUA and tmda-ofmipd. <span class="anchor" id="line-785"></span><span class="anchor" id="line-786"></span><p class="line867">
<h2 id="head-7b3d893cd20a90d79b371a136cdbf22f3601cdb2">Does tmda-ofmipd have TLS/SSL support?</h2>
<span class="anchor" id="line-787"></span><p class="line874">For security reasons, many users are interested in creating an encrypted channel between their MUA and tmda-ofmipd which generally listens on port 8025 on the server. <span class="anchor" id="line-788"></span><span class="anchor" id="line-789"></span><p class="line862">As of TMDA v1.1.12, tmda-ofmipd has native STARTTLS and SSL support. See <a href="./TmdaOfmipdHowto.html">TmdaOfmipdHowto</a> for more info. <span class="anchor" id="line-790"></span><span class="anchor" id="line-791"></span><p class="line874">If you're using an older version of TMDA, you can pair tmda-ofmipd with tools like SSH or Stunnel instead. <span class="anchor" id="line-792"></span><span class="anchor" id="line-793"></span><p class="line874">Here are some references for how you might set this up: <span class="anchor" id="line-794"></span><span class="anchor" id="line-795"></span><ul><li><p class="line891"><a class="http" href="http://permalink.gmane.org/gmane.mail.spam.tmda.devel/3573">http://permalink.gmane.org/gmane.mail.spam.tmda.devel/3573</a> <span class="anchor" id="line-796"></span></li><li><p class="line891"><a class="http" href="http://permalink.gmane.org/gmane.mail.spam.tmda.devel/3576">http://permalink.gmane.org/gmane.mail.spam.tmda.devel/3576</a> <span class="anchor" id="line-797"></span></li><li><p class="line891"><a class="http" href="http://www.arda.homeunix.net/stunnelsetup.html">http://www.arda.homeunix.net/stunnelsetup.html</a> <span class="anchor" id="line-798"></span><span class="anchor" id="line-799"></span></li></ul><p class="line874">Recent versions of TMDA have support for better integration of tmda-ofmipd and tcpserver/xinetd/stunnel, which allows tmda-ofmipd to correctly report the client's IP address, for example. Refer to the contrib/ofmipd-stunnel-xinetd directory. <span class="anchor" id="line-800"></span><span class="anchor" id="line-801"></span><p class="line867">
<h1 id="head-c6d5edac135cfcbe4116c50b67b6ddb403dcf0cd">Integration issues (with external resources)</h1>
<span class="anchor" id="line-802"></span><p class="line867">
<h2 id="head-31b6db28514fb8d10f1d8475baffcb0141f43ed5">How do I setup TMDA with vpopmail?</h2>
<span class="anchor" id="line-803"></span><p class="line862">See Lou Hevly's TMDA/vpopmail tutorial, available at <a class="http" href="http://www.visca.com/tmda/tmda_vpop.html">http://www.visca.com/tmda/tmda_vpop.html</a> <span class="anchor" id="line-804"></span><span class="anchor" id="line-805"></span><p class="line862">Instructions for using tmda-ofmipd with vpopmail can be found at <a class="http" href="http://tmda.net/tmda-vdomains.html#vpopmail">http://tmda.net/tmda-vdomains.html#vpopmail</a> <span class="anchor" id="line-806"></span><span class="anchor" id="line-807"></span><p class="line874">Also, to simplify adding TMDA to vpopmail accounts there is a vadduser-tmda wrapper script available in the contrib directory. Installation and usage instructions are included in the top of the script. <span class="anchor" id="line-808"></span><span class="anchor" id="line-809"></span><p class="line867">
<h2 id="head-8948d7e0c2fc74bb8d4b852b32282c856d01e28e">How can I prevent BBDB from asking about 'dated' addresses?</h2>
<span class="anchor" id="line-810"></span><p class="line874">If you use BBDB with Emacs, you may have noticed that every time it sees a new 'dated' address it asks you whether it should be added. <span class="anchor" id="line-811"></span><span class="anchor" id="line-812"></span><p class="line862">To prevent this, you can either set bbdb-always-add-addresses to 'never, or use a BBDB hook to filter the addresses before adding them to the database. See <a class="http" href="http://my.gnus.org/Lisp/1012312767">http://my.gnus.org/Lisp/1012312767</a> for an example. <span class="anchor" id="line-813"></span><span class="anchor" id="line-814"></span><p class="line867">
<h2 id="head-39124e4c74c6975f5776a15899e2cc430bf98ce6">How do I integrate TMDA with the ezmlm mailing list manager?</h2>
<span class="anchor" id="line-815"></span><p class="line874">TMDA is a good way to prevent SPAM from reaching your mailing lists, without requiring that the sender be subscribed to post. <span class="anchor" id="line-816"></span><span class="anchor" id="line-817"></span><p class="line874">TMDA can check whether the incoming message is from a subscriber and let it straight through, and otherwise prompt the sender to confirm. After which the message is delivered to the list, and future messages from that sender will not require confirmation. <span class="anchor" id="line-818"></span><span class="anchor" id="line-819"></span><p class="line874">TMDA integrates particularily easily with ezmlm. Mate Wierdl has written a script called `tmda4ezmlm' that sets up TMDA for an ezmlm mailing list: <span class="anchor" id="line-820"></span><span class="anchor" id="line-821"></span><p class="line867"><a class="http" href="http://www.csi.hu/mw/tmda4ezmlm">http://www.csi.hu/mw/tmda4ezmlm</a> <span class="anchor" id="line-822"></span><span class="anchor" id="line-823"></span><p class="line867"><a class="http" href="http://www.csi.hu/mw/tmda4ezmlm.sh">http://www.csi.hu/mw/tmda4ezmlm.sh</a> <span class="anchor" id="line-824"></span><span class="anchor" id="line-825"></span><p class="line874">You need both files. <span class="anchor" id="line-826"></span><span class="anchor" id="line-827"></span><p class="line867">
<h2 id="head-afd89c7ac9ad48cc5c93f0ef1e5d760f2de9582c">Can I use TMDA with Fetchmail?</h2>
<span class="anchor" id="line-828"></span><p class="line874">Yes, albeit after some additional configuration. Simon Waldman has a HOWTO which explains how to do this. <span class="anchor" id="line-829"></span><span class="anchor" id="line-830"></span><p class="line862">Also see Hannu's HOWTO at <a class="http" href="http://wiki.tmda.net/TmdaFetchMailHowTo">http://wiki.tmda.net/TmdaFetchMailHowTo</a> <span class="anchor" id="line-831"></span><span class="anchor" id="line-832"></span><p class="line862">Also see <a class="http" href="http://tmda.net/config-vars.html#RECIPIENT_HEADER">http://tmda.net/config-vars.html#RECIPIENT_HEADER</a> In some fetchmail configurations, you can use RECIPIENT_HEADER in lieu of the RECIPIENT and EXT variables normally required by TMDA. Fetchmail should already provide SENDER in the environment. <span class="anchor" id="line-833"></span><span class="anchor" id="line-834"></span><p class="line867">
<h2 id="head-75a2b9013a74b03cd24d2d43cc4e76bba2e5e950">Can I use TMDA with getmail?</h2>
<span class="anchor" id="line-835"></span><p class="line862">Yes. getmail version 4 includes native support for TMDA; use the Filter_TMDA message filter. See the documentation on this class at <a class="http" href="http://pyropus.ca/software/getmail/configuration.html#conf-filters-tmda">http://pyropus.ca/software/getmail/configuration.html#conf-filters-tmda</a> for details. <span class="anchor" id="line-836"></span><span class="anchor" id="line-837"></span><p class="line867">
<h2 id="head-6393b2d04084447b76374f2338b904586715b2c2">Any tips for using Gmane with TMDA?</h2>
<span class="anchor" id="line-838"></span><p class="line862">If you haven't heard of Gmane, visit <a class="http" href="http://gmane.org/">http://gmane.org/</a> for the scoop. Gmane is the best thing since TMDA, which is the best thing since sliced bread. Gmane will save you a ton of time and hassle when reading and posting to Internet mailing lists. <span class="anchor" id="line-839"></span><span class="anchor" id="line-840"></span><p class="line874">Here are some tips for the TMDA user that should smooth your Gmane experience. <span class="anchor" id="line-841"></span><span class="anchor" id="line-842"></span><p class="line862">First, whitelist <a class="mailto" href="mailto:auth@gmane.org">auth@gmane.org</a> . Gmane uses a challenge/response system similar to TMDA's to authorize posters, and this is the address that the confirmation requests are sent from. See <a class="http" href="http://gmane.org/post.php">http://gmane.org/post.php</a> for more on this process. <span class="anchor" id="line-843"></span><span class="anchor" id="line-844"></span><p class="line874">You may prefer (as I do), to post to a mailing list with a 'dated' From or Reply-To in order to more easily accept direct replies to your messages. <span class="anchor" id="line-845"></span><span class="anchor" id="line-846"></span><p class="line874">As explained on the "Posting" page referenced above, Gmane's news-to-mail authorization script uses the From header to determine who sent the message. Thus, using a 'dated' From isn't wise because then you'll have to confirm every post. So the best idea is to use a 'bare' From, and a 'dated' Reply-To. Then you'll only have to confirm your first post to a group. <span class="anchor" id="line-847"></span><span class="anchor" id="line-848"></span><p class="line862">This scheme is complicated further by the fact that Gmane will send confirmation requests to Reply-To if it exists instead of From. However, a special header <em>Gmane-From</em> will reverse this behavior. <span class="anchor" id="line-849"></span><span class="anchor" id="line-850"></span><p class="line874">In summary, when posting to a Gmane group, use a 'bare' From, a 'dated' Reply-To, and add Gmane-From. It matters not what the value for Gmane-From is, as long as it's non-empty. Gmane-From will be stripped before your message is sent to the mailing list. <span class="anchor" id="line-851"></span><span class="anchor" id="line-852"></span><p class="line874">If you use Gnus to read news, here is an example of how you can accomplish this using 'gnus-posting-styles' from your .gnus: <span class="anchor" id="line-853"></span><span class="anchor" id="line-854"></span><p class="line867"><span class="anchor" id="line-855"></span><pre> (defun tmda-dated-address ()
<span class="anchor" id="line-856"></span>   (shell-command-to-string "/path/to/tmda-address -dn"))
<span class="anchor" id="line-857"></span></pre><span class="anchor" id="line-858"></span><p class="line867"><span class="anchor" id="line-859"></span><pre> (setq gnus-posting-styles
<span class="anchor" id="line-860"></span>       '(("gmane.*"
<span class="anchor" id="line-861"></span>          (address "jason@mastaler.com")
<span class="anchor" id="line-862"></span>          ("Gmane-From" "yes")
<span class="anchor" id="line-863"></span>          ("Reply-To" tmda-dated-address))))
<span class="anchor" id="line-864"></span></pre><span class="anchor" id="line-865"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2007-07-30 15:45
</body>
</html>
