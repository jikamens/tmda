<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>HelpOnInstalling/WikiInstanceCreation</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="mentalwealth/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="mentalwealth/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="mentalwealth/css/print.css">
</head>
<body>
<table>
<tr>
<td>
<img src="logo.png">
</td>
<td>
&nbsp;[<a href="FrontPage.html">FrontPage</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]
</td>
</tr>
</table>
<hr>
<div id="page">
<h1 id="title">HelpOnInstalling/WikiInstanceCreation</h1>
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line862">After you have downloaded and installed Moin<tt class="backtick"></tt>Moin, you will want to "have a wiki". As explained at the bottom of <a href="./HelpOnInstalling(2f)BasicInstallation.html">../BasicInstallation</a>, you have to copy several directories and files. This way, you can have as many wikis as you want, and you can easily upgrade Moin<tt class="backtick"></tt>Moin: only the original files will be overwritten, not your copies. <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line862">Every time you copy those files (and modify the configuration of your server accordingly), you create what is called a <em>wiki instance</em>. Each wiki instance is independant from the others, with a different configuration, different pages, different users, etc. <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line874">Some of the steps you need to take depend on which web server and which operating system you use. They are described on dedicated pages, which you should read (at least the beginning) before reading this one. Some other steps are common to every webserver and operating system (copying files around, setting permissions), and this is what is described here. <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line862">You can use <a class="attachment" href="attachments/HelpOnInstalling(2f)WikiInstanceCreation/createinstance.sh" title="attachment:createinstance.sh">createinstance.sh</a> (a bash script that install the instance). <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line867">
<h1 id="head-8c227c275465dec3f8e3b326d53f9566727c5648">1. Read this first</h1>
<span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line867">
<h2 id="head-6e91ed0b234e903763a945b5249e7de8b726e5d7">1.1. Security warnings</h2>
<span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><div><table style="color: red"><tbody><tr>  <td><p class="line862"> <img alt="/!\" height="15" src="./mentalwealth/img/alert.png" title="/!\" width="15" /> <strong>Warning: make sure that your <tt class="backtick">data</tt> directory and your configuration files are not accessible through your web server. Do not put your wiki directory in <tt class="backtick">public_html</tt>, <tt class="backtick">Sites</tt> or any other directory your web server can access. The web server only needs to access the file in the <tt class="backtick">htdocs</tt> directory and the <tt class="backtick">moin.cgi</tt> script! (Or whatever script your server uses to start Moin<tt class="backtick"></tt>Moin.)</strong> </td>
</tr>
</tbody></table></div><span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><div><table style="color: red"><tbody><tr>  <td><p class="line862"> <img alt="/!\" height="15" src="./mentalwealth/img/alert.png" title="/!\" width="15" /> <strong>Warning: make sure that the <tt class="backtick">data</tt> directory and its subdirectories are not readable and not writeable by users other than the web server user. If you need to give worldwide read-write permissions to get it working, be aware that you are doing a very unsecure setup, that can be compromised by any other user or program on your computer.</strong> </td>
</tr>
</tbody></table></div><span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line867">
<h2 id="head-942d29849126a576afcc19bdbfd59c661739eb55">1.2. Note to Windows users</h2>
<span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line874">All the commands below are Linux commands. The text descriptions that introduce them should be enough to help you understand what you need to do. Use the Windows Explorer, or the appropriate text-mode commands. <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><p class="line867">
<h1 id="head-66ec28f32e6870e96f6062a4a6ac77bbb4606109">2. Choose a wiki name</h1>
<span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line874">Choose a unique name for the new wiki instance you want to create. It should be a short word, something that reflects what you intend to use the wiki for, like the name of your organization, of your team, of the project you are working on, etc. <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><ul><li style="list-style-type:none"><p class="line891"><img alt="&lt;!&gt;" height="15" src="./mentalwealth/img/attention.png" title="&lt;!&gt;" width="15" /> <strong>Do not use the name "wiki" - it is reserved for internal use. You would need a special setup to use this with CGI, and you can't use it at all with standalone or twisted server.</strong> <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span></li></ul><p class="line862">The name "<tt class="backtick">mywiki</tt>" is used as an example in the various commands below. <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><p class="line867">
<h1 id="head-379ea73c819b2c729ba9c2432b8a4c4b4c524f71">3. Choose a location</h1>
<span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><p class="line874">Choose a directory on your disk, it will contain all the files needed for your wiki instance. At the beginning, your wiki instance will use approximately 10 MB of disk space. Then of course, it will grow depending on the way your wiki is used. A personal wiki, even with many pages, might only use 30 MB or 40 MB of disk space. A popular wiki, or a wiki with many files attached to the pages, might use much more, of course. <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line862">If you are the administrator (or root) of the server, you can use anything you like or that makes sense to you, for example <tt class="backtick">/usr/local/var/moin</tt>, <tt class="backtick">/mnt/wikis</tt>, etc. <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line862">If you are a simple user, you will probably only be allowed to write in your personal, "home" directory. Choose a subdirectory that makes sense to you, for example the <tt class="backtick">share/moin</tt> subdirectory. <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line867">
<h1 id="head-951584cdd82db21218fc2ffd3945de602f8275c0">4. Collect some important information</h1>
<span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><p class="line874">This is where the instructions differ according to the web server and operating system you use, and whether you are the administrator or a simple user. See the appropriate pages for your web server and operating system combination. <span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><p class="line862">On Linux, the <tt class="backtick">export</tt> command will be used to remember the collected information. Windows users should write it down carefully (maybe cutting-and-pasting in a Notepad window), or store it in environment variables if they use the command prompt. <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><ul><li><p class="line891"><tt class="backtick">PREFIX</tt> is the prefix you used during the <a href="./HelpOnInstalling(2f)BasicInstallation.html">../BasicInstallation</a> <span class="anchor" id="line-50"></span></li><li><p class="line891"><tt class="backtick">SHARE</tt> is the name of the <tt class="backtick">share</tt> directory, as discussed at the bottom of <a href="./HelpOnInstalling(2f)BasicInstallation.html">../BasicInstallation</a> <span class="anchor" id="line-51"></span></li><li><p class="line891"><tt class="backtick">WIKILOCATION</tt> is the name of the directory that will contain your wiki instance <span class="anchor" id="line-52"></span></li><li><p class="line891"><tt class="backtick">INSTANCE</tt> is the directory containing the wiki instance. It cannot be an existing directory readable through Apache, otherwise it will fail. <span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span></li></ul><p class="line874">If you are an administrator, you also need to collect the following: <span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><ul><li><p class="line891"><tt class="backtick">USER</tt> is the user name of the web server <span class="anchor" id="line-57"></span></li><li><p class="line891"><tt class="backtick">GROUP</tt> is the name of the group to which the web server belongs <span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span></li></ul><p class="line874">Now, Linux folks, let's store these settings in memory: <span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><pre>&gt; export PREFIX=/usr                # this might be something else
<span class="anchor" id="line-62"></span>&gt; export SHARE=$PREFIX/share/moin   # this should be correct for most people
<span class="anchor" id="line-63"></span>&gt; export WIKILOCATION=$SHARE        # this is just an example
<span class="anchor" id="line-64"></span>&gt; export INSTANCE=mywiki            # this is just an example
<span class="anchor" id="line-65"></span></pre><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><p class="line874">Administrators also need the following two lines: <span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><p class="line867"><span class="anchor" id="line-70"></span><pre>&gt; export USER=www-data              # this is just an example
<span class="anchor" id="line-71"></span>&gt; export GROUP=www-data             # this is just an example
<span class="anchor" id="line-72"></span></pre><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><p class="line867">
<h1 id="head-c3fc33e072973371ea739841440fb52175ddb9f6">5. Copy the files</h1>
<span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><p class="line862">To create your new instance, you first need to create a directory named like your instance, inside the <tt class="backtick">WIKILOCATION</tt>. Then you need to copy the <tt class="backtick">data</tt> and <tt class="backtick">underlay</tt> directories from your <tt class="backtick">SHARE</tt> directory into your instance directory. Finally, you need to copy the <tt class="backtick">wikiconfig.py</tt> file from the <tt class="backtick">config</tt> directory into the instance directory. <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><p class="line874">Linux folks need just type these commands: <span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><pre>&gt; cd $WIKILOCATION
<span class="anchor" id="line-81"></span>&gt; mkdir $INSTANCE                   # make a directory for this instance
<span class="anchor" id="line-82"></span>&gt; cp -R $SHARE/data $INSTANCE       # copy template data directory
<span class="anchor" id="line-83"></span>&gt; cp -R $SHARE/underlay $INSTANCE   # copy underlay data directory
<span class="anchor" id="line-84"></span>&gt; cp $SHARE/config/wikiconfig.py $INSTANCE   # copy wiki configuration sample file
<span class="anchor" id="line-85"></span></pre><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><ul><li style="list-style-type:none"><p class="line891"><img alt="/!\" height="15" src="./mentalwealth/img/alert.png" title="/!\" width="15" /> Note that you just need to keep one underlay directory on your system if you are running multiple wikis (e.g. in a farm.) <span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span></li></ul><p class="line867">
<h1 id="head-027e3666aea4dc02569ad386901ae9456bad5ae1">6. Set permissions</h1>
<span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><p class="line867">
<h2 id="head-3b8b040007c209e4621b176c8724b3bbcb755957">6.1. Administrators</h2>
<span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><p class="line874">Administrators need to restrict the permissions of the files, so that only the web server (and the administrator of course) can read and write them. For maximum security, no other user on the machine should be able to read or write anything in the wiki instance directory. Don't forget that this directory contains sensitive information, notably the (encrypted) passwords of the wiki users. <span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><p class="line874">On Linux, the following commands should be enough: <span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><pre>&gt; chown -R $USER.$GROUP $INSTANCE   # check that USER and GROUP are correct
<span class="anchor" id="line-98"></span>&gt; chmod -R ug+rwX $INSTANCE         # USER.GROUP may read and write
<span class="anchor" id="line-99"></span>&gt; chmod -R o-rwx $INSTANCE          # everybody else is rejected
<span class="anchor" id="line-100"></span></pre><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><p class="line867">
<h2 id="head-19c5987edf26a8517fbf6cbee5ba5dd5f36ec280">6.2. Normal users</h2>
<span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><p class="line862">Normal users, on the contrary, need to broaden the permissions of the files, so that the web server can read and write them. On recent Windows versions, and on some versions of Unix, Linux and other systems, <em>access control lists</em> can be used to that effect. They are, however, powerful and complicated, much beyond the scope of this document. Ask a knowledgeable person about them. <span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><p class="line862">Without them, normal users have to allow <em>everybody</em> to access the instance directory. This is the only way the web server can enter it and do its work. This is, of course, <strong>VERY INSECURE</strong>, since any other user and program on the server can read the directory. You should <strong>not</strong> use such a setup for a wiki open to the public. <span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><p class="line874">On Linux, the following commands will open the instance directory to the whole world: <span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><pre>&gt; chmod -R a+rwX $INSTANCE
<span class="anchor" id="line-111"></span></pre><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><p class="line867"><strong>Note:</strong> <span class="anchor" id="line-114"></span><ul><li><p class="line862">it is also possible to put the web server and the normal user in the same <em>group</em>, and then only open the instance directory to the members of that group. This is a bit more secure (depending on who else is in the group), but you need the cooperation of the server administrator; he is the one setting up groups. <span class="anchor" id="line-115"></span></li><li><p class="line862">the best other possibility is that the server administrator sets up <tt class="backtick">suexec</tt> to execute CGI scripts in user directories under the user id of that user. You don't need to give world permissions that way, so it is a quite secure setup, but you also need cooperation of the administrator. <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span></li></ul><p class="line867">
<h1 id="head-442871161f523855f2162b426248f0bb0523c289">7. Tune configuration</h1>
<span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><p class="line874">Now, you need to tune the configuration of your web server and of your wiki instance. Look at the appropriate help page for your web server, then come back here to tune the settings of your wiki instance. <span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><p class="line862">Edit <tt class="backtick">wikiconfig.py</tt>. The default settings should work fine in most cases, but there are some things that you will probably want to change, like the name and logo of your wiki! <img alt=":)" height="15" src="./mentalwealth/img/smile.png" title=":)" width="15" /> Read the comments inside <tt class="backtick">wikiconfig.py</tt>, they will guide you through this process.  (Start with "Wiki identity", around line 25.) <span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><div><table style="color: red"><tbody><tr>  <td><p class="line862"> <img alt="/!\" height="15" src="./mentalwealth/img/alert.png" title="/!\" width="15" /> <strong>Warning: don't forget to restart your web server in order to apply changes in <tt class="backtick">wikiconfig.py</tt></strong> </td>
</tr>
</tbody></table></div><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><p class="line867"><a href="./HelpOnConfiguration.html">HelpOnConfiguration</a> contains all the details about all the options, in case the comments in <tt class="backtick">wikiconfig.py</tt> are not enough. <span class="anchor" id="line-127"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2007-07-30 15:45
</body>
</html>
