<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>HelpOnInstalling/ApacheOnLinux</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="mentalwealth/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="mentalwealth/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="mentalwealth/css/print.css">
</head>
<body>
<table>
<tr>
<td>
<img src="logo.png">
</td>
<td>
&nbsp;[<a href="FrontPage.html">FrontPage</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]
</td>
</tr>
</table>
<hr>
<div id="page">
<h1 id="title">HelpOnInstalling/ApacheOnLinux</h1>
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-7"></span><p class="line862">This page describes the particular steps that need to be taken to create a wiki instance using <a href="./MoinMoin.html">MoinMoin</a> on Linux with the Apache web server. <strong>You should have already performed the <a href="./HelpOnInstalling(2f)BasicInstallation.html">../BasicInstallation</a>. </strong>Installations on other Unices like FreeBSD are very similar. <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line874">Two scenarios are possible. You might be the administrator (root) of the server, able to install and modify files almost anywhere on the machine, and notably able to modifiy the Apache configuration. You might also be a simple user, only able to write files into your home directory, and unable to alter the master Apache config file. The two scenarios are discussed below. <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line867"><strong>Table of contents</strong> <div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li><a href="#head-5a61f5b0107edba120089e4251cd633be60b6e15">Administrator (root)</a><ol><li><a href="#head-c27688fbe7f65d67190a47ce8d32eba244ab0d01">Create a wiki instance</a></li><li><a href="#head-e3e9e08058bb0ae34c33f53367cd58d6c7411998">Install moin.cgi</a></li><li><a href="#head-408a7a283b2406c4e6b24646b25ec7996d5ff459">Configure moin.cgi</a></li><li><a href="#head-b02e2f66403a66cc3b1ff0ce2c7261cf44e4f0d4">Configure Apache</a></li><li><a href="#head-ffa39b171f9d130bb07a8481a5fff1a5a9065e86">Configure MoinMoin</a></li><li><a href="#head-0f7a0fb8dccf6a13b6042fa17e0d7cda751fe3f3">Test the wiki</a></li><li><a href="#head-52920da3312438e6a484347d4dfaa369b86cb521">Apache tricks</a></li></ol><li><a href="#head-e559f024646d8751eee1135ad5423247d72ab7fd">Simple user (home directory installation)</a><ol><li><a href="#head-6a39e2829f37fd34c569c2ffa768c9b3ec2289cc">Make sure /~username works</a></li><li><a href="#head-c27688fbe7f65d67190a47ce8d32eba244ab0d01-2">Create a wiki instance</a></li><li><a href="#head-ec9ce458a3f08281e5906f6d1e2e5cc008d620db">Install the htdocs files</a></li><li><a href="#head-e3e9e08058bb0ae34c33f53367cd58d6c7411998-2">Install moin.cgi</a></li><li><a href="#head-408a7a283b2406c4e6b24646b25ec7996d5ff459-2">Configure moin.cgi</a></li><li><a href="#head-ffa39b171f9d130bb07a8481a5fff1a5a9065e86-2">Configure MoinMoin</a></li><li><a href="#head-0f7a0fb8dccf6a13b6042fa17e0d7cda751fe3f3-2">Test the wiki</a></li></ol><li><a href="#head-3f286acb05ce4ad64240f788c78a8f915f59e34e">Troubleshooting</a><ol><li><a href="#head-b8c0d1c1aba9cd39d0d15f86ea33025f7f25d48d">Adding permission to serve the htdocs directory</a></li></ol></li></ol></div><p class="line874"> <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line867">
<h2 id="head-5a61f5b0107edba120089e4251cd633be60b6e15">1. Administrator (root)</h2>
<span class="anchor" id="line-14"></span><p class="line874">Most GNU/Linux distributions come with Apache pre-installed. There is, however, some variation as to where exactly the various Apache files are located. You should consult your distribution manual, or ask on the appropriate discussion board. In the following paragraphs, we assume a (quite standard) file system layout with: <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><ul><li><p class="line891"><tt class="backtick">/etc/httpd/httpd.conf</tt> - the main Apache configuration file <span class="anchor" id="line-17"></span></li><li><p class="line891"><tt class="backtick">/var/log/httpd/error_log</tt> - the log file containing Apache error messages <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span></li></ul><p class="line862">Some distributions use <tt class="backtick">apache</tt> instead of <tt class="backtick">httpd</tt> for the directory names, others may use weirder settings. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line867">
<h3 id="head-c27688fbe7f65d67190a47ce8d32eba244ab0d01">1.1. Create a wiki instance</h3>
<span class="anchor" id="line-22"></span><p class="line874">Creating a wiki instance involves copying files around and setting appropriate permissions. Before you can proceed, you need to know what user and group your Apache server runs as. The easiest way to know this is to issue this command: <span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span><p class="line867"><span class="anchor" id="line-25"></span><pre>&gt; egrep "^User|^Group" /etc/httpd/httpd.conf
<span class="anchor" id="line-26"></span>User wwwrun
<span class="anchor" id="line-27"></span>Group nogroup
<span class="anchor" id="line-28"></span></pre><span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><p class="line862">This shows a typical result: "<tt class="backtick">wwwrun.nogroup</tt>". Other common results are "<tt class="backtick">nobody.nogroup</tt>", "<tt class="backtick">apache.apache</tt>" and "<tt class="backtick">www-data.www-data</tt>". You can of course use your own. What matters is that you know which ones are in use, because you will need them to set file permissions. <span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><p class="line862">Once you have gathered this information, read <a href="./HelpOnInstalling(2f)WikiInstanceCreation.html">../WikiInstanceCreation</a> and follow the steps described there. <span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><p class="line867">
<h3 id="head-e3e9e08058bb0ae34c33f53367cd58d6c7411998">1.2. Install moin.cgi</h3>
<span class="anchor" id="line-35"></span><p class="line862">There is one last file you need to copy, the bridge between Apache and Moin<tt class="backtick"></tt>Moin: the CGI script that Apache will call every time a wiki page is requested, and that will in turn invoke all the Moin<tt class="backtick"></tt>Moin components to handle the request. You can actually put this script anywhere you like (all the paths to the files Moin<tt class="backtick"></tt>Moin needs can be configured to match your filesystem layout), but for the sake of simplicity and security, we suggest you follow the instructions below, unless you think you know better. <span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><p class="line862">We will create a <tt class="backtick">cgi-bin</tt> subdirectory in the instance directory. Using the environment variables defined in <a href="./HelpOnInstalling(2f)WikiInstanceCreation.html">../WikiInstanceCreation</a>, run the following commands: <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line867"><span class="anchor" id="line-40"></span><pre>&gt; cd $WIKILOCATION/$INSTANCE
<span class="anchor" id="line-41"></span>&gt; mkdir cgi-bin
<span class="anchor" id="line-42"></span>&gt; cp $SHARE/server/moin.cgi cgi-bin
<span class="anchor" id="line-43"></span>&gt; chown -R $USER.$GROUP cgi-bin
<span class="anchor" id="line-44"></span>&gt; chmod -R ug+rx cgi-bin
<span class="anchor" id="line-45"></span>&gt; chmod -R o-rwx cgi-bin
<span class="anchor" id="line-46"></span></pre><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><p class="line867">
<h3 id="head-408a7a283b2406c4e6b24646b25ec7996d5ff459">1.3. Configure moin.cgi</h3>
<span class="anchor" id="line-49"></span><p class="line862">When <tt class="backtick">moin.cgi</tt> is launched, it imports a Moin<tt class="backtick"></tt>Moin module that in turn imports other modules and the configuration file. While the Moin<tt class="backtick"></tt>Moin modules should always be found in a properly configured system (as described in <a href="./HelpOnInstalling(2f)BasicInstallation.html">../BasicInstallation</a>), it is likely that the configuration file will not be found. Edit the <tt class="backtick">moin.cgi</tt> script to correct that. Add these lines near the top of the file: <span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><p class="line867"><span class="anchor" id="line-52"></span><pre>import sys
<span class="anchor" id="line-53"></span>sys.path.insert(0, '..')
<span class="anchor" id="line-54"></span></pre><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><p class="line862">You can also use the absolute name of the directory that contains the <tt class="backtick">wikiconfig.py</tt> file instead of <tt class="backtick">'..'</tt>. <span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><p class="line867">
<h3 id="head-b02e2f66403a66cc3b1ff0ce2c7261cf44e4f0d4">1.4. Configure Apache</h3>
<span class="anchor" id="line-59"></span><p class="line874">Now that every file is in place and properly locked down (as far as the filesystem is concerned), we need to configure Apache so that it offers access to the right files, and no others. However, since the default Apache configuration varies a lot according to the distribution you use, and since administrators often make important additions and changes to it, we cannot give exact instructions that cover all cases. Instead, we will first describe roughly what needs to be done, and then give a few specific lines that you should add at the appropriate place in your Apache config. <span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><p class="line874">Your Apache should be set up so that: <span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><ul><li>Access to your instance directory is denied (sane Apache installations should actually deny access to the whole server, and then only allow a few specific directories). <span class="anchor" id="line-64"></span></li><li><p class="line862">An alias is set up to redirect requests from <tt class="backtick">/wiki/</tt> (in the URL) to the <tt class="backtick">htdocs</tt> directory (in the <tt class="backtick">share</tt> directory, as discussed at the bottom of <a href="./HelpOnInstalling(2f)BasicInstallation.html">../BasicInstallation</a>) <span class="anchor" id="line-65"></span></li><li><p class="line862">A script alias is set up to redirect requests from whatever you want (we suggest you use your instance name, for example <tt class="backtick">/mywiki</tt>) to the CGI script you just copied. <span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span></li></ul><p class="line874">The following commands will add two lines at the bottom of your Apache config file. These lines only cover the last two items listed above. You have to check the first one by yourself (there is too much variation in Linux distributions). Note that you may have to move the two lines to the appropriate place in your config file -- maybe near other similar lines. <span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><p class="line867"><span class="anchor" id="line-70"></span><pre>&gt; echo "" &gt;&gt;/etc/httpd/httpd.conf
<span class="anchor" id="line-71"></span>&gt; echo "Alias /wiki/ \"$SHARE/htdocs/\"" &gt;&gt;/etc/httpd/httpd.conf
<span class="anchor" id="line-72"></span>&gt; echo "ScriptAlias /mywiki \"$WIKILOCATION/$INSTANCE/cgi-bin/moin.cgi\"" &gt;&gt;/etc/httpd/httpd.conf
<span class="anchor" id="line-73"></span></pre><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><p class="line862">You only need to define the alias for <tt class="backtick">htdocs</tt> once. You need to define a different script alias for each wiki instance you intend to run. <span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><p class="line867">
<h3 id="head-ffa39b171f9d130bb07a8481a5fff1a5a9065e86">1.5. Configure MoinMoin</h3>
<span class="anchor" id="line-78"></span><p class="line862">Finally, check that the <tt class="backtick">wikiconfig.py</tt> file in the instance directory contains correct paths for the htdocs prefix, the instance data directory, and the instance underlay directory. You can use relative paths for the directories, but note that they are relative to the CGI script, not the configuration file! You can also use absolute paths, and save yourself some headaches. <span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><p class="line874">Here are the settings you should have in the config file if you followed all our suggestions: <span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><p class="line867"><span class="anchor" id="line-83"></span><pre>    data_dir = '../data/'
<span class="anchor" id="line-84"></span>    data_underlay_dir = '../underlay/'
<span class="anchor" id="line-85"></span>    url_prefix = '/wiki'
<span class="anchor" id="line-86"></span></pre><span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><p class="line862">There are other settings you will likely want to alter, look at the bottom of <a href="./HelpOnInstalling(2f)WikiInstanceCreation.html">../WikiInstanceCreation</a> for more details about them. <span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><p class="line867">
<h3 id="head-0f7a0fb8dccf6a13b6042fa17e0d7cda751fe3f3">1.6. Test the wiki</h3>
<span class="anchor" id="line-91"></span><p class="line862">Everything should work fine now. It is time to <strong>restart the Apache server</strong> (usually with "<tt class="backtick">/etc/init.d/apache&nbsp;restart</tt>", sometimes with "<tt class="backtick">apachectl&nbsp;restart</tt>") and perform the following steps: <span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><ul><li><p class="line862">Run the <em>Moin<tt class="backtick"></tt>Moin CGI Diagnosis</em>: connect to "<tt class="backtick">http://127.0.0.1/mywiki?action=test</tt>" (or the name and port you have defined in the Apache configuration file). Verify that the displayed information is correct. Check that the directories listed under <em>Checking directories...</em> are <em>OK</em>. <span class="anchor" id="line-94"></span></li><li><p class="line862">Access your new wiki with the URL "<tt class="backtick">http://127.0.0.1/mywiki/</tt>" (or the name and port you have defined in the Apache configuration file). You should see the Front<tt class="backtick"></tt>Page. <span class="anchor" id="line-95"></span></li><li>If this is the case, try to edit it and save your changes. <span class="anchor" id="line-96"></span></li><li><p class="line862">If that works, see if your edit is reflected on the Recent<tt class="backtick"></tt>Changes page. <span class="anchor" id="line-97"></span></li><li><p class="line862">If you see them, congratulations, your new wiki works! <img alt=":)" height="15" src="./mentalwealth/img/smile.png" title=":)" width="15" /> <span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span></li></ul><p class="line874">If something goes wrong, have a look at Troubleshooting, at the bottom of this page. <span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><p class="line867">
<h3 id="head-52920da3312438e6a484347d4dfaa369b86cb521">1.7. Apache tricks</h3>
<span class="anchor" id="line-102"></span><p class="line862">For more advanced configuration and some tricks see <a href="./HelpMiscellaneous.html">HelpMiscellaneous</a>. <span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><p class="line867">
<h2 id="head-e559f024646d8751eee1135ad5423247d72ab7fd">2. Simple user (home directory installation)</h2>
<span class="anchor" id="line-105"></span><p class="line862">On machines shared by many people, simple users typically have no access to the root account, cannot modify the <tt class="backtick">httpd.conf</tt> file, and cannot copy files into the system-wide <tt class="backtick">cgi-bin</tt> and <tt class="backtick">htdocs</tt> directories. In that case, Apache can be set up so that each user can host a web site in the home directory of his or her shell account, using the <tt class="backtick">UserDir</tt> directive. If the machine administrator decides to use it, all URLs that start with "<tt class="backtick">/~username</tt>" will be redirected to a directory in the users' home directories, where they have write permission and can install Moin<tt class="backtick"></tt>Moin. <span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><p class="line862">As an example, we will consider the case of a user named "<tt class="backtick">mm</tt>". Of course, wherever you see "<tt class="backtick">mm</tt>" below, you will replace it with your own username. <span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><p class="line867">
<h3 id="head-6a39e2829f37fd34c569c2ffa768c9b3ec2289cc">2.1. Make sure /~username works</h3>
<span class="anchor" id="line-110"></span><p class="line862">The home directory installation can only work if the administrator (root) has allowed it. So, the first step is of course to check that it works. Typically, Apache is set up so that the <tt class="backtick">public_html</tt> subdirectory in the home directory is used as the web site root. So, the first first step is to check if that directory exists. <span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><p class="line867"><span class="anchor" id="line-113"></span><pre>&gt; ls -ld ~/public_html
<span class="anchor" id="line-114"></span>drwxr-xr-x   2 mm       users        4096 Nov 30 00:29 public_html
<span class="anchor" id="line-115"></span></pre><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line874">If the directory does not exist, create it, and be sure it can be read and entered by the web server. <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><p class="line867"><span class="anchor" id="line-120"></span><pre>&gt; mkdir public_html
<span class="anchor" id="line-121"></span>&gt; chmod a+rx public_html
<span class="anchor" id="line-122"></span>&gt; ls -ld ~/public_html
<span class="anchor" id="line-123"></span>drwxr-xr-x   2 mm       users        4096 Nov 30 00:35 public_html
<span class="anchor" id="line-124"></span></pre><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><p class="line862">Now, check if the "<tt class="backtick">/~mm</tt>" URL works: <span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><p class="line867"><span class="anchor" id="line-129"></span><pre>&gt; lynx -error_file=/dev/stderr -dump http://localhost/~mm/ &gt;/dev/null
<span class="anchor" id="line-130"></span>URL=http://localhost/~mm/ (GET)
<span class="anchor" id="line-131"></span>STATUS=HTTP/1.1 200 OK
<span class="anchor" id="line-132"></span></pre><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><p class="line862">If you get a "<tt class="backtick">200&nbsp;OK</tt>" response code, then it works, and you can go on to the next check. If you get a "<tt class="backtick">403&nbsp;Forbidden</tt>" or a "<tt class="backtick">404&nbsp;Not&nbsp;Found</tt>" response, then maybe something is wrong with your directory, or maybe the whole thing has not been enabled by your administrator. <span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><ul><li><p class="line862">Check the permissions for your home directory (<tt class="backtick">~</tt>) and your <tt class="backtick">public_html</tt> directory. The first one should at least end with "<tt class="backtick">--x</tt>", and the second one, as we saw above, with "<tt class="backtick">r-x</tt>". <span class="anchor" id="line-137"></span></li><li><p class="line862">It also possible that the administrator has set up another name for the personal web site directory. "<tt class="backtick">public_html</tt>" is just the usual default, but anything can actually be used. There is no way to know, you have to ask the administrator (root). <span class="anchor" id="line-138"></span></li><li>Finally, if the personal web site feature is disabled, maybe you can ask the administrator to enable it? <span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span></li></ul><p class="line874">Once you have checked you can read the files in the directory, you need to check that you are also able to execute CGI scripts in that directory. Use the following commands to create a simple CGI script in the appropriate location: <span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><p class="line867"><span class="anchor" id="line-143"></span><pre>&gt; mkdir -p ~/public_html/cgi-bin
<span class="anchor" id="line-144"></span>&gt; cat &gt; ~/public_html/cgi-bin/test.cgi
<span class="anchor" id="line-145"></span>#!/bin/sh
<span class="anchor" id="line-146"></span>echo Content-Type: text/plain
<span class="anchor" id="line-147"></span>echo
<span class="anchor" id="line-148"></span>echo "CGI scripts work"
<span class="anchor" id="line-149"></span>&lt;CTRL-D&gt;
<span class="anchor" id="line-150"></span>&gt; chmod a+rx ~/public_html/cgi-bin/test.cgi
<span class="anchor" id="line-151"></span>&gt; lynx -dump http://localhost/~jh/cgi-bin/test.cgi
<span class="anchor" id="line-152"></span>CGI scripts work
<span class="anchor" id="line-153"></span></pre><span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><p class="line862">If you get anything else than "<tt class="backtick">CGI&nbsp;scripts&nbsp;work</tt>", then something went wrong. Check the directory permissions as above, try other names (or ask about them). The sad truth might be that you are not allowed to execute CGI scripts. You would then have to ask the administrator (root) for that permission. <span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><p class="line862">Once you get it, you can set up your wiki instance in the <tt class="backtick">public_html</tt> directory. <img alt=":)" height="15" src="./mentalwealth/img/smile.png" title=":)" width="15" /> <span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><p class="line867">
<h3 id="head-c27688fbe7f65d67190a47ce8d32eba244ab0d01-2">2.2. Create a wiki instance</h3>
<span class="anchor" id="line-160"></span><p class="line862">Creating a wiki instance involves copying files around and setting appropriate permissions. Read <a href="./HelpOnInstalling(2f)WikiInstanceCreation.html">../WikiInstanceCreation</a> and follow the steps described there. <span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><p class="line867">
<h3 id="head-ec9ce458a3f08281e5906f6d1e2e5cc008d620db">2.3. Install the htdocs files</h3>
<span class="anchor" id="line-163"></span><p class="line862">The web server needs to access these files, so we need to copy them in the "<tt class="backtick">public_html</tt>" directory. Just use this: <span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><p class="line867"><span class="anchor" id="line-166"></span><pre>&gt; cd ~/public_html
<span class="anchor" id="line-167"></span>&gt; cp -R ~/share/moin/htdocs wiki
<span class="anchor" id="line-168"></span>&gt; chmod -R a+rX wiki
<span class="anchor" id="line-169"></span></pre><span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><p class="line867">
<h3 id="head-e3e9e08058bb0ae34c33f53367cd58d6c7411998-2">2.4. Install moin.cgi</h3>
<span class="anchor" id="line-172"></span><p class="line862">There is one last file you need to copy, the bridge between Apache and Moin<tt class="backtick"></tt>Moin: the CGI script that Apache will call every time a wiki page is requested, and that will in turn invoke all the Moin<tt class="backtick"></tt>Moin components to handle the request. You need to put this file in a directory for which CGI scripts execution is enabled. By default, this should work: <span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><p class="line867"><span class="anchor" id="line-175"></span><pre>&gt; cd ~/public_html
<span class="anchor" id="line-176"></span>&gt; mkdir cgi-bin
<span class="anchor" id="line-177"></span>&gt; cp $SHARE/server/moin.cgi cgi-bin
<span class="anchor" id="line-178"></span>&gt; chmod -R a+rx cgi-bin
<span class="anchor" id="line-179"></span></pre><span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><p class="line867">
<h3 id="head-408a7a283b2406c4e6b24646b25ec7996d5ff459-2">2.5. Configure moin.cgi</h3>
<span class="anchor" id="line-182"></span><p class="line862">When <tt class="backtick">moin.cgi</tt> is launched, it imports a Moin<tt class="backtick"></tt>Moin module (that in turn imports other modules and the configuration file). Since everything has been installed in your home directory, it is likely none of these will be found. Edit the <tt class="backtick">moin.cgi</tt> script to correct that. Add these lines near the top of the file: <span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><p class="line867"><span class="anchor" id="line-185"></span><pre>import sys
<span class="anchor" id="line-186"></span>sys.path.insert(0, '/home/mm/lib/python2.3')
<span class="anchor" id="line-187"></span>sys.path.insert(0, '/home/mm/lib/python2.3/site-packages')
<span class="anchor" id="line-188"></span>sys.path.insert(0, '/home/mm/share/moin/mywiki')
<span class="anchor" id="line-189"></span></pre><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><p class="line862">Of course, you need to adapt the paths to your situation. The first two lines should help locate the Moin<tt class="backtick"></tt>Moin modules, the last one should help locate the <tt class="backtick">wikiconfig.py</tt> file. <span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><p class="line867"><strong>Note:</strong> You might also need to edit the first line of the file, to point to the correct version of Python. The default should be fine, but a line like "<tt class="backtick">#!&nbsp;/usr/bin/python2.3</tt>" might help you if the default does not work. <span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><p class="line867"><strong>Note 2:</strong> In this file there is a line reading <tt>request&nbsp;=&nbsp;RequestCGI()</tt>. If you have a complex mod_rewrite case, you might want to add <tt>properties&nbsp;=&nbsp;{'script_name':&nbsp;'/mywiki'}&nbsp;</tt> in the parenthesis. This will let <a href="./MoinMoin.html">MoinMoin</a> generate URLs that start with <tt>/mywiki</tt> and not the path that the webserver passed to <a href="./MoinMoin.html">MoinMoin</a>: <span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><p class="line867"><span class="anchor" id="line-198"></span><pre>def handle_request(req, env, form):
<span class="anchor" id="line-199"></span>    request = RequestCGI(req, env, form, properties = {'script_name': '/mywiki'})
<span class="anchor" id="line-200"></span>    request.run()
<span class="anchor" id="line-201"></span></pre><span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><p class="line867">
<h3 id="head-ffa39b171f9d130bb07a8481a5fff1a5a9065e86-2">2.6. Configure MoinMoin</h3>
<span class="anchor" id="line-204"></span><p class="line862">Finally, check that the <tt class="backtick">wikiconfig.py</tt> file in the instance directory contains correct paths for the htdocs directory, the instance data directory, and the instance underlay directory. You can use relative paths for the directories, but note that they are relative to the CGI script, not the configuration file! You can also use absolute paths, and save yourself some headaches. <span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><p class="line867"><span class="anchor" id="line-207"></span><pre>    data_dir = '/home/mm/share/moin/mywiki/data/'
<span class="anchor" id="line-208"></span>    data_underlay_dir = '/home/mm/share/moin/mywiki/underlay/'
<span class="anchor" id="line-209"></span>    url_prefix = '/~mm/wiki'
<span class="anchor" id="line-210"></span></pre><span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><p class="line867">
<h3 id="head-0f7a0fb8dccf6a13b6042fa17e0d7cda751fe3f3-2">2.7. Test the wiki</h3>
<span class="anchor" id="line-213"></span><p class="line874">Everything should work fine, now. It is time to perform the following steps: <span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><ul><li><p class="line862">Run the <em>Moin<tt class="backtick"></tt>Moin CGI Diagnosis</em>: <tt>&gt;&nbsp;lynx&nbsp;-dump&nbsp;http://localhost/~mm/cgi-bin/moin.cgi?action=test</tt> <span class="anchor" id="line-216"></span></li><li><p class="line862">If it worked, try to access your new-born wiki with the URL "<tt class="backtick">http://127.0.0.1/~mm/cgi-bin/moin.cgi</tt>". You should see the Front<tt class="backtick"></tt>Page. <span class="anchor" id="line-217"></span></li><li>If this is the case, try to edit it and save your changes. <span class="anchor" id="line-218"></span></li><li><p class="line862">If that works, see if your edit is reflected on the Recent<tt class="backtick"></tt>Changes page. <span class="anchor" id="line-219"></span></li><li><p class="line862">If you see them, congratulations, you have a new wiki! <img alt=":)" height="15" src="./mentalwealth/img/smile.png" title=":)" width="15" /> <span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span></li></ul><p class="line874">If something goes wrong, have a look at Troubleshooting, below. <span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><p class="line867">
<h2 id="head-3f286acb05ce4ad64240f788c78a8f915f59e34e">3. Troubleshooting</h2>
<span class="anchor" id="line-224"></span><p class="line862">See also <a href="./HelpOnInstalling(2f)TroubleShooting.html">../TroubleShooting</a> for generic stuff. <span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><p class="line862">The first thing to do when your wiki does not work as expected is to issue the command "<tt class="backtick">tail&nbsp;/var/log/httpd/error_log</tt>" to display the most recent errors. Usually, you will get a hint on what went wrong, like missing file system permissions. <span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><p class="line867">
<h3 id="head-b8c0d1c1aba9cd39d0d15f86ea33025f7f25d48d">3.1. Adding permission to serve the htdocs directory</h3>
<span class="anchor" id="line-229"></span><p class="line862">In some (sane) Linux distributions (like SuSE 9.0) serving directories other than the document-root "<tt class="backtick">/srv/www/htdocs</tt>" with Apache is switched off by default for security reasons in "<tt class="backtick">/etc/httpd/httpd.conf</tt>" (or for Apache2 "<tt class="backtick">/etc/apache2/httpd.conf</tt>"): <span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><p class="line867"><span class="anchor" id="line-232"></span><pre># forbid access to the entire filesystem by default
<span class="anchor" id="line-233"></span>&lt;Directory /&gt;
<span class="anchor" id="line-234"></span>  Options None
<span class="anchor" id="line-235"></span>  AllowOverride None
<span class="anchor" id="line-236"></span>  Order deny,allow
<span class="anchor" id="line-237"></span>  Deny from all
<span class="anchor" id="line-238"></span>&lt;/Directory&gt;
<span class="anchor" id="line-239"></span></pre><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><p class="line862">To allow Apache to serve directories outside of the document root you have to add these lines to "<tt class="backtick">/etc/httpd/httpd.conf</tt>" (in SuSE it is recommended to create a new "<tt class="backtick">http.conf.local</tt>" and include this file in "<tt class="backtick">/etc/sysconfig/apache2</tt>"): <span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><p class="line867"><span class="anchor" id="line-244"></span><pre>Alias /wiki/ "/usr/share/moin/htdocs/"
<span class="anchor" id="line-245"></span>&lt;Directory "/usr/share/moin/htdocs/"&gt;
<span class="anchor" id="line-246"></span>   Order deny,allow
<span class="anchor" id="line-247"></span>   Allow from all
<span class="anchor" id="line-248"></span>&lt;/Directory&gt;
<span class="anchor" id="line-249"></span>
<span class="anchor" id="line-250"></span>ScriptAlias /mywiki "/usr/share/moin/mywiki/cgi-bin/moin.cgi"
<span class="anchor" id="line-251"></span>&lt;Directory "/usr/share/moin/mywiki/cgi-bin"&gt;
<span class="anchor" id="line-252"></span>   Order deny,allow
<span class="anchor" id="line-253"></span>   Allow from all
<span class="anchor" id="line-254"></span>&lt;/Directory&gt;
<span class="anchor" id="line-255"></span></pre><span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><p class="line874">Of course, you need to adapt the paths to your particular situation. <span class="anchor" id="line-258"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2007-07-30 15:45
</body>
</html>
