<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>FilterSources</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="mentalwealth/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="mentalwealth/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="mentalwealth/css/print.css">
</head>
<body>
<table>
<tr>
<td>
<img src="logo.png">
</td>
<td>
&nbsp;[<a href="FrontPage.html">FrontPage</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]
</td>
</tr>
</table>
<hr>
<div id="page">
<h1 id="title">FilterSources</h1>
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867">
<h4 id="head-67f0ba7e5a9ead117af0d6fc00fa384f819df3a5">TMDA Filter Sources</h4>
<span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line862">In the following list of sources, the expected match field is documented as well as any optional or required arguments. Square brackets (<strong>[]</strong>) indicate the the argument is optional. Words in chevrons (&lt;&gt;) should be replaced by the appropriate option, without the chevrons. <br />
<br />
<strong>NOTE:</strong><br />
 The <tt class="backtick">from*</tt> and <tt class="backtick">to*</tt> sources match against different addresses or sets of addresses depending on whether they are used in an incoming filter or an outgoing filter.<br />
<br />
 <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><div><table><tbody><tr>  <td><p class="line862"> Source </td>
  <td><p class="line862"> Incoming Filter </td>
  <td><p class="line862"> Outgoing Filter </td>
</tr>
<tr>  <td><span class="anchor" id="line-6"></span><p class="line862"> from* </td>
  <td><p class="line862"> * envelope sender<br />
   * From: header field<br />
   * Reply-To: header field<br />
   * X-Primary-Address header field if the PRIMARY_ADDRESS_MATCH setting can be satisfied </td>
  <td><p class="line862"> * From: header field set by user's MUA </td>
</tr>
<tr>  <td><span class="anchor" id="line-7"></span><p class="line862"> to* </td>
  <td><p class="line862"> * envelope recipient </td>
  <td><p class="line862"> One of:   * recipients on tmda-sendmail's command line   * To: header field </td>
</tr>
</tbody></table></div><span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line867">
<h4 id="head-584a8ade82b5ca4dfbd0596b963ff5dee99755e7">Domain Search</h4>
<span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line862">Domain names of the addresses given above are also used in the search. The portion after the first <tt class="backtick">@</tt> in an e-mail address is considered the "domain". i.e, <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line867"><span class="anchor" id="line-14"></span><pre>jason@mastaler.com -&gt; mastaler.com
<span class="anchor" id="line-15"></span>mastaler@cs.yale.edu -&gt; cs.yale.edu</pre><span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line874">Domains must be listed one per line when used in a file. e.g, <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line867"><span class="anchor" id="line-20"></span><pre>wingnet.net
<span class="anchor" id="line-21"></span>mastaler.com
<span class="anchor" id="line-22"></span>tmda.net
<span class="anchor" id="line-23"></span>cs.yale.edu</pre><span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line862">The matching is exact. This isn't wildcarding, so with the above list, <tt class="backtick">mastaler@cs.yale.edu</tt> <strong>would</strong> match, but <tt class="backtick">mastaler@wopr.cs.yale.edu</tt> <strong>would not</strong> match. You'd have to add <tt class="backtick">wopr.cs.yale.edu</tt> to the list first.<br />
<br />
 This feature may be useful for sites that wish to check a large number of domain names, but don't want the overhead of the wildcard code. This feature is less flexible than wildcarding, but is much faster since the list of domains can be stored in a CDB or DBM (either directly, or by using <tt class="backtick">-autocdb</tt> / <tt class="backtick">-autodbm</tt>). <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><p class="line867">
<h4 id="head-dabdd4047400b6a83b7c1930b7c8c0b7bb1d153d">Sources</h4>
<span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line874">This group of sources may be used in either incoming or outgoing filter files. <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line867"><tt class="backtick">from&nbsp;&lt;email_address&gt;</tt><br />
 <span class="anchor" id="line-32"></span><tt class="backtick">to&nbsp;&lt;email_address&gt;</tt> <span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><ul><li style="list-style-type:none"><p class="line862">The <tt class="backtick">from</tt> and <tt class="backtick">to</tt> sources expect a match field of either an explicit email address or a wildcarded email address.The format of the email address is documented <a href="#email_address">below</a>. <span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span></li></ul><p class="line867"><tt class="backtick">from-file&nbsp;[&nbsp;[-autocdb]&nbsp;|&nbsp;[-autodbm]&nbsp;]&nbsp;[&nbsp;-optional&nbsp;]&nbsp;&lt;textfile&gt;</tt><br />
  <span class="anchor" id="line-37"></span><tt class="backtick">to-file&nbsp;[&nbsp;[-autocdb]&nbsp;|&nbsp;[-autodbm]&nbsp;]&nbsp;[&nbsp;-optional&nbsp;]&nbsp;&lt;textfile&gt;</tt> <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><ul><li style="list-style-type:none"><p class="line862">The <tt class="backtick">from-file</tt> and <tt class="backtick">to-file</tt> sources expect the name of a textfile as the match field. You can specify the entire path explicitly or use a leading '~' to represent the user's home directory, like the shell does. The match field is always the name of the textfile. You do not need to add '.cdb' or '.db' if you use the <tt class="backtick">-auto*</tt> flags. It will be automatically appended to the filename. The format of the textfile is documented <a href="#email_file">below</a>. <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line862">Both <tt class="backtick">from-file</tt> and <tt class="backtick">to-file</tt> can take one of the <tt class="backtick">-autocdb</tt> or <tt class="backtick">-autodbm&nbsp;flags</tt>. The -autocdb and -autodbm flags are documented <a href="#autoflags">below</a>. <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line862">If the <tt class="backtick">-optional</tt> flag is given, the non-existence of the file is not an error. If the file should exist, don't specify this flag; the parser will log an error and will defer the mail so that you have a chance to fix the problem. <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span></li></ul><p class="line867"><tt class="backtick">from-cdb&nbsp;[&nbsp;-optional&nbsp;]&nbsp;&lt;database.cdb&gt;</tt><br />
  <span class="anchor" id="line-46"></span><tt class="backtick">to-cdb&nbsp;[&nbsp;-optional&nbsp;]&nbsp;&lt;database.cdb&gt;</tt> <span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><ul><li style="list-style-type:none"><p class="line862">The <tt class="backtick">from-cdb</tt> and <tt class="backtick">to-cdb</tt> sources expect a match field of a CDB database filename. You can specify the entire path or use a leading '~' to represent the user's home directory. You should specify the <strong>.cdb</strong> extension as part of the filename. The CDB format and expected contents are documented <a href="#db_file">below</a>. <span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><p class="line862">If the <tt class="backtick">-optional</tt> flag is given, the non-existence of the file is not an error. If the file should exist, don't specify this flag; the parser will log an error and will defer the mail so that you have a chance to fix the problem. <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span></li></ul><p class="line867"><tt class="backtick">from-dbm&nbsp;[&nbsp;-optional&nbsp;]&nbsp;[&lt;database.db&gt;]</tt><br />
  <span class="anchor" id="line-53"></span><tt class="backtick">to-dbm&nbsp;[&nbsp;-optional&nbsp;]&nbsp;[&lt;database.db&gt;]</tt> <span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><ul><li style="list-style-type:none"><p class="line862">The <tt class="backtick">from-dbm</tt> and <tt class="backtick">to-dbm</tt> sources expect the name of a DBM database in the match field. You can specify the entire path or use a leading '~' to represent the user's home directory. You should specify the <strong>.db</strong> extension as part of the filename. The DBM format and expected contents are documented <a href="#db_file">below</a>. <span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><p class="line862">If the <tt class="backtick">-optional</tt> flag is given, the non-existence of the file is not an error. If the file should exist, don't specify this flag; the parser will log an error and will defer the mail so that you have a chance to fix the problem. <span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span></li></ul><p class="line867"><tt class="backtick">from-ezmlm&nbsp;[&nbsp;-optional&nbsp;]&nbsp;&lt;path_to_subscribers_parent_dir&gt;</tt><br />
  <span class="anchor" id="line-60"></span><tt class="backtick">to-ezmlm&nbsp;[&nbsp;-optional&nbsp;]&nbsp;&lt;path_to_subscribers_parent_dir&gt;</tt> <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><ul><li style="list-style-type:none"><p class="line862">The <tt class="backtick">from-ezmlm</tt> and <tt class="backtick">to-ezmlm</tt> sources match against the subscriber list of an <a class="http" href="http://cr.yp.to/ezmlm.html">ezmlm</a> mailing list. They expect the match field to be the full path of the <em>parent</em> directory of an ezmlm <tt class="backtick">subscribers'&nbsp;directory.&nbsp;You&nbsp;should&nbsp;not&nbsp;include&nbsp;the&nbsp;</tt>subscribers' portion of the path. <span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><p class="line862">If the <tt class="backtick">-optional</tt> flag is given, the non-existence of the file is not an error. If the file should exist, don't specify this flag; the parser will log an error and will defer the mail so that you have a chance to fix the problem. <span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span></li></ul><p class="line867"><tt class="backtick">from-mailman&nbsp;-attr=&lt;attribute&gt;&nbsp;[&nbsp;-optional&nbsp;]&nbsp;&lt;path_to_list_dir&gt;</tt><br />
  <span class="anchor" id="line-67"></span><tt class="backtick">to-mailman&nbsp;-attr=&lt;attribute&gt;&nbsp;[&nbsp;-optional&nbsp;]&nbsp;&lt;path_to_list_dir&gt;</tt> <span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><ul><li style="list-style-type:none"><p class="line862">The <tt class="backtick">from-mailman</tt> and <tt class="backtick">to-mailman</tt> sources match against addresses contained in a <a class="http" href="http://list.org/">Mailman</a> configuration database. The match field should be the full path to the list directory. Both Mailman 2.0 and 2.1-style configuration databases are supported. <span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><p class="line862">The <tt class="backtick">-mailman</tt> sources require you to specify an <tt class="backtick">attribute'&nbsp;to&nbsp;search.&nbsp;Use&nbsp;the&nbsp;</tt>-attr=attribute<tt class="backtick">&nbsp;flag&nbsp;to&nbsp;specify&nbsp;the&nbsp;name&nbsp;of&nbsp;an&nbsp;attribute&nbsp;contained&nbsp;in&nbsp;the&nbsp;database.&nbsp;For&nbsp;example,&nbsp;</tt>members' (subscriber addresses), <tt class="backtick">digest_members'&nbsp;(digest&nbsp;subscriber&nbsp;addresses),&nbsp;or&nbsp;</tt>owner' (list owner's address). <span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><p class="line862">If the <tt class="backtick">-optional</tt> flag is given, the non-existence of the file is not an error. If the file should exist, don't specify this flag; the parser will log an error and will defer the mail so that you have a chance to fix the problem. <span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span></li></ul><p class="line867"><tt class="backtick">from-sql&nbsp;-wildcards&nbsp;|&nbsp;-addr_column=&lt;column_name&gt;&nbsp;[&nbsp;-action_column=&lt;column_name&gt;&nbsp;]&nbsp;&lt;SQL_query&gt;</tt><br />
  <span class="anchor" id="line-76"></span><tt class="backtick">to-sql&nbsp;-wildcards&nbsp;|&nbsp;-addr_column=&lt;column_name&gt;&nbsp;[&nbsp;-action_column=&lt;column_name&gt;&nbsp;]&nbsp;&lt;SQL_query&gt;</tt> <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><ul><li style="list-style-type:none"><p class="line862">The <tt class="backtick">from-sql</tt> and <tt class="backtick">to-sql</tt> sources match against addresses stored in a SQL database. The <tt class="backtick">&lt;SQL_query&gt;</tt> is a SQL SELECT statement that should retrieve the appropriate data. Just what that data needs to be will vary, depending on how you choose to use the <tt class="backtick">from-sql</tt> and <tt class="backtick">to-sql</tt> rules. Remember to enclose the <tt class="backtick">&lt;SQL_query&gt;</tt> in quotes, since it will contain spaces. Double quotes are recommended, to avoid clashing with the single quotes used by SQL. <span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><p class="line862">For a simple SELECT statement, you can put it directly in your <tt class="backtick">from-sql</tt> or <tt class="backtick">to-sql</tt> rule. For more complex statements, you can define a macro in the filter file or you can define a variable in either /etc/tmdarc or ~/.tmda/config and use the macro or variable name in the filter rule. Defining a variable can be more flexible, especially for multiple users at a single site who need the same SELECT statement with minor modifications. For example, you could define this SELECT statement in your /etc/tmdarc: <br />
 <span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><pre>     SQL_WHITELIST = """       
<span class="anchor" id="line-83"></span>       SELECT wl.address         
<span class="anchor" id="line-84"></span>       FROM whitelist AS wl, users AS u        
<span class="anchor" id="line-85"></span>       WHERE u.uid = wl.uid          
<span class="anchor" id="line-86"></span>       AND u.address = %(recipient)s          
<span class="anchor" id="line-87"></span>       AND %(criteria)s        
<span class="anchor" id="line-88"></span>       LIMIT 1"""</pre><span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><p class="line862">This assumes a 'users' table with a unique ID (<tt class="backtick">uid</tt>) and the user's email address (<tt class="backtick">address</tt>). It joins the 'users' and 'whitelist' tables based on the <tt class="backtick">uid</tt>. Details on '%(recipient)s' and '%(criteria)s' can be found below. <span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><p class="line862">A rule in your incoming filter using this variable would look like this: <br />
 <span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><pre>    from-sql -addr_column=wl.address "${SQL_WHITELIST}" accept</pre><span class="anchor" id="line-95"></span><p class="line862">Note that the variable is quoted because it is a string that contains spaces.<br />
<br />
 <span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><p class="line891"><em>Pre-requisite</em>: In either /etc/tmdarc or ~/.tmda/config you must set the <a href="./ConfigurationVariables.html#DB_CONNECTION"> DB_CONNECTION</a> variable so that TMDA can talk to the database. How this is done depends on the database module used. Examples: <br />
<br />
  <span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><p class="line862">MySQLdb  <span class="anchor" id="line-100"></span><pre>DB_CONNECTION = MySQLdb.connect(db='&lt;dbname&gt;',                                 
<span class="anchor" id="line-101"></span>                                 host='&lt;dbhost&gt;',                                 
<span class="anchor" id="line-102"></span>                                 user='&lt;username&gt;',                                 
<span class="anchor" id="line-103"></span>                                 passwd='&lt;password&gt;')</pre><span class="anchor" id="line-104"></span><p class="line862">PyGreSQL  <span class="anchor" id="line-105"></span><pre>  DB_CONNECTION = pgdb.connect('&lt;dbhost&gt;:&lt;dbname&gt;:&lt;username&gt;:&lt;password&gt;')</pre><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span></li></ul><p class="line867">
<h5 id="head-42a2cb3742a90d7c2854b1f7ef02c1187717f738">Wildcard Searches</h5>
<span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><p class="line862">The <tt class="backtick">*-sql</tt> rules can be used in two scenarios. If the <tt class="backtick">-wildcards</tt> argument is given, the &lt;SQL_query&gt; is run and the resulting data set is read, in its entirety, from the database. The first column should be the addresses to match against. The second column is optional, but if it is present, it should be the overriding action or NULL. The returned data is searched in exactly the same way as text files containing wildcards. See <a href="#email_address">Email Addresses</a> below.  <span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><p class="line874">Any columns beyond the second will be ignored. This can come in handy if you need a column in the SELECT list for an ORDER BY clause. Because the search code stops at the first match, unsorted data could cause an incorrect match and the overriding action might not be what you want. If you use wildcards in the address column and you allow an overriding action, you should sort the returned values using an ORDER BY clause. <span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><p class="line867">
<h5 id="head-bc314d3aabf571206822da4930773bfe424fd62d">Exact Match Searches</h5>
<span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><p class="line862">If an exact match of the sender or recipient is all you need, e.g. you don't need wildcards, then you can use the *-sql rules to have the database perform the search for you, returning only the rows that exactly matched. You should specify the <tt class="backtick">-addr_column</tt> argument and provide the name of the column that contains the addresses to search. You do <strong>not</strong> need to include this column in the SELECT list.  <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line862">If you have an overriding action column, you should give its name using the <tt class="backtick">-action_column</tt> argument. If you use the <tt class="backtick">-action_column</tt> argument, you <strong>must</strong> include that column in the SELECT list.  <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><p class="line867"><em>Caveat</em>: When the exact-match form of the <tt class="backtick">from-sql</tt> rule is used, TMDA can search for more than one sender at once. If the SELECT statement returns more than one row, TMDA will use the overriding action from the first row, since it has no way of knowing which sender (the From:, the Reply-To: or the envelope sender address) you care most about. Instead of using overriding actions, consider using separate blacklists and whitelists.  <span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><p class="line862">Your SELECT statement can be as complex as you care to make it, including joins, an ORDER BY clause, a LIMIT clause, etc. TMDA must know where to place the search conditions ("&lt;sender1&gt; = &lt;addr_column&gt; OR &lt;sender2&gt; = &lt;addr_column&gt;", etc.). You should include the string "%(criteria)s" in your SELECT statement at the appropriate location. TMDA will build the list of conditions based on the addresses to be matched and will replace "%(criteria)s" with that list. Here's an example to make this clearer.  <span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><p class="line874">Assume you have the following rule in your incoming filter. <span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><p class="line867"><span class="anchor" id="line-126"></span><pre>    from-sql -addr_column=address &lt;SQL_query&gt; ok</pre><span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><p class="line862">An email arrives with a From: header of "<a class="mailto" href="mailto:friend@example.com">friend@example.com</a>" and a Reply-To: header of "<a class="mailto" href="mailto:friend@another.com">friend@another.com</a>". TMDA will generate the following criteria string: <span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><p class="line867"><span class="anchor" id="line-131"></span><pre>    (address = 'friend@example.com' OR address = 'friend@another.com')</pre><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><p class="line862">Your SELECT statement (&lt;SQL_query&gt;) might look something like this: <span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><p class="line867"><span class="anchor" id="line-136"></span><pre>    SELECT address FROM addr_list WHERE %(criteria)s</pre><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><p class="line874">The SQL code that TMDA actually sends to the database will look like this (reformatted for easier readability): <span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><p class="line867"><span class="anchor" id="line-141"></span><pre>    SELECT address      
<span class="anchor" id="line-142"></span>    FROM addr_list      
<span class="anchor" id="line-143"></span>    WHERE (address = 'friend@example.com' OR             
<span class="anchor" id="line-144"></span>           address = 'friend@another.com')</pre><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><p class="line862">If you store all of your users' whitelists in a single table (a good schema design), you will need some way to restrict your search to a single user's list; the user whose copy of TMDA is querying the database. In order to facilitate that, the <tt class="backtick">from-sql</tt> and <tt class="backtick">to-sql</tt> rules provide three strings that can be used anywhere in your SELECT statement. <span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><ul><li>username -- the value of the USERNAME variable from ~/.tmda/config <span class="anchor" id="line-149"></span></li><li>hostname -- the value of the HOSTNAME variable from ~/.tmda/config <span class="anchor" id="line-150"></span></li><li>recipient -- username@hostname <span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span></li></ul><p class="line874">You can place these in your SELECT statement by using "%(username)s", "(%hostname)s" and/or "%(recipient)s", as needed. TMDA will substitute the appropriate values into the SELECT at the time of the search. Do not put quotes around the above variables. The Python DB API takes care of that for you in a manner appropriate for the database you are using.  <span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><p class="line874">The following group of sources may be used only in incoming filter files.  <span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><p class="line867"><tt class="backtick">body&nbsp;[&nbsp;-case&nbsp;]&nbsp;&lt;regular_expression&gt;</tt><br />
  <span class="anchor" id="line-157"></span><tt class="backtick">headers&nbsp;[&nbsp;-case&nbsp;]&nbsp;&lt;regular_expression&gt;</tt> <span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><ul><li style="list-style-type:none"><p class="line862">The <tt class="backtick">body</tt> and <tt class="backtick">headers</tt> sources expect a match field that is a regular expression as defined in Python's <a class="http" href="http://www.python.org/doc/current/lib/module-re.html">re module</a>. The <tt class="backtick">body</tt> source matches against the body of the message while the <tt class="backtick">headers</tt> matches against the header fields.  <span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><p class="line862">Because regular expressions may include spaces, you must surround the regular expressions with quotation marks. You may use either single quotes (<tt class="backtick">'''''''</tt>) or double quotes (<tt class="backtick">'''"'''</tt>) as long as you use the the same one at both the beginning and the end.  <span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><p class="line862">If you need to match a quote in your regular expression, simply use the other style of quotes to surround the expression or escape the embedded quote with a backslash (<tt class="backtick">'''\'''</tt>).  <span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><p class="line862">The regular expression match is case-insensitive by default. If you want a case-sensitive match, specify the <tt class="backtick">-case</tt> flag.  <span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span></li></ul><p class="line867"><tt class="backtick">body-file&nbsp;[&nbsp;-case&nbsp;]&nbsp;[-optional&nbsp;]&nbsp;[&lt;regexp_file&gt;]</tt><br />
  <span class="anchor" id="line-168"></span><tt class="backtick">headers-file&nbsp;[&nbsp;-case&nbsp;]&nbsp;[-optional&nbsp;]&nbsp;[&lt;regexp_file&gt;]</tt> <span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><ul><li style="list-style-type:none"><p class="line862">The <tt class="backtick">body-file</tt> and <tt class="backtick">headers-file</tt> sources expect the match field to contain the filename of a textfile containing one or more regular expressions as defined in Python's <a class="http" href="http://www.python.org/doc/current/lib/module-re.html">re module</a>. The <tt class="backtick">body-file</tt> source matches against the body of the message while the <tt class="backtick">headers-file</tt> matches against the header fields. The format of the regular expression file is documented <a href="#re_file">below</a>.  <span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><p class="line862">The regular expression match is case-insensitive by default. If you want a case-sensitive match, specify the <tt class="backtick">-case</tt> flag.  <span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><p class="line862">If the <tt class="backtick">-optional</tt> flag is given, the non-existence of the file is not an error. If the file should exist, don't specify this flag; the parser will log an error and will defer the mail so that you have a chance to fix the problem.  <span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span></li></ul><p class="line867"><tt class="backtick">size&nbsp;&lt;&nbsp;&lt;size_in_bytes&nbsp;|&nbsp;&gt;size_in_bytes&nbsp;&gt;</tt> <span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><ul><li style="list-style-type:none"><p class="line862">The <tt class="backtick">size</tt> source expects a comparison operator and a number of bytes to compare to the size of the message. Only the <tt class="backtick">&lt;'&nbsp;and&nbsp;</tt>&gt;' operators are supported. There must not be any whitespace between the operator and the number.  <span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span></li></ul><p class="line867"><tt class="backtick">pipe&nbsp;&lt;command_string&gt;</tt> <span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><ul><li style="list-style-type:none"><p class="line862">The <tt class="backtick">pipe</tt> source expects a shell command string to which the full contents of the incoming message will be piped to. A match is found if <tt class="backtick">command_string</tt> returns a zero exit status. Any non-zero exit status is interpreted as a non-match. If <tt class="backtick">command_string</tt> contains whitespace, it should be quoted.  <span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span></li></ul><p class="line867"><tt class="backtick">pipe-headers&nbsp;&lt;command_string&gt;</tt> <span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><ul><li style="list-style-type:none"><p class="line862">The <tt class="backtick">pipe-headers</tt> source expects a shell command string to which the contents of the incoming message headers only will be piped to. A match is found if <tt class="backtick">command_string</tt> returns a zero exit status. Any non-zero exit status is interpreted as a non-match. If <tt class="backtick">command_string</tt> contains whitespace, it should be quoted.  <span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span></li></ul><p class="line867">
<h4 id="head-5f0064f522585c3c20e120341b280b3b32b4bd62">Miscellaneous Notes</h4>
<span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><p class="line867"><span class="anchor" id="email_address"></span> <span class="anchor" id="line-191"></span><strong>Email Addresses</strong> <span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><p class="line874">In addition to explicit email addresses, you can use expressions based on UNIX shell-style wildcard characters anywhere an email address is expected.  <span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><p class="line867"><strong>NOTE:</strong> Wildcard characters are not recognized in a CDB or DBM file and are only recognized in SQL databases if you specify the -wildcards argument to the rule.  <span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><p class="line874">The special characters are: <span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span><pre>Characters(s)    Description
<span class="anchor" id="line-200"></span>-------------    -----------
<span class="anchor" id="line-201"></span>*                Matches everything.
<span class="anchor" id="line-202"></span>?                Matches any single character.
<span class="anchor" id="line-203"></span>[seq]            Matches any character in seq.
<span class="anchor" id="line-204"></span>[!seq]           Matches any character not in seq.</pre><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><p class="line862">In addition, <tt class="backtick"></tt>@=<tt class="backtick">'&nbsp;(a&nbsp;custom&nbsp;rule)&nbsp;will&nbsp;expand&nbsp;to&nbsp;match&nbsp;both&nbsp;</tt>@<tt class="backtick">&nbsp;and&nbsp;</tt>@*.` <span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span><p class="line874">Here are some common examples: <span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><pre># match only jdoe@domain.dom
<span class="anchor" id="line-211"></span>jdoe@domain.dom
<span class="anchor" id="line-212"></span># match anyone@domain.dom, but not anyone@sub.domain.dom
<span class="anchor" id="line-213"></span>*@domain.dom
<span class="anchor" id="line-214"></span># match anyone@sub.domain.dom, but not anyone@domain.dom
<span class="anchor" id="line-215"></span>*@*.domain.dom
<span class="anchor" id="line-216"></span># match both anyone@domain.dom, and anyone@sub.domain.dom
<span class="anchor" id="line-217"></span>*@=domain.dom</pre><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><p class="line867"><strong>NOTE:</strong> To match the empty envelope sender such as bounce messages are sent with, use <strong><tt class="backtick">&lt;&gt;</tt></strong> as the expression.  <span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><p class="line867"><span class="anchor" id="email_file"></span> <span class="anchor" id="line-222"></span><strong>Email Address Files</strong> <span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><p class="line862">Email address files are textfiles containing an email address, domain, or wildcarded email address on each line. When using the <tt class="backtick">from-file</tt> and <tt class="backtick">to-file</tt> sources, the textfile is searched sequentially, with the first match terminating the search.  <span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><p class="line862">Address files may contain an optional second field on each line that specifies an action (<tt class="backtick">ok,&nbsp;drop,&nbsp;bounce,&nbsp;etc.</tt>). If the action is specified, it overrides the action given in the filter rule.  <span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><p class="line867"><span class="anchor" id="autoflags"></span> <span class="anchor" id="line-229"></span><strong>Auto- Database Flags</strong> <span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><p class="line874">If you have lengthy email address textfiles, you might want to consider using the much faster hashed databases instead. The address files used by the auto-building hashed database feature are the same email address textfiles documented above with the sole exception that wildcards are not supported.  <span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><p class="line862">The <tt class="backtick">-autocdb</tt> and <tt class="backtick">-autodbm</tt> arguments are intended to ease the use of CDB/DBM lists in TMDA by automatically rebuilding the CDB or DBM file as necessary. This gives you the performance advantages of hashed databases without the hassle of having to manually maintain them. With the <tt class="backtick">-auto*</tt> arguments, TMDA will rebuild the database if it doesn't exist or if its timestamp is older than its source file. If the rebuild fails for some reason, TMDA will fall back to matching from the textfile instead.  <span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><p class="line862">Before you try the CDB version of this feature, make sure you have the <a class="http" href="http://pilcrow.madison.wi.us/#pycdb">python-cdb</a> extension module installed.  <span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><p class="line867"><span class="anchor" id="db_file"></span> <span class="anchor" id="line-238"></span><strong>Database Files</strong> <span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><p class="line874">CDB and DBM files are hashed databases. TMDA can look up email addresses or domains in these files. Lookup in these files is much faster than in a textfile. On the other hand, wildcards are not supported in database files -- only in textfiles.  <span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><p class="line874">In a CDB or DBM, the keys should be the email addresses or domain to match, and their corresponding values (or records) should be empty unless you want to override the action specified in the filter file.  <span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><p class="line862">CDB or DBM files can be created outside of TMDA and merely referenced by your filter files (use the <tt class="backtick">*-cdb</tt> and <tt class="backtick">*-dbm</tt> filter rules) or can be automatically created by TMDA if you use the <tt class="backtick">-autocdb</tt> or <tt class="backtick">-autodbm</tt> flags and the <tt class="backtick">*-file</tt> rules.  <span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><p class="line862">If you wish to explore CDB databases, make sure you have the <a class="http" href="http://pilcrow.madison.wi.us/#pycdb">python-cdb</a> extension module installed.  <span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><p class="line867"><span class="anchor" id="re_file"></span> <span class="anchor" id="line-249"></span><strong>Regular Expression Files</strong> <span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><p class="line874">A regular expression textfile is simply a text file with a regular expression on each line. The file is read sequentially and each regular expression is used to attempt a match. As soon as there is a match, the search stops.  <span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span><p class="line862">Because regular expressions may include spaces, you must surround the regular expressions with quotation marks. You may use either single quotes (<tt class="backtick">'''''''</tt>) or double quotes (<tt class="backtick">'''"'''</tt>) as long as you use the the same one at both the beginning and the end.  <span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span><p class="line862">If you need to match a quote in your regular expression, simply use the other style of quotes to surround the expression or escape the embedded quote with a backslash (<tt class="backtick">'''\'''</tt>).  <span class="anchor" id="line-256"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2007-07-30 15:45
</body>
</html>
