<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>FilterSpecification</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="mentalwealth/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="mentalwealth/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="mentalwealth/css/print.css">
</head>
<body>
<table>
<tr>
<td>
<img src="logo.png">
</td>
<td>
&nbsp;[<a href="FrontPage.html">FrontPage</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]
</td>
</tr>
</table>
<hr>
<div id="page">
<h1 id="title">FilterSpecification</h1>
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867">
<h4 id="head-0ac3261d57b38d70dcd6fd3b5dd57c2b3faba823">TMDA Filter Specification</h4>
<span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line862">TMDA filter files are used to control mail both coming in to and going out of TMDA. For incoming, the filter controls how the message is disposed of. For outgoing, it controls how the message is tagged. The incoming filter file default is <strong>~/.tmda/filters/incoming</strong>, which can be changed by setting <strong>FILTER_INCOMING</strong> in your <strong>~/.tmda/config</strong>. The outgoing filter file default is <strong>~/.tmda/filters/outgoing</strong>, which can be changed by setting <strong>FILTER_OUTGOING</strong>. <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867"><span class="u"><strong>Format of Filter Files</strong></span>: <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line862">A filter file is composed of filters, blank lines and comments. For ease of organization, macros, variable interpolation and the ability to include other filter files are supported. These features are documented below in the <a href="#addlfeatures">Additional Features</a> section. <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line874">Each filter in a filter file is expected to be a string containing three fields separated by whitespace. Each filter may be placed on a single line or may be spread over several lines, to increase readability. You must follow a few rules when formatting your filters. <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><ul><li>Each filter must start at the beginning of a line. <span class="anchor" id="line-12"></span></li><li><p class="line862">Subsequent lines that are part of the same filter <em>must</em> be indented by one or more spaces or tabs. <span class="anchor" id="line-13"></span></li><li>Blank lines (either empty or containing only whitespace) or a line beginning a new filter signify the end of the previous filter. <span class="anchor" id="line-14"></span></li><li><p class="line862">A line containing only a comment does <em>not</em> end a filter. You may intersperse comment lines within your filters (see the examples). <span class="anchor" id="line-15"></span></li><li><p class="line862">Everything after <tt class="backtick">'''#'''</tt> on a line is considered a comment and ignored. <span class="anchor" id="line-16"></span></li><li>Filters with invalid syntax are logged with a specific error message into the debug log and the mail is deferred. This is to allow you the chance to fix your filter before processing the mail. <span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span></li></ul><p class="line874">The filter file is read sequentially from top to bottom. The first filter that matches is used. The three fields in a filter are: <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-21"></span><pre>      source match action</pre><span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span></li></ul><p class="line862">* <strong>source</strong>: specifices the source of the match. <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line862">Some sources take optional arguments. An argument begins with a dash (<strong>-</strong>). Some arguments take options. If an argument takes an option, the argument is followed immediately by an equals sign (<strong>=</strong>) and the option. No whitespace is allowed on either side of the equals sign. <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><p class="line874">Single arguments look like this: <span class="anchor" id="line-28"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-29"></span><pre>      -argument</pre><span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><ul><li style="list-style-type:none">and arguments with options look like this: <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span></li></ul><span class="anchor" id="line-34"></span><pre>      -argument=option</pre><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span></li></ul><p class="line862">Sources are documented <a href="./FilterSources.html">here</a> along with any optional arguments and the expected match field. <span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><p class="line862">* <strong>match</strong>: should be an expression, or the full path to a textfile, CDB database, or DBM database containing more expressions if <strong>source</strong> was suffixed with <tt class="backtick">-file',&nbsp;</tt>-cdb', or `-dbm'. <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><p class="line862">The match expression and the contents of the textfile vary based on the source. For an explanation of the match field expected for a given source, see <a href="./FilterSources.html">FilterSources</a>. <span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><p class="line874">The second field within a textfile, CDB or DBM is optional, but overrides action if present. e.g, <span class="anchor" id="line-43"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-44"></span><pre>  foo@mastaler.com
<span class="anchor" id="line-45"></span>  bar@mastaler.com bounce</pre><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span></li></ul><p class="line862">DBM support comes with your Python interpreter, but CDB support currently requires that you first install the <a class="http" href="http://pilcrow.madison.wi.us/#pycdb">python-cdb</a> extension module. <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><p class="line862">The <em>printcdb/printdbm</em> scripts in the <strong>contrib</strong> directory can be used to print the contents of CDB/DBM files in TMDA-list format. <span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><p class="line862">* <strong>action</strong>: action specifies what action to take on the message. An optional <tt class="backtick">'''='''</tt> separates the action from the action's option. Possible values differ based on whether the message is incoming or outgoing. <span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><p class="line874">(for incoming, action can be one of): <span class="anchor" id="line-54"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-55"></span><pre>  bounce,reject (bounce the message)
<span class="anchor" id="line-56"></span>  bounce,reject=&lt;template&gt; (bounce the message using a specific template)
<span class="anchor" id="line-57"></span>  drop,exit,stop (silently drop the message)
<span class="anchor" id="line-58"></span>  ok,accept,deliver (deliver the message)
<span class="anchor" id="line-59"></span>  ok,accept,deliver=&lt;instruction&gt; (deliver to a Maildir, mbox, program, or address)
<span class="anchor" id="line-60"></span>  confirm (request confirmation for the message)
<span class="anchor" id="line-61"></span>  confirm=&lt;template&gt; (request confirmation for the message using a specific template)
<span class="anchor" id="line-62"></span>  hold (store the message in the pending queue but do not send a confirmation request)</pre><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span></li></ul><p class="line862">The <strong>template</strong> option to <strong>bounce,reject</strong> and <strong>confirm</strong> can be used to bounce or confirm the message using a specific template file rather than the default (bounce.txt or confirm_request.txt). The option can be an absolute pathname to the template file (e.g, <em>/path/to/template.txt</em>). Pathnames starting with a tilde will be expanded. It can also be a relative pathname, in which case the template will be searched f <span class="anchor" id="line-65"></span>or under <a href="./ConfigurationVariables.html#TEMPLATE_DIR">TEMPLATE_DIR</a> as described in <a href="./TemplateHowto.html">TemplateHowto</a>. <span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><p class="line862">The <strong>instruction</strong> option to <strong>ok,accept,deliver</strong> can be used to short-circuit the default delivery method by delivering the message to a specific location. Delivery to qmail-style <a class="http" href="http://www.qmail.org/man/man5/maildir.html">Maildirs</a>, mboxrd-format <a class="http" href="http://www.qmail.org/man/man5/mbox.html">mboxes</a>,programs (pipe), and different e-mail addresses are supported. <span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><div><table><tbody><tr>  <td><p class="line862"> instruction: </td>
  <td><p class="line862"> format: </td>
  <td><p class="line862"> examples: </td>
</tr>
<tr>  <td><span class="anchor" id="line-70"></span><p class="line862">program (pipe)</td>
  <td><p class="line862">A program instruction begins with a vertical bar. The rest of the line will be passed to /bin/sh. Whitespace and shell variables (i.e, $HOME and ~) are allowed.</td>
  <td><p class="line891"><tt class="backtick">deliver=|/usr/ucb/vacation&nbsp;jason</tt><br />
<tt class="backtick">deliver=|&nbsp;/usr/bin/maildrop&nbsp;$HOME/.mailfilter</tt></td>
</tr>
<tr>  <td><span class="anchor" id="line-71"></span><p class="line862"> forward </td>
  <td><p class="line862"> A forward instruction begins with an ampersand. If the address begins with a letter or number, you may leave out the ampersand.</td>
  <td><p class="line891"><tt class="backtick">deliver=&amp;johndoe@new.job.com</tt><br />
<tt class="backtick">deliver=janedoe@new.isp.net</tt></td>
</tr>
<tr>  <td><span class="anchor" id="line-72"></span><p class="line862"> mmdf </td>
  <td><p class="line862"> An mmdf instruction begins with a colon. Please note the following restrictions below. </td>
  <td><p class="line891"><tt class="backtick">deliver=:/home/jason/Mailbox</tt><br />
<tt class="backtick">deliver=:~/Mailbox&nbsp;</tt> </td>
</tr>
<tr>  <td><span class="anchor" id="line-73"></span><p class="line862"> mbox </td>
  <td><p class="line862"> An mbox instruction begins with a slash or tilde, and does not end with a slash. Please note the following restrictions below. </td>
  <td><p class="line891"><tt class="backtick">deliver=/home/jason/Mailbox</tt><br />
<tt class="backtick">deliver=~/Mailbox&nbsp;</tt></td>
</tr>
<tr>  <td><span class="anchor" id="line-74"></span><p class="line862"> maildir </td>
  <td><p class="line862"> A maildir instruction begins with a slash or tilde and ends with a slash. Please note the following restrictions below. </td>
  <td><p class="line891"><tt class="backtick">deliver=/home/jason/Maildir/</tt><br />
<tt class="backtick">deliver=~/Maildir/</tt></td>
</tr>
</tbody></table></div><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><p class="line867"><span class="u">Please note the following restrictions to mmdf, mbox and Maildir delivery:</span> <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><ul><li><p class="line862">TMDA will not create Maildirs, mmdf or mbox files if they do not exist. You must create them prior to having TMDA deliver mail to them with commands like <a class="http" href="http://www.qmail.org/man/man1/maildirmake.html">maildirmake</a> and <em>touch</em>.  <span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span></li><li class="gap">TMDA requires write access to any Maildir, mmdf or mbox file you wish to deliver mail to. <span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span></li><li class="gap">TMDA will not deliver to an mmdf or mbox symlink. Specify the path to the actual mbox file instead. <span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span></li><li class="gap"><p class="line862">Do not deliver to mmdf or mbox files located on an NFS filesystem. This is unsafe and can corrupt your mbox file -- this applies to all MDAs, not just TMDA. Use Maildir instead as it is immune to such problems. <br />
<br />
 <span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span></li></ul><p class="line874">(for outgoing, action can be one of): <span class="anchor" id="line-88"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-89"></span><pre>  bare (don't tag)
<span class="anchor" id="line-90"></span>  bare=append (don't tag, and also add recipient to your BARE_APPEND file)
<span class="anchor" id="line-91"></span>  sender (tag with a sender address based on recipient)
<span class="anchor" id="line-92"></span>  sender=address (tag with a sender address based on address instead)
<span class="anchor" id="line-93"></span>  domain (tag with a sender address based on recipient's domain)
<span class="anchor" id="line-94"></span>  domain=address (tag with a sender address based on the domain of address instead)
<span class="anchor" id="line-95"></span>  dated (tag with a dated address)
<span class="anchor" id="line-96"></span>  dated=timeout_interval
<span class="anchor" id="line-97"></span>  exp,explicit,as=full_address (use an explicit address)
<span class="anchor" id="line-98"></span>  ext,extension=address_extension (add an extension to the address)
<span class="anchor" id="line-99"></span>  kw,keyword=keyword (tag with a keyword address)
<span class="anchor" id="line-100"></span>  default (take the default action specified by ACTION_OUTGOING)
<span class="anchor" id="line-101"></span>  tag (tag one or more specific headers with the above actions)</pre><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span></li></ul><p class="line862">For all of the outgoing actions except <strong>tag</strong>, the tag applies to both the From: (or Resent-From:) header and the envelope sender. Both will be set to the same address. <span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><p class="line862">The <strong>tag</strong> action is a little more flexible, in that it can be used to tag more than one header and each header can be tagged with a different address. The <strong>tag</strong> syntax is as follows: <span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-108"></span><pre>  &lt;to* | from*&gt; &lt;match&gt; tag &lt;header action&gt; [header action] ...</pre><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span></li></ul><p class="line862">Any of the to* or from* <strong>sources</strong> may be used. The &lt;match&gt; is explained in <a href="./FilterSources.html">FilterSources</a>. The &lt;match&gt; is followed by the keyword <strong>tag</strong> which is followed by a list of header/action pairs. <span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><p class="line862">The header is the name of the RFC822 header field you want to tag, usually From: or Reply-To:. When you specify the header name, do not include the colon (<tt class="backtick">''':'''</tt>). Use <strong>envelope</strong> to tag the envelope sender. <span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><p class="line862">The action is any one of the outgoing actions from the list above (except <strong>tag</strong>, of course). That action will be used to tag the specified header only. If the specified action is not one from the list above, the action is inserted verbatim as a string. This can be used to add arbitrary headers to your outgoing messages based on destination. Quotes are required for text that includes whitespace and are unnecessary for single word strings. <span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><p class="line862">The <strong>tag</strong> action is especially useful for mailing lists. Here, the envelope sender is set to your subscription address but the From: header is set to a dated address, making it easy for list members to respond to you but greatly reducing the likelihood that spammers will be able to harvest and use the dated address before it expires. <span class="anchor" id="line-117"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-118"></span><pre>  to tmda-users@tmda.net tag
<span class="anchor" id="line-119"></span>     envelope  exp=foo@catseye.net
<span class="anchor" id="line-120"></span>     from      dated=1w</pre><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span></li></ul><p class="line874">In simple cases where you wish to tag the From: header and the envelope sender with the same address but tag Reply-To: differently, you may specify the From: header but not the envelope sender. TMDA will use address in the From: header as the envelope sender. <span class="anchor" id="line-123"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-124"></span><pre>  to closed-list@lists.com tag
<span class="anchor" id="line-125"></span>     from      sender=closed-list-admin@lists.com
<span class="anchor" id="line-126"></span>     reply-to  dated</pre><span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span></li></ul><p class="line874">This will set both the From: header and the envelope sender to the same address (a sender address) based on the envelope sender of the list. Reply-To: will be dated to allow list members to reply to you. <span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><p class="line867"><span class="u"><strong>Additional Features</strong></span>: <span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><p class="line862">* <strong>Macros</strong> <span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><p class="line874">A macro is, in its simplest form, a piece of text that is to be substituted for another piece of text, rather like a #define in C. Here's how to define a simple macro in a filter file. <span class="anchor" id="line-135"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-136"></span><pre>  macro INBOX ~/Mail/Inbox</pre><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span></li></ul><p class="line874">Here's how to use that macro in a filter rule. <span class="anchor" id="line-139"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-140"></span><pre>  to foo@catseye.net deliver=INBOX</pre><span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span></li></ul><p class="line874">Before the filter parser attempts to parse a rule it performs a macro substitution pass on the text. The result of that substitution on the a bove example filter is this. <span class="anchor" id="line-143"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-144"></span><pre>  to foo@catseye.net deliver=~/Mail/Inbox</pre><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span></li></ul><p class="line874">After the substitution is performed, the rule is parsed normally and any syntax errors are identified and logged as usual. <span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><p class="line874">Macros may also take parameters. For example, assume that you always deliver list mail to a unique maildir per list. Here's a macro to help with that. <span class="anchor" id="line-149"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-150"></span><pre>  macro LIST_DELIVER(m) deliver=~/Mail/m/</pre><span class="anchor" id="line-151"></span></li></ul><p class="line874">Here's how you might use it for the two TMDA mailing lists. <span class="anchor" id="line-152"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-153"></span><pre>  from tmda-users-bounces@tmda.net   LIST_DELIVER(TMDA-Users)
<span class="anchor" id="line-154"></span>  from tmda-workers-bounces@tmda.net LIST_DELIVER(TMDA-Workers)</pre><span class="anchor" id="line-155"></span></li></ul><p class="line874">Expanding the above macros results in these rules. <span class="anchor" id="line-156"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-157"></span><pre>  from tmda-users-bounces@tmda.net   deliver=~/Mail/TMDA-Users/
<span class="anchor" id="line-158"></span>  from tmda-workers-bounces@tmda.net deliver=~/Mail/TMDA-Workers/</pre><span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span></li></ul><p class="line874">Macros may refer to other macros but may not refer to themselves, even indirectly. In other words, if macro A refers to macro B, B may not refer to A. This will result in a parser syntax error. <span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><p class="line874">Macros are not case-sensitive. Use case as you prefer to help clarify your filter files. <span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><p class="line862">* <strong>Included Filters</strong> <span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><p class="line874">Filter files may include the contents of other filter files. The included filter rules are placed inline right where they were included. This positioning is important to remember, since the first matching rule encountered is the one that will be applied to an incoming email. <span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><p class="line874">A filter include statement looks like this. <span class="anchor" id="line-169"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-170"></span><pre>  include [ -optional ] /path/to/included/filter_file</pre><span class="anchor" id="line-171"></span></li></ul><p class="line874">If the -optional flag is specified, the parser will not raise an error if the file is missing. If you expect that the file will always be present and its absence would be an error, do not specify this flag! That way, the parser will log an error and defer the mail, so that you can fix the problem. <span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><p class="line874">Filter includes may be nested; that is, the included filter file may include other filter files itself, and those files may also include other files. If a filter file tries to include one of the files that included it, however, an error will be logged and the mail will be deferred. <span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><p class="line862">* <strong>Variable Interpolation</strong> <span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><p class="line862">Filter files support variable interpolation or substitution, like the shell. A variable is recognized if it begins with a dollar sign and a left curly brace (<tt class="backtick">'''${'''</tt>) and ends with a right curly brace (<tt class="backtick">'''}'''</tt>), like this: <tt class="backtick">${TMDADIR}</tt>. <span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><p class="line874">A variable name is looked up first in the Defaults namespace (all of the configuration variables set in Defaults.py or your ~/.tmda/config) and then in the environment if it was not found in the Defaults namespace. If it is still not found, the parser generates an error and the mail is deferred. Variable names are case-sensitive. <span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><p class="line874">Using variables may allow you to create a system-wide filter that users can modify by providing their own additions. A Python variable, such as 'username', would need to be set in the user's configuration file, like this. <span class="anchor" id="line-182"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-183"></span><pre>  username = "foo"</pre><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span></li></ul><p class="line874">Here's an extremely simple system-wide filter that uses the 'username' variable to include a user's filter. <span class="anchor" id="line-186"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-187"></span><pre>  from-file /etc/company_blacklist drop
<span class="anchor" id="line-188"></span>  from-file /etc/company_whitelist accept
<span class="anchor" id="line-189"></span>  include -optional /home/vdomain/tmda/lists/whitelist.${username} </pre><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span></li></ul><p class="line862">If the 'foo' user chooses to create a whitelist and names it "whitelist.foo", it will automatically be included. Because of the use of the -o ptional flag, the file is not required.<br />
<br />
 <span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><p class="line867"><span class="u"><strong>Example Incoming Filter</strong></span>: <span class="anchor" id="line-194"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-195"></span><pre>  ### ~/.tmda/filters/incoming (first match wins) ###
<span class="anchor" id="line-196"></span>  # Accept all bounces (messages with an empty envelope sender)
<span class="anchor" id="line-197"></span>  from &lt;&gt; ok
<span class="anchor" id="line-198"></span>  # Accept all messages to postmistress
<span class="anchor" id="line-199"></span>  to postmistress@* accept
<span class="anchor" id="line-200"></span>  # Bounce all messages from badboy.dom
<span class="anchor" id="line-201"></span>  from *@=badboy.dom bounce
<span class="anchor" id="line-202"></span>  # Accept all messages from mycorp.dom
<span class="anchor" id="line-203"></span>  from *@=mycorp.dom ok
<span class="anchor" id="line-204"></span>  # Include my blacklist and whitelist
<span class="anchor" id="line-205"></span>  from-dbm ~/.tmda/lists/blacklist.db drop
<span class="anchor" id="line-206"></span>  from-cdb ~/.tmda/lists/whitelist.cdb accept
<span class="anchor" id="line-207"></span>  from-file -autodbm ~/.tmda/lists/nastygrams bounce
<span class="anchor" id="line-208"></span>  from-file -autocdb ~/.tmda/lists/confirmed ok
<span class="anchor" id="line-209"></span>  from-file ~/.tmda/lists/whitelist_wildcards accept
<span class="anchor" id="line-210"></span>  # Mailman mailing list subscribers and digest subscribers
<span class="anchor" id="line-211"></span>  from-mailman -attr=members ~mailman/lists/viewnet-news ok
<span class="anchor" id="line-212"></span>  from-mailman -attr=digest_members ~mailman/lists/viewnet-news ok
<span class="anchor" id="line-213"></span>  # ezmlm mailing list subscribers and digest subscribers
<span class="anchor" id="line-214"></span>  from-ezmlm ~alias/all-acl-users ok
<span class="anchor" id="line-215"></span>  from-ezmlm ~alias/all-acl-users/digest ok
<span class="anchor" id="line-216"></span>  # Revoked addresses
<span class="anchor" id="line-217"></span>  to jason-stupid_promo.289076@mastaler.com bounce
<span class="anchor" id="line-218"></span>  to jason-jcrew.832234@mastaler.com confirm
<span class="anchor" id="line-219"></span>  # Examine the message content
<span class="anchor" id="line-220"></span>  body "viagra|ginseng" confirm
<span class="anchor" id="line-221"></span>  headers 'Precedence:.*junk' reject
<span class="anchor" id="line-222"></span>  headers -case 'MAKE MONEY FAST' drop
<span class="anchor" id="line-223"></span>  # Accept all messages smaller than 10KB, but drop messages larger than 1MB
<span class="anchor" id="line-224"></span>  size &lt; 10000 deliver
<span class="anchor" id="line-225"></span>  size &gt; 1000000 exit
<span class="anchor" id="line-226"></span>  # Throw the message away if Razor says it's spam
<span class="anchor" id="line-227"></span>  pipe /usr/bin/razor-check drop
<span class="anchor" id="line-228"></span>  # Save the message to a special mbox if Razor says it's spam
<span class="anchor" id="line-229"></span>  pipe "/usr/bin/razor-check -rs=razor.server.com" deliver=~/mbox.spam</pre><span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span></li></ul><p class="line867"><span class="u"><strong>Example Outgoing Filter</strong></span>: <span class="anchor" id="line-232"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-233"></span><pre>  #### ~/.tmda/filters/outgoing (first match wins) ###
<span class="anchor" id="line-234"></span>  # All mail from postmaster is sent bare
<span class="anchor" id="line-235"></span>  from postmaster@* bare
<span class="anchor" id="line-236"></span>  # And so is all mail from the tmda-users mailing list owner
<span class="anchor" id="line-237"></span>  to-mailman -attr=owner ~mailman/lists/tmda-users bare
<span class="anchor" id="line-238"></span>  # All whitelisted contacts receive untagged messages
<span class="anchor" id="line-239"></span>  to-cdb ~/.tmda/lists/whitelist.cdb bare
<span class="anchor" id="line-240"></span>  to-file ~/.tmda/lists/whitelist_wildcards bare
<span class="anchor" id="line-241"></span>  # Keyword Addresses
<span class="anchor" id="line-242"></span>  to *@myisp.net kw=myisp
<span class="anchor" id="line-243"></span>  to king@grassland.com keyword=elvis_parsley
<span class="anchor" id="line-244"></span>  # Dated addresses (some with a non-default timeout interval)
<span class="anchor" id="line-245"></span>  to bobby@peru.com dated
<span class="anchor" id="line-246"></span>  to-dbm /var/dbm/slowpokes.db dated=6M
<span class="anchor" id="line-247"></span>  # Allow anyone at whitehouse.gov to reply
<span class="anchor" id="line-248"></span>  to president@whitehouse.gov domain
<span class="anchor" id="line-249"></span>  # Majordomo and Mailman check the From: header for membership
<span class="anchor" id="line-250"></span>  to mutt-users@mutt.org tag
<span class="anchor" id="line-251"></span>     from      sender=owner-mutt-users@mutt.org
<span class="anchor" id="line-252"></span>     reply-to  dated
<span class="anchor" id="line-253"></span>  # ezmlm checks the envelope sender address for membership
<span class="anchor" id="line-254"></span>  to tmda-admin@samstech.net tag
<span class="anchor" id="line-255"></span>     # Set envelope sender to the extension address I subscribed with
<span class="anchor" id="line-256"></span>     # and From: to 'default'.  TMDA comes with the default action
<span class="anchor" id="line-257"></span>     # (ACTION_OUTGOING) set to 'dated'.  Reply-To: isn't necessary in
<span class="anchor" id="line-258"></span>     # this case.
<span class="anchor" id="line-259"></span>     envelope  extension=mlists-tmda-admin
<span class="anchor" id="line-260"></span>     from      default
<span class="anchor" id="line-261"></span>  # Add some arbitrary headers.
<span class="anchor" id="line-262"></span>  to foo@bar.com tag organization "Whatwerks.com, Inc."
<span class="anchor" id="line-263"></span>  to foo@bar.com tag
<span class="anchor" id="line-264"></span>     from             sender
<span class="anchor" id="line-265"></span>     reply-to         dated
<span class="anchor" id="line-266"></span>     organization     "Disney Land"
<span class="anchor" id="line-267"></span>     x-favorite-dwarf Hungry
<span class="anchor" id="line-268"></span>  # Use a different username and/or domain
<span class="anchor" id="line-269"></span>  to *@gnus.org exp=jason@gnus.org
<span class="anchor" id="line-270"></span>  to xemacs-binary-kits* explicit=binkit-manager@XEmacs.ORG
<span class="anchor" id="line-271"></span>  to *mail*@=xemacs.org as=postmaster@XEmacs.ORG
<span class="anchor" id="line-272"></span>  to *@=xemacs.org as=jasonrm@xemacs.org</pre><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span></li></ul><p class="line862">A set of starter filter files are included in the TMDA distribution (tarball) within the <strong>contrib/dot-tmda</strong> subdirectory. <span class="anchor" id="line-275"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2007-07-30 15:45
</body>
</html>
